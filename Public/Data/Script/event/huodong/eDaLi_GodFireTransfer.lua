--´´½¨ÈË[ QUFEI 2008-03-05 10:27 UPDATE BugID 32710 ]
--ĞÕi LıNhi®m vø Rùa-Thö thi chÕyÊÂ¼ş½Å±¾
--±¾»î¶¯Ã¿ÌìM· ra Èı´Î,Ã¿cáiÍæ¼ÒÃ¿ÌìÖ»ÄÜ²Î¼Ómµt ´Î

--MisDescBegin
--½Å±¾ºÅ
x808082_g_ScriptId	= 808082

--Tiªp thøÈÎÎñNPCÊôĞÔ
x808082_g_Position_X=54.9700
x808082_g_Position_Z=192.5128
x808082_g_SceneID=2
x808082_g_AccomplishNPC_Name="Vß½ng Nhßşc Vû"

--ÈÎÎñºÅ
x808082_g_MissionId			= 1000
--ÏÂmµt cáiÈÎÎñtoÕ ğµ ID
x808082_g_MissionIdNext	= 1000
--Møc tiêu nhi®m vønpc
x808082_g_Name 					= "Vß½ng Nhßşc Vû"
--ÈÎÎñ¹éÀà
x808082_g_MissionKind			= 13
--ĞÆng c¤p nhi®m vø 
x808082_g_MissionLevel		= 20
--Ğúng·ñĞúngTinhÓ¢ÈÎÎñ
x808082_g_IfMissionElite	= 0
--ÈÎÎñĞúng·ñÒÑ¾­Íê³É
x808082_g_IsMissionOkFail	= 0		--ÈÎÎñ²ÎÊıtoÕ ğµ µÚ0Î»

--ÈÎÎñÎÄ±¾ÃèÊö
x808082_g_MissionName			= "Nhi®m vø Rùa-Thö thi chÕy"
--ÈÎÎñÃèÊö
x808082_g_MissionInfo			= "#{GodFire_Info_001}"
--Møc tiêu nhi®m vø
x808082_g_MissionTarget		= "#{GodFire_Info_006}"
--Î´Hoàn t¤t nhi®m vøtoÕ ğµ npc¶Ô»°
x808082_g_ContinueInfo		= "#{GodFire_Info_007}"
--Hoàn t¤t nhi®m vønpcËµtoÕ ğµ »°
x808082_g_MissionComplete	= "#{GodFire_Info_008}"
--Ã¿´ÎRùa-Thö thi chÕy»î¶¯C¥n ´ò¿¨toÕ ğµ Thành th¸×ÜÊı
x808082_g_MaxRound	= 3
--¿ØÖÆ½Å±¾
x808082_g_ControlScript		= 001066

-- ÈÎÎñÍê³ÉÇé¿ö,ÄÚÈİ¶¯Ì¬Ë¢ĞÂ,·Ö±ğÕ¼ÓÃÈÎÎñ²ÎÊıtoÕ ğµ µÚ1,2,3,4Î»
x808082_g_Custom	= { {id="Ğã cùng LÕc Dß½ng Tri®u Minh Thành ğ¯i thoÕi",num=1}, {id="Ğã cùng Tô Châu Løc Sî Tranh ğ¯i thoÕi",num=1}, {id="Ğã cùng ĞÕi Lı Vß½ng Nhßşc Vû ğ¯i thoÕi",num=1}, {id="Ğã châm toàn bµ ğèn Kh±ng Minh",num=24} }
--MisDescEnd

--ÈÎÎñĞúng·ñÍê³É
x808082_g_Mission_IsComplete = 0		--ÈÎÎñ²ÎÊıtoÕ ğµ µÚ0Î»
--Rùa-Thö thi chÕyĞÕi Lı´ò¿¨±ê¼Ç
x808082_g_RecordIdx 				 = 3		--ÈÎÎñ²ÎÊıtoÕ ğµ µÚ3Î» 1.LÕc Dß½ng 2.Tô Châu 3.ĞÕi Lı
--¿×Ã÷µÆÍê³ÉÊıÁ¿±ê¼Ç
x808082_g_KongMing_Lighten	 = 4		--ÈÎÎñ²ÎÊıtoÕ ğµ µÚ4Î»
--ÈÎÎñ½Å±¾ºÅ¼ÇÂ¼
x808082_g_MissScriptID_Idx	 = 5		--ÈÎÎñ²ÎÊıtoÕ ğµ µÚ5Î»
--ÈÎÎñ·¢²¼NPC±ê¼Ç
x808082_g_AcceptNPC_Idx			 = 6		--ÈÎÎñ²ÎÊıtoÕ ğµ µÚ6Î» 1.LÕc Dß½ngNPC 2.Tô ChâuNPC 3.ĞÕi LıNPC
--Nhi®m vø Rùa-Thö thi chÕyÃ¿ÌìÂÖÊı±ê¼Ç
x808082_g_RoundIndex 				 = 7		--ÈÎÎñ²ÎÊıtoÕ ğµ µÚ7Î»


x808082_g_AcceptMission_IDX		= 720	--Rùa-Thö thi chÕy½ÓÊÕÈÎÎñË÷Òı
x808082_g_CompleteMission_IDX	= 721	--Rùa-Thö thi chÕyÌá½»ÈÎÎñË÷Òı
x808082_g_MissionInfo_IDX			= 722	--ÈÎÎñË ği¬m÷Ë÷Òı

x808082_g_Jion_Count = 0						--±¨ÃûÈËÊı±ê¼Ç
x808082_g_Join_CountMax = 50				--±¨ÃûÈËÊıÉÏÏŞ

x808082_g_KongMingLighten_MaxCnt	=	24	-- Rùa-Thö thi chÕy»î¶¯C¥n  ği¬mÈ¼toÕ ğµ ¿×Ã÷µÆ×ÜÊı

--ËùÓµÓĞtoÕ ğµ ÊÂ¼şIDÁĞ±í
x808082_g_EventList	= {}

x808082_g_Impact_Accept_Mission 	= 47	-- Tiªp thøÈÎÎñÊ±toÕ ğµ ÌØĞ§ID
x808082_g_Impact_Light_Complete 	= 38	--  ği¬mÁÁ¿×Ã÷µÆÊ±toÕ ğµ ÌØĞ§
x808082_g_Impact_Transport_Mission = 113 -- ÔËÊä×´Ì¬ÌØĞ§
x808082_g_Impact_GodOfFire_Mission = 5929 -- Rùa-Thö thi chÕy×´Ì¬ÌØĞ§
x808082_g_PlayerSlow_LVL					= 20	-- Tiªp thøÈÎÎñtoÕ ğµ ×îµÍµÈc¤p

-- ±¨Ãû³ÖĞøÊ±¼ä( phút)
x808082_g_Along_Time							= 5
-- Ã¿ÌìRùa-Thö thi chÕy»î¶¯M· ra Ê±¼ä
x808082_g_ActivityTime						= { {tstart=1230, tend=1330},
																		  {tstart=1930, tend=2030},
																		  {tstart=2130, tend=2230} }

x808082_g_ItemId = { id=40004444,num=1 }				-- ÈÎÎñÎïÆ·

-- ÅÅÃû
x808082_g_GodFireMis_PaiMing = 0
-- ÉÏ´ÎÇå³ıÅÅÃûtoÕ ğµ »·Êı
x808082_g_ClearPaiMing_Round = 0


-- ½±ÀøtoÕ ğµ ³ÆºÅ ¼«Æ··ÉÃ«ÍÈ
x808082_g_GodFire_Title = 241
-- ³ÆºÅÓĞĞ§ÆÚ(Ìì)
x808082_GodFireTitle_AlongTime = 7


-- ½±ÀøKinh nghi®mĞŞÕıÖµ(ÓëÅÅÃûÓĞ¹Ø)
x808082_g_BonusEXP_ListEX = { 3.0000,2.9592,2.9184,2.8776,2.8367,2.7959,2.7551,2.7143,2.6735,2.6327,
															2.5918,2.5510,2.5102,2.4694,2.4286,2.3878,2.3469,2.3061,2.2653,2.2245,
															2.1837,2.1429,2.1020,2.0612,2.0204,1.9796,1.9388,1.8980,1.8571,1.8163,
															1.7755,1.7347,1.6939,1.6531,1.6122,1.5714,1.5306,1.4898,1.4490,1.4082,
															1.3673,1.3265,1.2857,1.2449,1.2041,1.1633,1.1224,1.0816,1.0408,1.0000 }
											  	
x808082_g_BonusEXP_List = { 0,0,0,0,0,0,0,0,0,0,
														0,0,0,0,0,0,0,0,0,19008,
														19872,20628,21384,22212,22968,23832,24588,25344,26208,30852,
														31788,32652,33588,34416,35388,36324,37188,38124,38988,44928,
														45972,46944,47952,48996,50040,51084,52020,53064,54108,61308,
														62460,63576,64728,65844,66996,68112,69264,70416,71532,79848,
														81180,82404,83664,84888,86112,87444,88668,89892,91116,100764,
														102204,103536,104868,106272,107604,109008,110340,111672,113076,123984,
														125496,126900,128412,129852,131364,132876,134280,135792,137232,141948,
														143460,144972,146484,147996,149508,151020,152460,153972,155484,159372,
														160992,162504,164016,165528,167040,168624,170172,171684,173196,176040,
														177552,179064,180648,182268,183780,185292,186804,188316,189936,191448,
														193068,194580,196092,197712,199224,200736,202248,203760,205380,206964,
														208476,209988,211500,213120,214632,216144,217656,219276,220896,222408,
														223920,225432,226944,228564,230076,231660,233208,234720,236304,236304 }

-- ¿×Ã÷µÆÖĞtoÕ ğµ ÈÎÎñÎïÆ·ID
x808082_g_ItemBox_ItemID = 40004445

--**********************************
--ÈÎÎñÈë¿Úº¯Êı
--**********************************
-- ği¬m»÷¸ÃÈÎÎñºóÖ´ĞĞ´Ë½Å±¾
function x808082_OnDefaultEvent( sceneId, selfId, targetId )

	--ÅĞ¶Ï¸ÃnpcĞúng·ñĞúng¶ÔÓ¦ÈÎÎñtoÕ ğµ npc
	if LuaFnGetName( sceneId, targetId ) ~= x808082_g_Name then
		x808082_NotifyTip( sceneId, selfId, "Nh§n nhi®m vø th¤t bÕi" )					
		return 0
	end
			
	local	key	= GetNumText()	
	if key == x808082_g_AcceptMission_IDX then		
		-- ÈÎÎñĞúng·ñÒÑÂú
		if IsMissionFull( sceneId, selfId ) == 1 then
			x808082_NotifyTip( sceneId, selfId, "#{QIANXUN_INFO_23}" )
			return 0
		end

		-- ¼ì²â±¨ÃûÊ±¼ä
		if x808082_CheckApplyTime() == 0 then
			x808082_NotifyTip( sceneId, selfId, "#{GodFire_Info_018}" )					
			return 0
		end
		
		-- ¼ì²âÈÎÎñTiªp thøÌõ¼ş
		if x808082_CheckAccept( sceneId, selfId, targetId )<=0 then
			return 0
		end

		-- ½øÈëTiªp thøÈÎÎñ½çÃæ			
		x808082_AcceptMission( sceneId, selfId, targetId )				

	elseif key == x808082_g_CompleteMission_IDX then
		-- Èç¹ûÒÑ¾­½ÓÁËÈÎÎñ
		if IsHaveMission( sceneId, selfId, x808082_g_MissionId ) > 0 then
												
			--·¢ËÍÈÎÎñĞèÇótoÕ ğµ ĞÅÏ¢
			BeginEvent(sceneId)
				AddText(sceneId, x808082_g_MissionName)
				AddText(sceneId, x808082_g_ContinueInfo)			
			EndEvent( )
			
			local bDone = x808082_CheckSubmit( sceneId, selfId, targetId )				
			DispatchMissionDemandInfo(sceneId, selfId, targetId, x808082_g_ScriptId, x808082_g_MissionId, bDone)
			
		else			
			x808082_TalkInfo( sceneId, selfId, targetId, "#{GodFire_Info_011}" )
			return 0
		end
		
	elseif key == x808082_g_MissionInfo_IDX then
		x808082_TalkInfo( sceneId, selfId, targetId, "#{GodFire_Info_009}" )		
		return 0

	else
		x808082_NotifyTip( sceneId, selfId, "Nh§n nhi®m vø th¤t bÕi" )					
		return 0
	end

end

--**********************************
--ÁĞ¾ÙÊÂ¼ş
--**********************************
function x808082_OnEnumerate( sceneId, selfId, targetId )
	
	--ÅĞ¶Ï¸ÃnpcĞúng·ñĞúng¶ÔÓ¦ÈÎÎñtoÕ ğµ npc
	if LuaFnGetName( sceneId, targetId ) ~= x808082_g_Name then
		return 0
	end
	
	AddNumText( sceneId, x808082_g_ScriptId, "Ta mu¯n tham gia Rùa-Thö thi chÕy", 7, x808082_g_AcceptMission_IDX )
	AddNumText( sceneId, x808082_g_ScriptId, "Ta ğã mu¯n hoàn thành Rùa-Thö thi chÕy", 7, x808082_g_CompleteMission_IDX )
	AddNumText( sceneId, x808082_g_ScriptId, "V« hoÕt ğµng Rùa-Thö thi chÕy", 11, x808082_g_MissionInfo_IDX )

end

--**********************************
--¼ì²âTiªp thøÌõ¼ş,Ò²¹©×ÓÈÎÎñµ÷ÓÃ
--**********************************
function x808082_CheckAccept( sceneId, selfId, targetId )
	
	--¼ì²âÍæ¼ÒĞúng·ñ·ûºÏTiªp thøÈÎÎñtoÕ ğµ Ìõ¼ş
	--ÅĞ¶Ï¸ÃnpcĞúng·ñĞúng¶ÔÓ¦ÈÎÎñtoÕ ğµ npc
	if LuaFnGetName( sceneId, targetId ) ~= x808082_g_Name then
		x808082_NotifyTip( sceneId, selfId, "Nh§n nhi®m vø th¤t bÕi" )					
		return 0
	end
	
	--¼ì²âµÈc¤p
	if LuaFnGetLevel( sceneId, selfId ) < x808082_g_PlayerSlow_LVL then		
		x808082_TalkInfo( sceneId, selfId, targetId, "#{GodFire_Info_013}" )
		return 0
	end

	--¼ì²âÔËÊä×´Ì¬×¤ÁôĞ§¹û
	if LuaFnHaveImpactOfSpecificDataIndex(sceneId, selfId, x808082_g_Impact_Transport_Mission) ~= 0
		 or LuaFnHaveImpactOfSpecificDataIndex(sceneId, selfId, x808082_g_Impact_GodOfFire_Mission) ~= 0 then
		x808082_TalkInfo( sceneId, selfId, targetId, "#{GodFire_Info_014}" )
		return 0
	end

	local nTimePoint = x808082_CheckHuoDongTime()
	-- Çå³ıÅÅÃû
	if x808082_g_ClearPaiMing_Round ~= nTimePoint then
		x808082_g_Jion_Count = 0
		x808082_g_GodFireMis_PaiMing = 0
		x808082_g_ClearPaiMing_Round = nTimePoint
	end

	--¼ì²â±¨ÃûÈËÊıÉÏÏŞ
	if x808082_g_Jion_Count >= x808082_g_Join_CountMax then
		x808082_TalkInfo( sceneId, selfId, targetId, "#{GodFire_Info_015}" )
		return 0
	end

	--ÒÑ¾­½Ó¹ıÔò²»·ûºÏÌõ¼ş
	if IsHaveMission( sceneId, selfId, x808082_g_MissionId ) > 0 then
		x808082_TalkInfo( sceneId, selfId, targetId, "#{GodFire_Info_016}" )
		return 0
	end
	
	--¼ì²âÍæ¼Ò²Î¼Ó»î¶¯toÕ ğµ Ê±¼ä
	local	nDayTime = GetMissionData( sceneId, selfId, MD_GODOFFIRE_DAYTIME )
	
	local nDay = LuaFnGetDayOfThisMonth()
	if nDayTime == nDay then
		x808082_TalkInfo( sceneId, selfId, targetId, "#{GodFire_Info_017}" )
		return 0
	end
	
	--¼ì²âÍæ¼ÒĞúng·ñ×é¶Ó¸úËæ
	if IsTeamFollow( sceneId, selfId ) == 1 then
		x808082_TalkInfo( sceneId, selfId, targetId, "#{GCTeamFollowErrorHandler_Info_In_Mis_GodOfFire}" )		
		return 0
	end
	
	--¼ì²âĞúng·ñ´¦ÓÚË«ÈËÆï³Ë×´Ì¬
	if LuaFnGetDRideFlag(sceneId, selfId) ~= 0  then
		x808082_TalkInfo( sceneId, selfId, targetId, "#{ResultText_117}" )
		return 0
	end
	
	return 1
end

--**********************************
--Tiªp thø,½ö¹©×ÓÈÎÎñµ÷ÓÃÉèÖÃ¹«¹²²ÎÊı
--**********************************
function x808082_OnAccept( sceneId, selfId, targetId, scriptId )
	
	--ÅĞ¶Ï¸ÃnpcĞúng·ñĞúng¶ÔÓ¦ÈÎÎñtoÕ ğµ npc
 	if LuaFnGetName( sceneId, targetId ) ~= x808082_g_Name then
 		x808082_NotifyTip( sceneId, selfId, "Nh§n nhi®m vø th¤t bÕi" )					
		return 0
	end

	if x808082_CheckAccept( sceneId, selfId, targetId )<=0 then
		return 0
	end

	if LuaFnGetTaskItemBagSpace( sceneId, selfId ) < x808082_g_ItemId.num then
		x808082_NotifyTip( sceneId, selfId, "#{QX_20071129_027}" )		
		return 0
	end

  local nDay   = LuaFnGetDayOfThisMonth()

	BeginAddItem(sceneId)
	AddItem(sceneId,x808082_g_ItemId.id, x808082_g_ItemId.num)
	local canAdd = EndAddItem(sceneId,selfId)						
	if canAdd > 0 then
		--¼ÓÈëÈÎÎñµ½Íæ¼ÒÁĞ±í
		local bAdd = AddMission( sceneId, selfId, x808082_g_MissionId, x808082_g_ScriptId, 0, 0, 0 )
		if bAdd >= 1 then				
			AddItemListToHuman(sceneId,selfId)
			
			-- ği¬mµ½ÈÎÎñtoÕ ğµ ĞòÁĞºÅ
			local	misIndex		= GetMissionIndexByID( sceneId, selfId, x808082_g_MissionId )
			
			--¸ù¾İĞòÁĞºÅ°ÑÈÎÎñ±äÁ¿toÕ ğµ µÚ0Î»ÖÃ0 (ÈÎÎñÍê³ÉÇé¿ö)
			SetMissionByIndex( sceneId, selfId, misIndex, x808082_g_Mission_IsComplete, 0 )
			--¸ù¾İĞòÁĞºÅ°ÑÈÎÎñ±äÁ¿toÕ ğµ µÚ1Î»ÖÃÎªÈÎÎñ½Å±¾ºÅ
			SetMissionByIndex( sceneId, selfId, misIndex, x808082_g_MissScriptID_Idx, scriptId )		
			SetMissionByIndex(sceneId, selfId, misIndex, x808082_g_AcceptNPC_Idx, 3)
			SetMissionByIndex(sceneId, selfId, misIndex, x808082_g_RecordIdx, 1)
			SetMissionByIndex(sceneId, selfId, misIndex, x808082_g_KongMing_Lighten, 0)

			local nTimePoint = x808082_CheckHuoDongTime()

			SetMissionByIndex(sceneId, selfId, misIndex, x808082_g_RoundIndex, nTimePoint)
			
			SetMissionData( sceneId, selfId, MD_GODOFFIRE_DAYTIME, nDay )

			LuaFnSendSpecificImpactToUnit( sceneId, selfId, selfId, selfId, x808082_g_Impact_Transport_Mission, 0 )
			LuaFnSendSpecificImpactToUnit( sceneId, selfId, selfId, selfId, x808082_g_Impact_GodOfFire_Mission, 0 )

			x808082_g_Jion_Count = x808082_g_Jion_Count + 1

			-- Í¨Öª¿Í»§¶Ë			
			BeginEvent(sceneId)				
				AddText(sceneId, "#{GodFire_Info_020}")				
			EndEvent(sceneId)
			DispatchMissionTips(sceneId,selfId)

			BeginEvent(sceneId)
				AddText(sceneId,x808082_g_MissionName)
				AddText(sceneId,x808082_g_MissionInfo)
				AddText(sceneId,"#{M_MUBIAO}#r")
				AddText(sceneId,"#{GodFire_Info_006}")				
				AddText(sceneId,"#{GodFire_Info_019}")				
			EndEvent( )					
			DispatchEventList(sceneId, selfId, targetId)
			
			-- LuaFnSendSpecificImpactToUnit( sceneId, selfId, selfId, selfId, x808082_g_Impact_Accept_Mission, 0 )
		end
	end

	return 1

end

--**********************************
--·ÅÆú,½ö¹©×ÓÈÎÎñµ÷ÓÃ
--**********************************
function x808082_OnAbandon( sceneId, selfId )
  
  --É¾³ıÍæ¼ÒÈÎÎñÁĞ±íÖĞ¶ÔÓ¦toÕ ğµ ÈÎÎñ,ÎïÆ·ºÍ×¤ÁôĞ§¹û
  if HaveItem(sceneId, selfId, x808082_g_ItemId.id) > 0 then
  	if LuaFnGetAvailableItemCount(sceneId, selfId, x808082_g_ItemId.id) >= x808082_g_ItemId.num then
  		DelItem( sceneId, selfId, x808082_g_ItemId.id, LuaFnGetAvailableItemCount(sceneId, selfId, x808082_g_ItemId.id) )
  	else
	  	x808082_NotifyTip( sceneId, selfId, "V§t ph¦m cüa các hÕ hi®n không dùng ğßşc ho£c ğã b¸ khóa." )			
			return 0
  	end
  end
  
  if HaveItem(sceneId, selfId, x808082_g_ItemBox_ItemID) > 0 then
  	if LuaFnGetAvailableItemCount(sceneId, selfId, x808082_g_ItemBox_ItemID) >= 1 then
  		DelItem( sceneId, selfId, x808082_g_ItemBox_ItemID, LuaFnGetAvailableItemCount(sceneId, selfId, x808082_g_ItemBox_ItemID) )
  	else
	  	x808082_NotifyTip( sceneId, selfId, "V§t ph¦m cüa các hÕ hi®n không dùng ğßşc ho£c ğã b¸ khóa." )			
			return 0
  	end
  end
  
  if LuaFnHaveImpactOfSpecificDataIndex(sceneId, selfId, x808082_g_Impact_Transport_Mission) ~= 0 then
  	LuaFnCancelSpecificImpact( sceneId, selfId, x808082_g_Impact_Transport_Mission )
  end
  
  if LuaFnHaveImpactOfSpecificDataIndex(sceneId, selfId, x808082_g_Impact_GodOfFire_Mission) ~= 0 then
  	LuaFnCancelSpecificImpact( sceneId, selfId, x808082_g_Impact_GodOfFire_Mission )
  end
  
  if IsHaveMission( sceneId, selfId, x808082_g_MissionId ) > 0 then
	 	DelMission( sceneId, selfId, x808082_g_MissionId )
	end
	
	return 0

end

--**********************************
--¼ÌĞø
--**********************************
function x808082_OnContinue( sceneId, selfId, targetId )
	
	--ÅĞ¶Ï¸ÃnpcĞúng·ñĞúng¶ÔÓ¦ÈÎÎñtoÕ ğµ npc
	if LuaFnGetName( sceneId, targetId ) ~= x808082_g_Name then
		x808082_NotifyTip( sceneId, selfId, "Nh§n nhi®m vø th¤t bÕi" )					
		return 0
	end

	-- ¼ì²éÈÎÎñĞúng·ñÍê³É
	if x808082_CheckSubmit( sceneId, selfId, targetId ) ~= 1 then			
		return 0
	end
	
	BeginEvent(sceneId)
		AddText(sceneId,x808082_g_MissionName)
		AddText( sceneId, x808082_g_MissionComplete )				
	EndEvent( )
	DispatchMissionContinueInfo(sceneId,selfId,targetId,x808082_g_ScriptId,x808082_g_MissionId)
	
end

--**********************************
--¼ì²âĞúng·ñ¿ÉÒÔÌá½»
--**********************************
function x808082_CheckSubmit( sceneId, selfId, targetId )

	if IsHaveMission( sceneId, selfId, x808082_g_MissionId ) <= 0 then
		x808082_TalkInfo( sceneId, selfId, targetId, "#{GodFire_Info_011}" )
		return 0
	end

	--¼ì²âµÈc¤p
	if LuaFnGetLevel( sceneId, selfId ) < x808082_g_PlayerSlow_LVL then		
		x808082_TalkInfo( sceneId, selfId, targetId, "#{GodFire_Info_013}" )
		return 0
	end

	--¼ì²âÍæ¼Ò²Î¼Ó»î¶¯toÕ ğµ Ê±¼ä
	local	nDayTime = GetMissionData( sceneId, selfId, MD_GODOFFIRE_DAYTIME )
	
	local nDay = LuaFnGetDayOfThisMonth()
	if nDayTime ~= nDay then
		x808082_TalkInfo( sceneId, selfId, targetId, "#{GodFire_Info_017}" )
		return 0
	end

	local misIndex = GetMissionIndexByID(sceneId,selfId,x808082_g_MissionId)
	local nTimePoint = x808082_CheckHuoDongTime()
	if nTimePoint ~= GetMissionParam(sceneId, selfId, misIndex, x808082_g_RoundIndex) then
		x808082_TalkInfo( sceneId, selfId, targetId, "#{GodFire_Info_024}" )
		return 0
	end
	
	-- ¼ì²âĞúng²»ĞúngÈÎÎñ·¢²¼NPC
	if GetMissionParam(sceneId, selfId, misIndex, x808082_g_AcceptNPC_Idx) == 1 then
		x808082_TalkInfo( sceneId, selfId, targetId, "#{GodFire_Info_025}" )
		return 0
	elseif GetMissionParam(sceneId, selfId, misIndex, x808082_g_AcceptNPC_Idx) == 2 then
		x808082_TalkInfo( sceneId, selfId, targetId, "#{GodFire_Info_026}" )
		return 0
	elseif GetMissionParam(sceneId, selfId, misIndex, x808082_g_AcceptNPC_Idx) ~= 3 then
		x808082_TalkInfo( sceneId, selfId, targetId, "#{GodFire_Info_027}" )
		return 0
	end
	
	--¼ì²âÍæ¼ÒĞúng·ñ×é¶Ó¸úËæ
	if IsTeamFollow( sceneId, selfId ) == 1 then
		x808082_TalkInfo( sceneId, selfId, targetId, "#{GCTeamFollowErrorHandler_Info_In_Mis_GodOfFire}" )		
		return 0
	end
	
	--¼ì²âĞúng·ñ´¦ÓÚË«ÈËÆï³Ë×´Ì¬
	if LuaFnGetDRideFlag(sceneId, selfId) ~= 0  then
		x808082_TalkInfo( sceneId, selfId, targetId, "#{ResultText_117}" )
		return 0
	end

	-- ¼ì²âÈÎÎñĞúng·ñÍê³É	
	if GetMissionParam(sceneId, selfId, misIndex, x808082_g_Mission_IsComplete) > 0 then
		return 1
	end
	
	return 0
	
end

--**********************************
--Ìá½»,½ö¹©×ÓÈÎÎñµ÷ÓÃ
--**********************************
function x808082_OnSubmit( sceneId, selfId, targetId, selectRadioId )
	
	--ÅĞ¶Ï¸ÃnpcĞúng·ñĞúng¶ÔÓ¦ÈÎÎñtoÕ ğµ npc
	if LuaFnGetName( sceneId, targetId ) ~= x808082_g_Name then
		x808082_NotifyTip( sceneId, selfId, "Trä nhi®m vø th¤t bÕi" )					
		return 0
	end

  -- ¼ì²éÈÎÎñĞúng·ñÍê³É
	if x808082_CheckSubmit( sceneId, selfId, targetId ) ~= 1 then
		x808082_NotifyTip( sceneId, selfId, "Trä nhi®m vø th¤t bÕi" )				
		return 0
	end
	
	local strText = ""
	x808082_g_GodFireMis_PaiMing = x808082_g_GodFireMis_PaiMing + 1

	if x808082_g_GodFireMis_PaiMing <= 3 then
		strText = format("#{_INFOUSR%s}#{GodFire_Info_029}%d#{GodFire_Info_030}", GetName(sceneId,selfId), x808082_g_GodFireMis_PaiMing )
		BroadMsgByChatPipe( sceneId, 0, strText, 4 )
		
		-- ÉèÖÃ¼«Æ··ÉÃ«ÍÈ³ÆºÅ
		if x808082_g_GodFire_Title == GetTitle( sceneId, selfId, 14 ) then
			DeleteTitle( sceneId, selfId, 14 )			
		end
		AwardTitle( sceneId, selfId, 14, x808082_g_GodFire_Title, 24 * x808082_GodFireTitle_AlongTime )
		SetCurTitle( sceneId, selfId, 14, x808082_g_GodFire_Title )
		DispatchAllTitle( sceneId, selfId )
	end

	local playerlvl = LuaFnGetLevel( sceneId, selfId )
	local nExpNum = x808082_g_BonusEXP_List[playerlvl]
	local nExpEx = x808082_g_BonusEXP_ListEX[x808082_g_GodFireMis_PaiMing]

	nExpNum = floor(nExpNum * nExpEx)
	LuaFnAddExp( sceneId, selfId, nExpNum )
	strText = format("#{_INFOUSR%s}#{GodFire_Info_031}%d#{GodFire_Info_032}%d.#{GodFire_Info_033}", GetName(sceneId,selfId), x808082_g_GodFireMis_PaiMing, nExpNum )
	x808082_TalkInfo( sceneId, selfId, targetId, strText )
	
	-- »î¶¯Ë³ÀûÍê³É
	x808082_NotifyTip( sceneId, selfId, "#{GodFire_Info_063}" )
	BroadMsgByChatPipe( sceneId, selfId, "#{GodFire_Info_063}", 8 )
	
	if IsHaveMission( sceneId, selfId, x808082_g_MissionId ) > 0 then
	 	DelMission( sceneId, selfId, x808082_g_MissionId )
	end
	
	x808082_DelMissionInfo( sceneId, selfId )

end

--**********************************
--É±ËÀ¹ÖÎï»òÍæ¼Ò
--**********************************
function x808082_OnKillObject( sceneId, selfId, objdataId ,objId)--²ÎÊıÒâË¼: ³¡¾°ºÅ¡¢Íæ¼ÒobjId¡¢¹ÖÎï±íÎ»ÖÃºÅ¡¢¹ÖÎï
end

--**********************************
--½øÈëÇøÓòÊÂ¼ş
--**********************************
function x808082_OnEnterArea( sceneId, selfId, zoneId )	
end

--**********************************
--µÀ¾ß¸Ä±ä
--**********************************
function x808082_OnItemChanged( sceneId, selfId, itemdataId )
end

--**********************************
--½ÓÈÎÎñºóÏÔÊ¾toÕ ğµ ½çÃæ
--**********************************
function x808082_AcceptDialog(sceneId, selfId, rand, g_Dialog, targetId )

	BeginEvent( sceneId )
		AddText( sceneId, g_Dialog )
	EndEvent( sceneId )
	DispatchEventList( sceneId, selfId, targetId )

end

--**********************************
--½»ÈÎÎñºóÏÔÊ¾toÕ ğµ ½çÃæ
--**********************************
function x808082_SubmitDialog( sceneId, selfId, rand )
end

--**********************************
--ĞÑÄ¿ÌáÊ¾
--**********************************
function x808082_NotifyTip( sceneId, selfId, msg )

	BeginEvent( sceneId )
		AddText( sceneId, msg )
	EndEvent( sceneId )
	DispatchMissionTips( sceneId, selfId )

end

--**********************************
--ÓëNPC¶Ô»°
--**********************************
function x808082_TalkInfo( sceneId, selfId, targetId, msg )

	BeginEvent(sceneId)
		AddText( sceneId, msg )
	EndEvent(sceneId)
	DispatchEventList(sceneId,selfId,targetId)

end

--**********************************
--È¡ ği¬m±¾ÊÂ¼ştoÕ ğµ MissionId,ÓÃÓÚobjÎÄ¼şÖĞ¶Ô»°Çé¾°toÕ ğµ ÅĞ¶Ï
--**********************************
function x808082_GetEventMissionId( sceneId, selfId )	
	return x808082_g_MissionId
end

function x808082_AcceptMission( sceneId, selfId, targetId )
	
	--ÅĞ¶Ï¸ÃnpcĞúng·ñĞúng¶ÔÓ¦ÈÎÎñtoÕ ğµ npc
	if LuaFnGetName( sceneId, targetId ) ~= x808082_g_Name then
		x808082_NotifyTip( sceneId, selfId, "Nh§n nhi®m vø th¤t bÕi" )
		return 0
	end

	local  PlayerName=GetName(sceneId,selfId)		
	
	--·¢ËÍÈÎÎñTiªp thøÊ±ÏÔÊ¾toÕ ğµ ĞÅÏ¢
	BeginEvent(sceneId)
		AddText(sceneId,x808082_g_MissionName)
		AddText( sceneId, x808082_g_MissionInfo )
		AddText(sceneId,"#{M_MUBIAO}")
		AddText(sceneId,"#{GodFire_Info_006}")
		AddText(sceneId,"#{M_SHOUHUO}")
		AddText(sceneId,"#{GodFire_Info_012}")
		
	EndEvent( )
	DispatchMissionInfo(sceneId,selfId,targetId,x808082_g_ScriptId,x808082_g_MissionId)	

end

--/////////////////////////////////////////////////////////////////////////////////////////////////////
--»ñÈ¡¾ßÌåitemtoÕ ğµ ÏêÏ¸ĞÅÏ¢
function x808082_GetItemDetailInfo(itemId)
	return 0
end	

--**********************************
--¼ì²â»î¶¯±¨ÃûÊ±¼ä
--**********************************
function x808082_CheckApplyTime()

	local nHour	 = GetHour()
	local nMinute = GetMinute()  
  local curHourTime = nHour*100+nMinute

	for i=1, getn(x808082_g_ActivityTime) do
	  if curHourTime >= x808082_g_ActivityTime[i].tstart and curHourTime < (x808082_g_ActivityTime[i].tstart+x808082_g_Along_Time) then
	  	return 1		
	  end
	end

	return 0
end

--**********************************
--¼ì²â»î¶¯Ê±¼ä
--**********************************
function x808082_CheckHuoDongTime()

	local nHour	 = GetHour()
	local nMinute = GetMinute()  
  local curHourTime = nHour*100+nMinute


	for i=1, getn(x808082_g_ActivityTime) do
	  if curHourTime >= x808082_g_ActivityTime[i].tstart and curHourTime <= x808082_g_ActivityTime[i].tend then
	  	return i		
	  end
	end

	return 0

end

--**********************************
--µÀ¾ßÊ¹ÓÃ
--**********************************
function x808082_OnUseItem( sceneId, selfId, bagIndex )	
end

--**********************************
--ËÀÍöÊÂ¼ş
--**********************************
function x808082_OnDie( sceneId, selfId, killerId )
	x808082_NotifyTip( sceneId, selfId, "#{GodFire_Info_034}" )
	x808082_DelMissionInfo( sceneId, selfId )
end

--**********************************
--É¾³ı»î¶¯ĞÅÏ¢
--É¾³ıÍæ¼ÒÈÎÎñÁĞ±íÖĞ¶ÔÓ¦toÕ ğµ ÈÎÎñ,ÎïÆ·ºÍ×¤ÁôĞ§¹û
--**********************************
function x808082_DelMissionInfo( sceneId, selfId )

  if HaveItem(sceneId, selfId, x808082_g_ItemId.id) > 0 then
  	if LuaFnGetAvailableItemCount(sceneId, selfId, x808082_g_ItemId.id) >= x808082_g_ItemId.num then
  		DelItem( sceneId, selfId, x808082_g_ItemId.id, LuaFnGetAvailableItemCount(sceneId, selfId, x808082_g_ItemId.id) )  	
  	end
  end
  
  if HaveItem(sceneId, selfId, x808082_g_ItemBox_ItemID) > 0 then
  	if LuaFnGetAvailableItemCount(sceneId, selfId, x808082_g_ItemBox_ItemID) >= 1 then
  		DelItem( sceneId, selfId, x808082_g_ItemBox_ItemID, LuaFnGetAvailableItemCount(sceneId, selfId, x808082_g_ItemBox_ItemID) )  	
  	end
  end
  
  if LuaFnHaveImpactOfSpecificDataIndex(sceneId, selfId, x808082_g_Impact_Transport_Mission) ~= 0 then
  	LuaFnCancelSpecificImpact( sceneId, selfId, x808082_g_Impact_Transport_Mission )
  end
  
  if LuaFnHaveImpactOfSpecificDataIndex(sceneId, selfId, x808082_g_Impact_GodOfFire_Mission) ~= 0 then
  	LuaFnCancelSpecificImpact( sceneId, selfId, x808082_g_Impact_GodOfFire_Mission )
  end
  
  if IsHaveMission( sceneId, selfId, x808082_g_MissionId ) > 0 then
  	x808082_NotifyTip( sceneId, selfId, "#{GodFire_Info_034}" )
	 	DelMission( sceneId, selfId, x808082_g_MissionId )
	end
	
	return 0

end

--**********************************
-- »ğ°ÑÌØĞ§ÓĞĞ§ÆÚµ½Ê±×Ô¶¯É¾³ıÈÎÎñĞÅÏ¢
--**********************************
-- function x808082_OnImpactFadeOut( sceneId, selfId, impactId )
-- 
-- 	if impactId == x808082_g_Impact_GodOfFire_Mission then
-- 		x808082_DelMissionInfo( sceneId, selfId )
-- 	end
-- 
-- end
