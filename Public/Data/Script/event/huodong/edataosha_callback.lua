--´óÌÓÉ±
--»Øµ÷½Å±¾

--½Å±¾ºÅ
x808003_g_ScriptId			= 808003

x808003_g_TickTime			= 60		--»Øµ÷½Å±¾toÕ ğµ Ê±ÖÓÊ±¼ä(µ¥Î»:  giây/´Î)
x808003_g_NotifyTime		= 29		--¹«¸æÊ±¼ä³¤¶È(µ¥Î»: Ê±ÖÓ ği¬mÊı)
x808003_g_JoinTime			= 3			--±¨ÃûÊ±¼ä³¤¶È(µ¥Î»: Ê±ÖÓ ği¬mÊı)
x808003_g_AttackTime		= 10		--±ÈÎäÊ±¼ä³¤¶È(µ¥Î»: Ê±ÖÓ ği¬mÊı)
x808003_g_IdleTime			= 2			--Ã¿ÂÖÖ®¼ätoÕ ğµ  tr¯ng ÏĞÊ±¼ä³¤¶È(µ¥Î»: Ê±ÖÓ ği¬mÊı)
x808003_g_RoundMax			= 5			--×î´ó»ØºÏÊı,¼´ÂúÔ±64ÈËtoÕ ğµ ÇéĞÎÏÂ
x808003_g_TParamNum			= 8			--±íµ¥²ÎÊıÊıÁ¿
x808003_g_CareResultMax	= 5			--×´ÔªÅÅÃûÊ±Ëù¹ØĞÄtoÕ ğµ ×î´óÈËÊı

--»î¶¯Êı¾İÇøË÷Òı
x808003_g_ActParam	=
{
	["tim"]	= 0,	--Ê±ÖÓ×Ü ği¬mÊı
	["pha"]	= 1,	--»î¶¯½×¶Î,»ØºÏÊı*10(1-6»ØºÏ) + »ØºÏ±ê¼Ç(1,±¨Ãû£»2,¿ªÊ¼£»0, tr¯ng ÏĞ)
	["tab"]	= 2,	--±íµ¥ID
	["unt"]	= 3,	--µ¥ÂÖÖ´ĞĞÊ±¼ä ği¬mÊı
	["minl"]= 4,	--c¤p±ğÏÂÏŞ
	["maxl"]= 5,	--c¤p±ğÉÏÏŞ
}

--ÏûÏ¢ÌáÊ¾
x808003_g_Msg				=
{
	["n_pre"]	= "#cff99ccHoÕt ğµng báo danh ĞÕi hµi tï võ nhóm #YğÆng c¤p %d#cff99cc#Y l¥n thÑ %d#cff99cc s¨ b¡t ğ¥u sau #Y%d phút#cff99cc næa, xin các v¸ chu¦n b¸.",
	["n_bgn"]	= "#cff99ccHoÕt ğµng báo danh ĞÕi hµi tÖ võ nhóm #YğÆng c¤p %d#cff99cc#Y l¥n thÑ %d#cff99cc ğã b¡t ğ¥u, Xin các v¸ nhanh chóng báo danh.",
	["n_end"]	= "#cff99ccHoÕt ğµng ĞÕi hµi tÖ võ nhóm #YğÆng c¤p %d#cff99cc ğªn ğây kªt thúc!",
	["n_bny"]	= "#cff99ccQuán Quân ğÕi hµi tÖ võ nhóm #YğÆng c¤p %d#cff99cc ğã có , phân chia thành: #W",
}

--»î¶¯×é±ğĞÅÏ¢
--»î¶¯ID,¶¨ÒåTÕi ¡¶ActivityNotice¡·±íÖĞ
x808003_g_Act				=
{
	--C¥n ÅäÖÃ¹«¸æ
	[1]	= { id=22, minLev=40, maxLev=49 },	--ÖÜÁù40c¤p±ğ×é
	[2]	= { id=23, minLev=40, maxLev=49 },	--ÖÜÈı40c¤p±ğ×é
	--²»C¥n ÅäÖÃ¹«¸æ
	[3]	= { id=30, minLev=50, maxLev=59 },
	[4]	= { id=31, minLev=50, maxLev=59 },
	[5]	= { id=32, minLev=60, maxLev=69 },
	[6]	= { id=33, minLev=60, maxLev=69 },
	[7]	= { id=34, minLev=70, maxLev=79 },
	[8]	= { id=35, minLev=70, maxLev=79 },
	[9]	= { id=44, minLev=80, maxLev=89 },
	[10]= { id=45, minLev=80, maxLev=89 },
	[11]= { id=46, minLev=90, maxLev=99 },
	[12]= { id=47, minLev=90, maxLev=99 },
	[13]= { id=124, minLev=100, maxLev=109 },
	[14]= { id=125, minLev=100, maxLev=109 },
	[15]= { id=126, minLev=110, maxLev=119 },
	[16]= { id=127, minLev=110, maxLev=119 },
}

--**********************************
--½Å±¾Èë¿Úº¯Êı
--C++»Øµ÷º¯Êı
--**********************************
function x808003_OnDefaultEvent( sceneId, actId, iNoticeType, param2, param3, param4, param5 )

	--mµt cái»î¶¯¶ÔÓ¦mµt cái×é±ğ
	local	ActInfo	= nil
	for i = 1, getn( x808003_g_Act ) do
		ActInfo			= x808003_g_Act[i]
		if ActInfo.id == actId then
			break
		else
			ActInfo		= nil
		end
	end
	if ActInfo == nil then	--Ã»ÓĞÕÒµ½Cái này ×é±ğtoÕ ğµ »î¶¯
		return
	end

	--²ÎÊıË ği¬m÷: ³¡¾°ID,»î¶¯ID,Ê±¼ä¼ä¸ô(ºÁ giây)
	StartOneActivity( sceneId, ActInfo.id, floor(x808003_g_TickTime*1000), iNoticeType )
	--×¢²áÅÅĞĞ°ñ±íµ¥,Çë×¢ÒâTÕi »î¶¯½áÊøÊ±ÊÍ·Å
	tabId	= HitParadeRegisterTab( sceneId )

	--»î¶¯Êı¾İÇø
	SetActivityParam( sceneId, ActInfo.id, x808003_g_ActParam["tim"], 0 )			--±£´æÊ±ÖÓ×Ü ği¬mÊı
	SetActivityParam( sceneId, ActInfo.id, x808003_g_ActParam["pha"], 0 )			--±£´æ»î¶¯½×¶Î
	SetActivityParam( sceneId, ActInfo.id, x808003_g_ActParam["tab"], tabId )	--±£´æ±íµ¥ID
	SetActivityParam( sceneId, ActInfo.id, x808003_g_ActParam["minl"], ActInfo.minLev )
	SetActivityParam( sceneId, ActInfo.id, x808003_g_ActParam["maxl"], ActInfo.maxLev )

	--Add Log
	LogInfo	= format( "[TAOSHA]: x808003_OnDefaultEvent( sceneId=%d, actId=%d, iNoticeType=%d ), tabId=%d, minLev=%d, maxLev=%d",
		sceneId, actId, iNoticeType, tabId, ActInfo.minLev, ActInfo.maxLev )
	MissionLog( sceneId, LogInfo )

end

--**********************************
--ĞÄÌøº¯Êı
--C++»Øµ÷º¯Êı
--**********************************
function x808003_OnTimer( sceneId, actId, uTime )

	--mµt cái»î¶¯¶ÔÓ¦mµt cái×é±ğ
	local	ActInfo	= nil
	for i = 1, getn( x808003_g_Act ) do
		ActInfo			= x808003_g_Act[i]
		if ActInfo.id == actId then
			break
		else
			ActInfo		= nil
		end
	end
	if ActInfo == nil then	--Ã»ÓĞÕÒµ½Cái này ×é±ğtoÕ ğµ »î¶¯
		return
	end

	local	m_actId	= actId

	--±íµ¥ID
	tabId	= GetActivityParam( sceneId, m_actId, x808003_g_ActParam["tab"] )
	if tabId < 0 then
		return
	end

	--»î¶¯Êı¾İÇø
	tim		= GetActivityParam( sceneId, m_actId, x808003_g_ActParam["tim"] )
	SetActivityParam( sceneId, m_actId, x808003_g_ActParam["tim"], tim+1 )	--±£´æÊ±ÖÓ×Ü ği¬mÊı

	--±£´æ»î¶¯½×¶Î,ÓÉÊ±¼ä»®·Ö: 
	--7: 00¹«¸æ
	--µÚmµt ´Î»î¶¯±¨Ãû7: 30,»î¶¯¿ªÊ¼7: 35,»î¶¯½áÊø7: 45.
	--µÚ¶ş´Î¿ªÊ¼±¨Ãû7: 50,»î¶¯¿ªÊ¼7: 55,»î¶¯½áÊø8: 05.
	--ÒÔºóÃ¿´Î»î¶¯±¨Ãû tr¯ng ÏĞÊ±¼ä5 phút,±¨Ãû5 phút,»î¶¯Ê±¼ä10 phút.
	local	tim_0		= x808003_g_NotifyTime	--²ÎÕÕÊ±¼ä ği¬m,¼´µÚmµt »ØºÏtoÕ ğµ ±¨ÃûÊ±¼ä
	local	tim_pnt	=
	{
		["jon"]	= 0,									--±¾»ØºÏtoÕ ğµ µÚ0cáiÊ±¼ä ği¬m¿ªÊ¼±¨Ãû
		["bgn"]	= x808003_g_JoinTime,	--±¾»ØºÏtoÕ ğµ µÚ5cáiÊ±¼ä ği¬m¿ªÊ¼±ÈÎä
		["end"]	= x808003_g_JoinTime + x808003_g_AttackTime,											--±¾»ØºÏtoÕ ğµ µÚ15cáiÊ±¼ä ği¬m½áÊø
		["idl"]	= x808003_g_JoinTime + x808003_g_AttackTime + x808003_g_IdleTime,	-- tr¯ng ÏĞÖÁµÚ20cáiÊ±¼ä ği¬m¿ªÊ¼ÏÂmµt »ØºÏ
	}
	local	tim_all	= tim_pnt["idl"]
	pha			= GetActivityParam( sceneId, m_actId, x808003_g_ActParam["pha"] )
	tmp_mul	= floor( (tim-tim_0) / tim_all )
	tmp_mod	=	(tim-tim_0) - tmp_mul * tim_all
	local	str
	
	if tmp_mul > x808003_g_RoundMax then
		x808003_OnActivityEnd( sceneId, m_actId, tabId )
		--È«Çò¹«¸æ
		str		= format( x808003_g_Msg["n_end"], ActInfo.minLev )
		x808003_MyGlobalNews( sceneId, str )
		return
	end
	
	--µ¥ÂÖÖ´ĞĞÊ±¼ä ği¬mÊı
	if tmp_mod < 0 or tmp_mod >= tim_all then
		SetActivityParam( sceneId, m_actId, x808003_g_ActParam["unt"], 0 )
	else
		SetActivityParam( sceneId, m_actId, x808003_g_ActParam["unt"], tmp_mod )
	end

	--»î¶¯½ø¶È
	if pha == 0 then	--µÚmµt »ØºÏ
	
		--»î¶¯Ô¤±¨
		if tim == floor(tim_0-x808003_g_IdleTime) then
			str	= format( x808003_g_Msg["n_pre"], ActInfo.minLev, 1, x808003_g_IdleTime )
			--È«Çò¹«¸æ
			x808003_MyGlobalNews( sceneId, str )
		end

		--¿ªÊ¼±¨Ãû
		if tim >= tim_0 then
			SetActivityParam( sceneId, m_actId, x808003_g_ActParam["pha"], (tmp_mul+1)*10+1 )
			str	= format( x808003_g_Msg["n_bgn"], ActInfo.minLev, (tmp_mul+1) )
			--È«Çò¹«¸æ
			x808003_MyGlobalNews( sceneId, str )
			--±íµ¥³õÊ¼»¯
			for i = 0, x808003_g_TParamNum do
				HitParadeSetTabParam( sceneId, tabId, i, 0 )
			end
		end

	else
		if tmp_mod == tim_pnt["jon"] then					--±¨ÃûÖĞ
			SetActivityParam( sceneId, m_actId, x808003_g_ActParam["pha"], (tmp_mul+1)*10+1 )
			
			if tmp_mul >= 1 then
				--»î¶¯ÅÅÃû,Tr· v«Ê¤³öÈËÊı,µÈÓÚ1Ê±¹Ú¾ü²úÉú
				if x808003_OnActivitySort( sceneId, m_actId, tabId ) > 1 then
					--¼ÌĞøÏÂÂÖ±ÈÎä
					str	= format( x808003_g_Msg["n_bgn"], ActInfo.minLev, (tmp_mul+1) )
					--È«Çò¹«¸æ
					x808003_MyGlobalNews( sceneId, str )
					--±íµ¥³õÊ¼»¯
					for i = 0, x808003_g_TParamNum do
						HitParadeSetTabParam( sceneId, tabId, i, 0 )
					end
				end
			end

		elseif tmp_mod == tim_pnt["bgn"] then			--±ÈÎäÖĞ
			SetActivityParam( sceneId, m_actId, x808003_g_ActParam["pha"], (tmp_mul+1)*10+2 )
		elseif tmp_mod == tim_pnt["end"] then			-- tr¯ng ÏĞÖĞ
			SetActivityParam( sceneId, m_actId, x808003_g_ActParam["pha"], (tmp_mul+1)*10 )
		elseif tmp_mod == (tim_pnt["end"]+2) then	-- tr¯ng ÏĞÖĞ
			str		= format( x808003_g_Msg["n_pre"], ActInfo.minLev, (tmp_mul+2), (x808003_g_IdleTime-2) )
			--È«Çò¹«¸æ
			x808003_MyGlobalNews( sceneId, str )
		end

	end

end

--**********************************
--»î¶¯ÅÅÃû,Tr· v«Ê¤³öÈËÊı,µÈÓÚ1Ê±¹Ú¾ü²úÉú
--**********************************
function x808003_OnActivitySort( sceneId, actId, tabId )

	--mµt cái»î¶¯¶ÔÓ¦mµt cái×é±ğ
	local	ActInfo	= nil
	for i = 1, getn( x808003_g_Act ) do
		ActInfo			= x808003_g_Act[i]
		if ActInfo.id == actId then
			break
		else
			ActInfo		= nil
		end
	end
	if ActInfo == nil then	--Ã»ÓĞÕÒµ½Cái này ×é±ğtoÕ ğµ »î¶¯
		return 0
	end

	local	m_actId	= actId

	--²ÎÕÕÅÅĞĞ¼üÖµ,½µĞòÅTiêu Dao¨¼üÖµÔ½´ó,ÅÅÃûÔ½¿¿Ç°)
	HitParadeSort( sceneId, tabId )
	--»ñÈ¡µ±Ç°±¨ÃûÈËÊı
	local	jon_num	= HitParadeGetTabInfo( sceneId, tabId )
	if jon_num == nil then
		return 0
	else
		--Add Log
		LogInfo	= format( "[TAOSHA]: HitParadeGetTabInfo( sceneId=%d, tabId=%d ), JoinNum=%d",
			sceneId, tabId, jon_num )
		MissionLog( sceneId, LogInfo )
		--×î¶à¼ì²éÇ°5Ãû¾Í×ã¹»
		if jon_num > x808003_g_CareResultMax then
			jon_num		= x808003_g_CareResultMax
		end
	end
	--»ñÈ¡²ÎÈü³É¼¨
	local	no1_num	= 0
	local	guid		= {}
	local	key			= {}
	for i = 0, jon_num do
		guid[i], key[i]	= HitParadeGetPlyInfo( sceneId, tabId, i )
		--Add Log
		if guid[i] ~= nil and key[i] ~= nil then
			LogInfo	= format( "[TAOSHA]: HitParadeGetPlyInfo( sceneId=%d, tabId=%d, i=%d ), GUID=%0X, key=%d",
				sceneId, tabId, i, guid[i], key[i] )
		else
			LogInfo	= format( "[TAOSHA]: HitParadeGetPlyInfo( sceneId=%d, tabId=%d, i=%d ), GUID=NIL, key=NIL",
				sceneId, tabId, i )
		end
		MissionLog( sceneId, LogInfo )
	end

	--»ñÈ¡¹Ú¾üÈËÊı,¾ö¶¨ËÄÇ¿Èü
	for i = 0, jon_num do
		if guid[i] == nil then
			break
		end
		if key[i] ~= nil and key[i] == key[0] and mod( key[i], 3 ) > 0 then
			no1_num		= no1_num + 1
		else
			break
		end
	end

	--ÔİÊ±Î´ÄÜÑ¡³öËÄÇ¿,¼ÌĞø½øĞĞÏÂmµt ÂÖ
	if no1_num > 4 then
		return no1_num
	end

	--¹Ú¾üÊ¤³ö,»î¶¯½áÊø
	local	name1, name2
	if no1_num <= 1 then
		--½±ÀøÈı¼×
		if key[0] ~= nil and mod( key[0], 3 ) > 0 then
			x808003_OnPlyBounty( sceneId, guid[0], 1, tabId )
		else
			guid[0]	= nil
		end
		if key[1] ~= nil and mod( key[1], 3 ) > 0 then
			x808003_OnPlyBounty( sceneId, guid[1], 2, tabId )
		else
			guid[1]	= nil
		end
		if key[2] ~= nil and mod( key[2], 3 ) > 0 then
			x808003_OnPlyBounty( sceneId, guid[2], 3, tabId )
		else
			guid[2]	= nil
		end
		--»î¶¯½áÊø
		x808003_OnActivityEnd( sceneId, m_actId, tabId )
		--È«Çò¹«¸æ
		name1	= x808003_GetPlyName( sceneId, guid[0] )
		name2	= x808003_GetPlyName( sceneId, guid[1] )
		str		= format( x808003_g_Msg["n_bny"], ActInfo.minLev )
		x808003_MyGlobalNews( sceneId, str.." TrÕng Nguyên "..name1..", Bäng Nhãn "..name2.."." )

	--¼´½«¿ªÊ¼¾öÈü
	elseif no1_num == 2 then

	--¼´½«¿ªÊ¼ËÄÇ¿Èü,µ±È»Ò²ĞíÖ»ÓĞÈıÇ¿
	elseif no1_num <= 4 then

	end
	return no1_num

end

--**********************************
--»î¶¯½áÊø
--**********************************
function x808003_OnActivityEnd( sceneId, actId, tabId )

	local	m_actId	= actId

	SetActivityParam( sceneId, m_actId, x808003_g_ActParam["pha"], 0 )			--±£´æ»î¶¯½×¶Î
	SetActivityParam( sceneId, m_actId, x808003_g_ActParam["tab"], -1 )			--±£´æ±íµ¥ID
	StopOneActivity( sceneId, m_actId )
	HitParadeReleaseTab( sceneId, tabId )
	
	--Add Log
	LogInfo	= format( "[TAOSHA]: x808003_OnActivityEnd( sceneId=%d, actId=%d, tabId=%d )",
		sceneId, actId, tabId )
	MissionLog( sceneId, LogInfo )

end

--**********************************
--¸ù¾İÍæ¼ÒµÈc¤p»ñÈ¡×é±ğĞÅÏ¢
--**********************************
function x808003_GetGroupInfo( sceneId, selfId )

	if LuaFnIsObjValid( sceneId, selfId ) ~= 1 then
		return nil
	end

	local	lev			= GetLevel( sceneId, selfId )
	local	ActInfo	= nil
	local	minl		= 0
	local	maxl		= 0
	for i = 1, getn( x808003_g_Act ) do
		ActInfo			= x808003_g_Act[i]
		minl				= GetActivityParam( sceneId, ActInfo.id, x808003_g_ActParam["minl"] )
		maxl				= GetActivityParam( sceneId, ActInfo.id, x808003_g_ActParam["maxl"] )
		if lev >= ActInfo.minLev and	--ÊÊºÏµÈc¤p
			lev <= ActInfo.maxLev and
			minl > 0 and								--´Ë»î¶¯ÒÑM· ra 
			maxl > 0 then
			break
		else
			ActInfo		= nil
		end
	end
	if ActInfo == nil then	--Ã»ÓĞÕÒµ½Cái này ×é±ğtoÕ ğµ »î¶¯
		return nil
	end
	return ActInfo.id, ActInfo.minLev, ActInfo.maxLev

end

--**********************************
--Ğúng·ñ´¦TÕi ±¨Ãû½×¶Î
--**********************************
function x808003_IsJoinDoing( sceneId, selfId )

	local	ActID, _, _	= x808003_GetGroupInfo( sceneId, selfId )
	if ActID == nil then
		return 0
	end

	ret	= GetActivityParam( sceneId, ActID, x808003_g_ActParam["pha"] )
	ret	= ret - floor(ret/10) * 10
	if ret == 1 then
		return 1
	end
	return 0

end

--**********************************
--»ñÈ¡±íµ¥ID
--**********************************
function x808003_GetTableID( sceneId, selfId )

	local	ActID, _, _	= x808003_GetGroupInfo( sceneId, selfId )
	if ActID == nil then
		return 0
	end

  return GetActivityParam( sceneId, ActID, x808003_g_ActParam["tab"] )

end

--**********************************
--»ñÈ¡±ÈÎä»ØºÏÊı
--**********************************
function x808003_GetRound( sceneId, selfId )

	local	ActID, _, _	= x808003_GetGroupInfo( sceneId, selfId )
	if ActID == nil then
		return 0
	end

	ret	= GetActivityParam( sceneId, ActID, x808003_g_ActParam["pha"] )
	return floor(ret/10)

end

--**********************************
--»ñÈ¡µ¥ÂÖÖ´ĞĞÊ±¼ä
--**********************************
function x808003_GetCurrentUnitTime( sceneId, selfId, TickTime )

	local	ActID, _, _	= x808003_GetGroupInfo( sceneId, selfId )
	if ActID == nil then
		return 0
	end

	tim	= GetActivityParam( sceneId, ActID, x808003_g_ActParam["unt"] )
	ret	= floor( tim * x808003_g_TickTime / TickTime )
	return ret

end

--**********************************
--»ñÈ¡mµt cái»ØºÏÖĞtoÕ ğµ ±¨ÃûÊ±¼ä³¤¶È
--**********************************
function x808003_GetJoinTime( sceneId, TickTime )

	--¸Ãº¯ÊıÖ»ÄÜÊ¹ÓÃÈ«¾Ö±äÁ¿Óëº¯Êı´«²Î
	--Ô­Òò: ±¨Ãû³¡¾°(Tô Châu)¡¢±ÈÎä³¡¾°(¸±±¾)TÕi ²»Í¬Ïß³Ì,¸Ãº¯Êı»áTÕi ²»Í¬³¡¾°Ëù¹ÒÆğtoÕ ğµ ½Å±¾ÖĞµ÷ÓÃ
	ret	= floor( x808003_g_JoinTime * x808003_g_TickTime / TickTime )
	return ret

end

--**********************************
--»ñÈ¡mµt cái»ØºÏÖĞtoÕ ğµ ±ÈÎäÊ±¼ä³¤¶È
--**********************************
function x808003_GetAttackTime( sceneId, TickTime )

	--¸Ãº¯ÊıÖ»ÄÜÊ¹ÓÃÈ«¾Ö±äÁ¿Óëº¯Êı´«²Î
	--Ô­Òò: ±¨Ãû³¡¾°(Tô Châu)¡¢±ÈÎä³¡¾°(¸±±¾)TÕi ²»Í¬Ïß³Ì,¸Ãº¯Êı»áTÕi ²»Í¬³¡¾°Ëù¹ÒÆğtoÕ ğµ ½Å±¾ÖĞµ÷ÓÃ
	ret	= floor( x808003_g_AttackTime * x808003_g_TickTime / TickTime )
	return ret

end

--**********************************
--¸ù¾İGUID»ñÈ¡Íæ¼ÒÃû³Æ
--**********************************
function x808003_GetPlyName( sceneId, guid )

	--Íæ¼ÒĞúng·ñTÕi ¸Ã³¡¾°
	if guid == nil then
		return "[ tr¯ng ]"
	end
	ObjId		= LuaFnGuid2ObjId( sceneId, guid )
	if LuaFnIsObjValid( sceneId, ObjId ) ~= 1 then
		str		= format( "[%0X]", guid )
		return str
	end

	objNam	= GetName( sceneId, ObjId )
	if objNam ~= nil then
		str		= "#{_INFOUSR"..objNam.."}"
	else
		str		= "[ tr¯ng ]"
	end
	return str

end

--**********************************
--Èı¼×½±Àø
--**********************************
function x808003_OnPlyBounty( sceneId, guid, place, tabId )

	--Ö»¹ØĞÄÇ°Èı¼×
	if place < 1 or place > 3 then
		return
	end
	--Íæ¼ÒĞúng·ñTÕi ¸Ã³¡¾°
	if guid == nil then
		return
	end

	--¼ì²é²ÎÈü³É¼¨
	local	guid_tmp
	local	key_tmp
	local	isFind				= 0
	for i = 0, x808003_g_CareResultMax do
		guid_tmp, key_tmp	= HitParadeGetPlyInfo( sceneId, tabId, i )
		if guid_tmp ~= nil and key_tmp ~= nil and guid_tmp == guid then
			isFind					= 1
		end
	end
	if isFind == 0 then
		--Add Log
		LogInfo	= format( "[TAOSHA]: x808003_OnPlyBounty( sceneId=%d, GUID=%0X ), Not Find",
			sceneId,
			guid )
		MissionLog( sceneId, LogInfo )
		return
	end

	ObjId		= LuaFnGuid2ObjId( sceneId, guid )
	if LuaFnIsObjValid( sceneId, ObjId ) ~= 1 then
		--Add Log
		LogInfo	= format( "[TAOSHA]: x808003_OnPlyBounty( sceneId=%d, GUID=%0X ), Not OnScene",
			sceneId,
			guid )
		MissionLog( sceneId, LogInfo )
		return
	end

	local	lev		= GetLevel( sceneId, ObjId )
	local	gold	= 0
	--×´Ôª
	if place == 1 then
		gold	= lev * 1000
	
	--°ñÑÛ
	elseif place == 2 then
		gold	= lev * 500
	
	--Ì½»¨
	elseif place == 3 then
		gold	= lev * 200

	end

	--½ğÇ®½±Àø
	AddMoney( sceneId, ObjId, gold )

	--ÎïÆ·½±Àø
	local	item_lst	=
	{
		--×´Ôª,¶şc¤p±¦Ê¯
		{ 50201001, 50201002, 50211001, 50211002 },
		--°ñÑÛ,¶şc¤p±¦Ê¯
		{ 50201001, 50201002, 50211001, 50211002 },
		--Ì½»¨,mµt c¤p±¦Ê¯
		{ 50101001, 50101002, 50111001, 50111002 },
	}
	local	item_unt	= item_lst[place]
	local	item_rnd	= random( getn( item_unt ) )
	local	item_nam	= GetItemName( sceneId, item_unt[item_rnd] )
	if item_nam ~= nil then
		x808003_MsgBox( sceneId, ObjId, "ĞÕt ğßşc "..item_nam )
	end

	local nBagIndex	= LuaFnTryRecieveItem( sceneId, ObjId, item_unt[item_rnd], 1 )
	local	szTranEqp	= nil
	if  nBagIndex == -1 then
		x808003_MsgBox( sceneId, ObjId, "R¤t tiªc, không gian tay näi không ğü" )
	else
		szTranEqp			= GetBagItemTransfer( sceneId, ObjId, nBagIndex )
	end

	-- Danh hi®u½±Àø
	local	title_lst	=
	{
		{ 136,	"#PTÖ Võ TrÕng Nguyên" },		--×´Ôª
		{ 137,	"#PTÖ Võ Bäng Nhãn" },		--°ñÑÛ
		{ 138,	"#PTÖ Võ Thám Hoa" },		--Ì½»¨
	}
	local	title			= title_lst[place]
	x808003_MsgBox( sceneId, ObjId, "ĞÕt ğßşc "..title[2].." Danh hi®u" )
	LuaFnAwardTitle( sceneId, ObjId, 7, title[1], 7*24 )	-- Danh hi®utoÕ ğµ ÓĞĞ§ÆÚmµt ÖÜ,UsefulLifeµ¥Î»Ğ¡Ê±
	LuaFnDispatchAllTitle( sceneId, ObjId )								--¸üĞÂËùÓĞ Danh hi®uµ½CLIENT
	
	local	strMsg
	local	rndMsg		= random( 3 )
	if szTranEqp ~= nil then
		if rndMsg == 1 then	
		  strMsg	= format( "#W#{_INFOUSR%s}#cff99cc trong ğÕi hµi tÖ võ ğã áp ğäo qu¥n hùng, khiªn thiên hÕ anh hùng khen ngşi không ng¾t, ğÕt t¾i danh hi®u #Y%s#cff99cc trong thÑc trao giäi các ngß¶i üng hµ nhi®t tình ğã gØi lên #W#{_INFOMSG%s}#cff99cc và #W#{_MONEY%d}#cff99cc tö lòng yêu thích. ",
		  	LuaFnGetName( sceneId, ObjId ),
		  	title[2],
		  	szTranEqp, gold )
		elseif rndMsg == 2 then
			strMsg	= format( "#W#{_INFOUSR%s}#cff99cc · ğÕi hµi tÖ võ l¥n này ğã bi¬u hi®n xu¤t chúng, kinh ngÕc ğªn tri«u ğình, ban thß·ng riêng Danh hi®u #W%s#cff99cc cùng #W#{_INFOMSG%s}#cff99cc và #W#{_MONEY%d}#cff99cc ğ¬ th¬ hi®n hoàng ân.",
				LuaFnGetName( sceneId, ObjId ),
				title[2],
				szTranEqp, gold )
		else
			strMsg	= format( "#W#{_INFOUSR%s}#cff99cc do ğoÕt ğßşc danh hi®u #W%s#cff99cc trong ğÕi hµi tÖ võ này ğã làm cho các môn phái ğßşc dß½ng danh giang h°, chß·ng môn môn phái này r¤t là hài lòng, lÕi t£ng thêm #W#{_INFOMSG%s}#cff99cc và #W#{_MONEY%d}#cff99cc l¤y công ğó làm gß½ng sáng. ",
				LuaFnGetName( sceneId, ObjId ),
				title[2],
				szTranEqp, gold )
		end
		x808003_MyGlobalNews( sceneId, strMsg )
	end

end

--**********************************
--ĞÑÄ¿ÌáÊ¾
--**********************************
function x808003_MsgBox( sceneId, selfId, Msg )

	if Msg == nil then
		return
	end
	--Ğúng·ñ´¦ÓÚÎŞ·¨Ö´ĞĞÂß¼­toÕ ğµ ×´Ì¬
	if LuaFnIsCanDoScriptLogic( sceneId, selfId ) ~= 1 then
		return
	end

	BeginEvent( sceneId )
		AddText( sceneId, Msg )
	EndEvent( sceneId )
	DispatchMissionTips( sceneId, selfId )
	--Add Log
	LogInfo	= format( "[TAOSHA]: x808003_MsgBox( sceneId=%d, GUID=%0X ), %s",
		sceneId,
		LuaFnObjId2Guid( sceneId, selfId ),
		Msg )
	MissionLog( sceneId, LogInfo )

end

--**********************************
--È«Çò¹«¸æ
--**********************************
function x808003_MyGlobalNews( sceneId, Msg )

	if Msg == nil then
		return
	end

	AddGlobalCountNews( sceneId, Msg )
	--Add Log
	MissionLog( sceneId, "[TAOSHA]: "..Msg )

end
