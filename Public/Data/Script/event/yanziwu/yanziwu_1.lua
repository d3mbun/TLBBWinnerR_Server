--401040

-- Ñà×ÓÎë¸±±¾

--************************************************************************
--MisDescBegin
--½Å±¾ºÅ
x401040_g_ScriptId = 401040
x401040_g_Name = "Lý Cß½ng"


--MisDescEnd
--************************************************************************
x401040_TIME_2000_01_03_ = 946828868

x401040_g_SceneData_1 = 8   -- ¼ÇÂ¼¸±±¾Ë¢¹Öµ½µÚ¼¸Åú

x401040_g_SceneData_3 = 9	-- 
x401040_g_SceneData_4 = 10	-- 
x401040_g_SceneData_5 = 11	-- 
x401040_g_SceneData_6 = 12	-- 

x401040_g_SceneData_7 = 13	-- Íæ¼ÒµÈc¤p

x401040_g_SD_Monster_1 	 = 14			-- ÔÝÎ´Ê¹ÓÃ
x401040_g_SD_Monster_1_T = 15			-- ÔÝÎ´Ê¹ÓÃ


x401040_g_SD_Monster_2 	 = 16
x401040_g_SD_Monster_2_T = 17
x401040_g_SD_Monster_3 	 = 18
x401040_g_SD_Monster_3_T = 19

x401040_g_KillMonsCount_Qincheng = 20
x401040_g_KillMonsCount_Qinjia 	 = 21
x401040_g_KillMonsCount_Lama		 = 22

x401040_g_SkillSign = 23 	-- ¹«Ò±¸É¡¢µË°Ù´¨¡¢°ü²»Í¬ºÍ·ç²¨¶ñ ÆäÖÐmµt cáiÈËËÀºó,±ðÈË¿ñ±©±ê¼Ç

-- ÍõÓïÑÔ¿ªÊ¼ ði¬mÃûtoÕ ðµ ¿ª¹Ø
x401040_g_bWangyuyanSpeak = 24
x401040_g_bWangyuyanSpeak_T = 27

-- ¹Ø±Õ¸±±¾toÕ ðµ Ê±¼ä¼ÇÂ¼
x401040_g_CloseTime = 25

-- ¸±±¾th¤t bÕitoÕ ðµ ±ê¼Ç
x401040_g_MissionLost = 26

-- ¿ØÖÆH® th¯ngÌáÊ¾toÕ ðµ Ê±¼ä
x401040_g_SystemTipsTime = 28

-- ¿ØÖÆ ÍõÓïæÌÊÜµ½ÉËº¦ºó,ÍõÓïæÌºÍÐoàn DñtoÕ ðµ ¶Ô»°
x401040_g_DuanAndWangFlag = 29

--¸±±¾Ãû³Æ
x401040_g_CopySceneName = "Yªn TØ ‘"
x401040_g_CopySceneType = FUBEN_DAZHAN_YZW	--¸±±¾ÀàÐÍ,¶¨ÒåTÕi ScriptGlobal.luaÀïÃæ
x401040_g_CopySceneMap = "yanziwu.nav"
x401040_g_LimitMembers = 1				--¿ÉÒÔ½ø¸±±¾toÕ ðµ ×îÐ¡¶ÓÎéÈËÊý
x401040_g_TickTime = 1						--»Øµ÷½Å±¾toÕ ðµ Ê±ÖÓÊ±¼ä(µ¥Î»:  giây/´Î)
x401040_g_LimitTotalHoldTime = 360--¸±±¾¿ÉÒÔ´æ»îtoÕ ðµ Ê±¼ä(µ¥Î»: ´ÎÊý),Èç¹û´ËÊ±¼äµ½ÁË,ÔòÈÎÎñ½«»áth¤t bÕi
x401040_g_LimitTimeSuccess = 500	--¸±±¾Ê±¼äÏÞÖÆ(µ¥Î»: ´ÎÊý),Èç¹û´ËÊ±¼äµ½ÁË,ÈÎÎñÍê³É
x401040_g_CloseTick = 3						--¸±±¾¹Ø±ÕÇ°µ¹¼ÆÊ±(µ¥Î»: ´ÎÊý)
x401040_g_NoUserTime = 300				--¸±±¾ÖÐÃ»ÓÐÈËºó¿ÉÒÔ¼ÌÐø±£´ætoÕ ðµ Ê±¼ä(µ¥Î»:  giây)
x401040_g_DeadTrans = 0						--ËÀÍö×ªÒÆÄ£Ê½,0: ËÀÍöºó»¹¿ÉÒÔ¼ÌÐøTÕi ¸±±¾,1: ËÀÍöºó±»Ç¿ÖÆÒÆ³ö¸±±¾
x401040_g_Fuben_X = 177						--½øÈë¸±±¾toÕ ðµ Î»ÖÃX
x401040_g_Fuben_Z = 234						--½øÈë¸±±¾toÕ ðµ Î»ÖÃZ
x401040_g_Back_X = 70							--Ô´³¡¾°Î»ÖÃX
x401040_g_Back_Z = 120						--Ô´³¡¾°Î»ÖÃZ
x401040_g_Back_SceneId = 4				--Ô´³¡¾°Id

x401040_g_Npc_1 = {	
-- ËÎ¾üÊ¿±ø
--{id=9210,x=171,y=236,camp=109,ai=21,af=222},{id=9210,x=175,y=236,camp=109,ai=21,af=222},
--{id=9210,x=179,y=236,camp=109,ai=21,af=222},{id=9210,x=183,y=236,camp=109,ai=21,af=222},
{id=9210,x=175,y=202,camp=109,ai=21,af=222},{id=9210,x=181,y=202,camp=109,ai=21,af=222},
{id=9210,x=172,y=152,camp=109,ai=21,af=222},{id=9210,x=173,y=158,camp=109,ai=21,af=222},
{id=9210,x=146,y=151,camp=109,ai=21,af=222},{id=9210,x=151,y=154,camp=109,ai=21,af=222},
{id=9210,x=137,y=177,camp=109,ai=21,af=222},{id=9210,x=133,y=175,camp=109,ai=21,af=222},
{id=9210,x=109,y=162,camp=109,ai=21,af=222},{id=9210,x=104,y=164,camp=109,ai=21,af=222},
{id=9210,x=82 ,y=176,camp=109,ai=21,af=222},{id=9210,x=77 ,y=176,camp=109,ai=21,af=222},
{id=9210,x=53 ,y=157,camp=109,ai=21,af=222},{id=9210,x=58 ,y=156,camp=109,ai=21,af=222},
{id=9210,x=76 ,y=210,camp=109,ai=21,af=222},{id=9210,x=80 ,y=210,camp=109,ai=21,af=222},
{id=9210,x=86 ,y=210,camp=109,ai=21,af=222},{id=9210,x=91 ,y=210,camp=109,ai=21,af=222},
{id=9210,x=211,y=146,camp=109,ai=21,af=222},{id=9210,x=214,y=146,camp=109,ai=21,af=222},
{id=9210,x=217,y=146,camp=109,ai=21,af=222},{id=9210,x=220,y=146,camp=109,ai=21,af=222},
{id=9210,x=223,y=146,camp=109,ai=21,af=222},

-- mµt Æ·ÌÃÎäÊ¿
{id=9240,x=175,y=152,camp=110,ai=21,af=226},{id=9240,x=149,y=150,camp=110,ai=21,af=226},
{id=9240,x=147,y=146,camp=110,ai=21,af=226},{id=9240,x=135,y=174,camp=110,ai=21,af=226},
{id=9240,x=133,y=171,camp=110,ai=21,af=226},{id=9240,x=135,y=177,camp=110,ai=21,af=226},
{id=9240,x=105,y=161,camp=110,ai=21,af=226},{id=9240,x=108,y=159,camp=110,ai=21,af=226},
{id=9240,x=80 ,y=173,camp=110,ai=21,af=226},{id=9240,x=81 ,y=177,camp=110,ai=21,af=226},
{id=9240,x=55 ,y=155,camp=110,ai=21,af=226},{id=9240,x=52 ,y=154,camp=110,ai=21,af=226},
{id=9240,x=58 ,y=155,camp=110,ai=21,af=226},

-- Ñà×ÓÎë×¯¶¡
{id=9280,x=209,y=80 ,camp=110,ai=21,af=239},{id=9280,x=222,y=79 ,camp=110,ai=21,af=239},
{id=9280,x=218,y=69 ,camp=110,ai=21,af=239},{id=9280,x=228,y=64 ,camp=110,ai=21,af=239},
{id=9280,x=228,y=52 ,camp=110,ai=21,af=239},{id=9280,x=217,y=39 ,camp=110,ai=21,af=239},
{id=9280,x=186,y=31 ,camp=110,ai=21,af=239},{id=9280,x=181,y=36 ,camp=110,ai=21,af=239},
{id=9280,x=176,y=42 ,camp=110,ai=21,af=239},{id=9280,x=176,y=52 ,camp=110,ai=21,af=239},
{id=9280,x=136,y=93 ,camp=110,ai=21,af=239},{id=9280,x=140,y=88 ,camp=110,ai=21,af=239},
{id=9280,x=137,y=82 ,camp=110,ai=21,af=239},{id=9280,x=144,y=86 ,camp=110,ai=21,af=239},
{id=9280,x=143,y=101,camp=110,ai=21,af=239},{id=9280,x=141,y=111,camp=110,ai=21,af=239},
{id=9280,x=148,y=112,camp=110,ai=21,af=239},{id=9280,x=146,y=103,camp=110,ai=21,af=239},
{id=9280,x=154,y=110,camp=110,ai=21,af=239},

-- Á¬åóËþ
{id=9290,x=234,y=30 ,camp=110,ai=21,af=223},{id=9290,x=225,y=25 ,camp=110,ai=21,af=223},
{id=9290,x=175,y=41 ,camp=110,ai=21,af=223},{id=9290,x=179,y=45 ,camp=110,ai=21,af=223},
{id=9290,x=172,y=48 ,camp=110,ai=21,af=223},{id=9290,x=171,y=52 ,camp=110,ai=21,af=223},
{id=9290,x=170,y=57 ,camp=110,ai=21,af=223},{id=9290,x=167,y=61 ,camp=110,ai=21,af=223},
}

-- ºôÑÓÇì ºôÑÓ±ª
x401040_g_Npc_2 = {	{id=9200,x=177,y=232,script=402240,camp=0,ai=3,af=-1},
									 	{id=9220,x=79, y=202,script=402241,camp=109,ai=21,af=220}
}

-- ºôÑÓÇìÉíºóÓÐ¶Ô»°toÕ ðµ ËÎ±ø
x401040_g_Npc_2_1={	{id=9210,x=171,y=236,camp=109,ai=21,af=222,script=402262},
										{id=9210,x=175,y=236,camp=109,ai=21,af=222,script=402262},
										{id=9210,x=179,y=236,camp=109,ai=21,af=222,script=402262},
										{id=9210,x=183,y=236,camp=109,ai=21,af=222,script=402262},
}

-- ÔÀÀÏÈý
x401040_g_Npc_3 = {	{id=9340,	x=81,y=197,	script=402242,camp=110,ai=21,af=227}
}

-- ÔÀÀÏÈý ¸½´øtoÕ ðµ Ð¡¹Ö (mµt Æ·ÌÃÎäÊ¿)
x401040_g_Npc_3_1={	{id=9240,x=79,y=195,camp=110,ai=21,af=226},
										{id=9240,x=77,y=207,camp=110,ai=21,af=226},
										{id=9240,x=82,y=195,camp=110,ai=21,af=226},
										{id=9240,x=86,y=206,camp=110,ai=21,af=226},
}

-- Ò¶¶þÄï ÔÆÖÐº×
x401040_g_Npc_4 = {	{id=9330,x=77,y=195,script=402244,camp=110,ai=21,af=228},
										{id=9350,x=83,y=198,script=402243,camp=110,ai=21,af=229},
}                                                
                                                 
-- ¶ÎÑÓÇì
x401040_g_Npc_5 = {	{id=9320,x=81,y=195,script=402245,camp=110,ai=21,af=230},
}

-- Ç®ºêÓî »ªºÕôÞ
x401040_g_Npc_6 = {	{id=9230,x=217,y=150,script=402246,camp=109,ai=21,af=221},
										{id=9480,x=179,y=91	,script=402249,camp=0,ai=3,af=-1},
}

-- ¿ÉÒÔÓÉÍæ¼ÒÐÞÀítoÕ ðµ Á¬åóËþ
x401040_g_Npc_7 = {	{id=9290,x=210,y=155,script=402247, name="Ti«n",camp=0,ai=3,af=-1},
										{id=9290,x=225,y=138,script=402247, name="H§u",camp=0,ai=3,af=-1},
										{id=9300,x=225,y=155,script=402247, name="",camp=0,ai=3,af=-1},
										{id=9310,x=209,y=138,script=402247, name="",camp=0,ai=3,af=-1},
}

-- ºÍ ºôÑÓ±ª ¶Ô»°ºó,²»¶ÏÊä³ötoÕ ðµ Ð¡¹Ö (mµt Æ·ÌÃÎäÊ¿)
x401040_g_Npc_8 = {	{id=9240,x=79,y=195,script=-1,camp=110,ai=21,af=226},
										{id=9240,x=77,y=207,script=-1,camp=110,ai=21,af=226},
										{id=9240,x=82,y=195,script=-1,camp=110,ai=21,af=226},
										{id=9240,x=86,y=206,script=-1,camp=110,ai=21,af=226},
}

-- ºÍÇ®ºêÓî¶Ô»°ºó,²»¶ÏË¢³ötoÕ ðµ Ð¡¹Ö
x401040_g_Npc_9 = {	{id=9250,x=233,y=214,script=402258,pp=0,camp=110,ai=21,af=231},
										{id=9250,x=236,y=214,script=402258,pp=1,camp=110,ai=21,af=231},
										{id=9250,x=235,y=217,script=402258,pp=2,camp=110,ai=21,af=231},
										{id=9250,x=238,y=216,script=402258,pp=3,camp=110,ai=21,af=231},
										{id=9250,x=237,y=219,script=402258,pp=4,camp=110,ai=21,af=231},
}

-- Ä¾ÈË¿þÀÜTÕi  Ë«Êý´ÎË¢
x401040_g_Npc_9_1={	{id=9530,x=237,y=219,script=402259,pp=4,camp=110,ai=21,af=233}}

-- Çà³ÇÅÉµÜ×Ó,TÕi 50µ½100Ë¢³ö
x401040_g_Npc_9_2 = {	
										{id=9260,x=233,y=214,script=402257,pp=0,camp=110,ai=21,af=232},
										{id=9260,x=236,y=214,script=402257,pp=1,camp=110,ai=21,af=232},
										{id=9260,x=235,y=217,script=402257,pp=2,camp=110,ai=21,af=232},
										{id=9260,x=238,y=216,script=402257,pp=3,camp=110,ai=21,af=232},
										{id=9260,x=237,y=219,script=402257,pp=4,camp=110,ai=21,af=232},
}

-- ºÍÇ®ºêÓî¶Ô»°ºó,²»¶ÏË¢³ötoÕ ðµ  ÍÂÞ¬À®Âï
x401040_g_Npc_10= {	{id=9270,x=233,y=214,script=402260,pp=0,camp=110,ai=21,af=234},
										{id=9270,x=236,y=214,script=402260,pp=1,camp=110,ai=21,af=234},
										{id=9270,x=235,y=217,script=402260,pp=2,camp=110,ai=21,af=234},
										{id=9270,x=238,y=216,script=402260,pp=2,camp=110,ai=21,af=234},
										{id=9270,x=237,y=219,script=402260,pp=2,camp=110,ai=21,af=234},
}

-- ºÍÇ®ºêÓî¶Ô»°ºó,Ò¦²®µ±,Ë¾ÂíÁÖ,Cßu Ma Trí (Cßu Ma Trí ÓÐ½Å±¾)
x401040_g_Npc_11= {	{id=9360,x=233,y=214,script=402248,pp=0,camp=110,ai=21,af=235},
										{id=9370,x=233,y=214,script=402248,pp=0,camp=110,ai=21,af=236},
										{id=9380,x=233,y=214,script=402248,pp=0,camp=110,ai=21,af=237},
}

-- ¹«Ò±¸É µË°Ù´¨ °ü²»Í¬ ·ç²¨¶ñ
--x401040_g_Npc_12= {	{id=9390,x=130,y=112,script=402250,camp=110,ai=21,af=240},
--										{id=9400,x=126,y=109,script=402251,camp=110,ai=21,af=241},
--										{id=9410,x=126,y=112,script=402252,camp=110,ai=21,af=242},
--										{id=9420,x=126,y=115,script=402253,camp=110,ai=21,af=243},
--}
x401040_g_Npc_12= {	{id=9390,x=130,y=112,script=402250,camp=110,ai=21,af=241},
										{id=9400,x=126,y=109,script=402251,camp=110,ai=21,af=241},
										{id=9410,x=126,y=112,script=402252,camp=110,ai=21,af=241},
										{id=9420,x=126,y=115,script=402253,camp=110,ai=21,af=241},
}

-- Mµ Dung Phøc
x401040_g_Npc_13 ={	{id=9430,x=63,y=67,	script=402254,camp=110,ai=25,af=244},
}

-- Íõ cô nß½ng ,Ðoàn Dñ µÈÈË
x401040_g_Npc_14= {	{id=9450,x=76,y=67,	script=402255,camp=0,ai=26,af=-1},
										{id=9440,x=76,y=64,	script=402256,camp=0,ai=27,af=245},
										{id=9460,x=79,y=70,	script=402249,camp=0,ai=27,af=247},
										{id=9470,x=79,y=69,	script=402249,camp=0,ai=27,af=248},
										{id=9490,x=79,y=68,	script=402249,camp=0,ai=27,af=249},
										{id=9500,x=79,y=67,	script=402249,camp=0,ai=27,af=250},
										{id=9510,x=79,y=66,	script=402249,camp=0,ai=27,af=251},
										{id=9520,x=79,y=65,	script=402249,camp=0,ai=27,af=252},
}

-- ºÍMµ Dung Phøc¿ªÕ½ºótoÕ ðµ  Ñà×ÓÎë×¯¶¡ ¿ª¹Öºó²»¶ÏË¢³ötoÕ ðµ ¼Ò¶¡
x401040_g_Npc_15=	{	}
--										{id=9280,x=60,y=55,	script=-1,camp=110,ai=21,af=239},
--										{id=9280,x=66,y=55,	script=-1,camp=110,ai=21,af=239},
--										{id=9280,x=60,y=63,	script=-1,camp=110,ai=21,af=239},
--										{id=9280,x=66,y=63,	script=-1,camp=110,ai=21,af=239},
--}

-- Mµ Dung PhøcÉí±ßtoÕ ðµ ±³¾°,Ã¿´ÎMµ Dung PhøcÍÑÀëCuµc chiªn ºó,¶¼»áÖØÐÂË¢
x401040_g_Npc_16=	{	}
--										{id=9280,x=61,y=63,	script=-1,camp=110,ai=21,af=239},
--										{id=9280,x=63,y=63,	script=-1,camp=110,ai=21,af=239},
--										{id=9280,x=65,y=63,	script=-1,camp=110,ai=21,af=239},
--										{id=9280,x=59,y=61,	script=-1,camp=110,ai=21,af=239},
--										{id=9280,x=61,y=61,	script=-1,camp=110,ai=21,af=239},
--										{id=9280,x=63,y=61,	script=-1,camp=110,ai=21,af=239},
--										{id=9280,x=65,y=61,	script=-1,camp=110,ai=21,af=239},
--										{id=9280,x=67,y=61,	script=-1,camp=110,ai=21,af=239},
--}

--**********************************
--ÈÎÎñÈë¿Úº¯Êý
--**********************************
function x401040_OnDefaultEvent( sceneId, selfId, targetId )
	
	if GetNumText() == 1   then
		BeginEvent(sceneId)
			AddText(sceneId,"#{yanziwu_info}");
		EndEvent(sceneId)
		DispatchEventList(sceneId,selfId,targetId)
		return
	end
	
	if GetName(sceneId, targetId) ~= x401040_g_Name  then
		return
	end

	-- ¸ù¾ÝÍæ¼ÒtoÕ ðµ Çé¿ö,½«Íæ¼ÒËÍµ½²»Í¬toÕ ðµ ¸±±¾
	-- 2,¼ì²âÍæ¼ÒÐúng²»Ðúng×é¶ÓÁË
	if GetTeamSize(sceneId,selfId) < x401040_g_LimitMembers then
		BeginEvent(sceneId)
			AddText(sceneId,"  N½i này r¤t nguy hi¬m nªu không ðü 3 ngß¶i ta không dám ð¬ các ngß½i vào");
		EndEvent(sceneId)
		DispatchEventList(sceneId,selfId,targetId)
		return
	end

	-- 3,¼ì²âÍæ¼ÒÐúng²»Ðúng¶Ó³¤
	if GetTeamLeader(sceneId,selfId) ~= selfId then
		BeginEvent(sceneId)
			AddText(sceneId,"#BNgß½i không phäi là trß·ng nhóm");
			AddText(sceneId,"  g÷i nhóm trß·ng cüa ngß½i t¾i ðây");
		EndEvent(sceneId)
		DispatchEventList(sceneId,selfId,targetId)
		return
	end

	-- 4,¼ì²âÐúng²»ÐúngÈË¶¼µ½Î»ÁË
	if GetTeamSize(sceneId,selfId) ~= GetNearTeamCount(sceneId,selfId)  then
		BeginEvent(sceneId)
			AddText(sceneId,"#BNhóm cüa ngß½i không ðü thành viên");
			AddText(sceneId,"  Yªn tØ ‘ là n½i r¤t mÕnh, ngß½i không th¬ vào khi không có lñc lßþng phòng b¸ t¯t");
		EndEvent(sceneId)
		DispatchEventList(sceneId,selfId,targetId)
		return
	end

	--5,¼ì²â¶ÓÎéÀïÍ·toÕ ðµ Ã¿cáiÍæ¼ÒÐúng²»Ðúng¶¼µ½60c¤pÁË
	local nPlayerNum = GetNearTeamCount(sceneId,selfId)

	for i=0, nPlayerNum-1  do
		local nPlayerId = GetNearTeamMember(sceneId,selfId, i)
		
		if GetLevel(sceneId,nPlayerId) < 60  then
			BeginEvent(sceneId)
				AddText(sceneId,"#BThäo phÕt Yªn TØ ‘");
				AddText(sceneId,"  ´Tr§n chiªn r¤t nguy hi¬m dß¾i c¤p 60 ta không th¬ cho ngß½i vào");
			EndEvent(sceneId)
			DispatchEventList(sceneId,selfId,targetId)
			
			return
		end
	end

	-- Ã¿ÌìÖ»ÄÜ3´Î
-- MD_YANZIWU_TIMES			=	195  -- Ã¿Ìì½øÈëÑà×ÓÎëtoÕ ðµ ´ÎÊý
-- MD_PRE_YANZIWU_TIME		=	196  -- ÉÏmµt ´ÎÈ¥Ñà×ÓÎëtoÕ ðµ Ê±¼ä

	local strName = {}
	strName[1] = ""
	strName[2] = ""
	strName[3] = ""
	strName[4] = ""
	strName[5] = ""
	strName[6] = ""

	local nPlayerNum = GetNearTeamCount(sceneId,selfId)
	local bOk = 1
	for i=0, nPlayerNum-1  do
		local nPlayerId = GetNearTeamMember(sceneId,selfId, i)
		
		local nTimes = GetMissionData(sceneId,nPlayerId, MD_YANZIWU_TIMES) 
		local nPreTime = GetMissionData(sceneId,nPlayerId, MD_PRE_YANZIWU_TIME)
		local nCurTime = LuaFnGetCurrentTime()
		if (nCurTime - nPreTime  >= 3600*24)  or
			 (floor((nCurTime-x401040_TIME_2000_01_03_)/(3600*24)) ~= floor((nPreTime-x401040_TIME_2000_01_03_)/(3600*24)))   then
			nTimes = 0
			nPreTime = nCurTime
			SetMissionData(sceneId, nPlayerId, MD_YANZIWU_TIMES, nTimes)
			SetMissionData(sceneId, nPlayerId, MD_PRE_YANZIWU_TIME, nPreTime)
		end
		
		if nTimes >= 10 then
			bOk = 0
			strName[i+1] = GetName(sceneId, nPlayerId)
		end
		
	end
	local nCount = 0

	if bOk == 0  then
		local szAllName = ""
		for i=1, 6  do
			if strName[i] ~= ""  then
				if nCount == 0  then
					szAllName = strName[i]
				else
					szAllName = szAllName .. ", " .. strName[i]
				end
				nCount = nCount+1
			end
		end
		BeginEvent(sceneId)
			AddText(sceneId,"#BThäo phÕt Yªn TØ ‘");
			AddText(sceneId,"  Thành viên trong ðµi ngü " .. szAllName .. " hôm nay ðã tham gia 3 l¥n Thäo phÕt Yªn TØ ‘.");
		EndEvent(sceneId)
		DispatchEventList(sceneId,selfId,targetId)
		return
	
	end
	
	-- ËùÓÐtoÕ ðµ ¼ì²âÍ¨¹ý,
	x401040_MakeCopyScene(sceneId, selfId)
	
	BeginUICommand(sceneId)
	EndUICommand(sceneId)
	DispatchUICommand(sceneId,selfId, 1000)
	
end

--**********************************
--ÁÐ¾ÙÊÂ¼þ
--**********************************
function x401040_OnEnumerate( sceneId, selfId, targetId )
	-- ×îºÃTÕi ÕâÀï×ömµt cáiTênÅÐ¶¨
	if GetName(sceneId, targetId) == x401040_g_Name  then
		AddNumText( sceneId, x401040_g_ScriptId, "Thäo phÕt Yªn TØ ‘",10 ,-1  )
		AddNumText( sceneId, x401040_g_ScriptId, "Liên quan thäo phÕt Yªn TØ ‘",8 ,1  )
	end
end

--**********************************
--¼ì²âTiªp thøÌõ¼þ
--**********************************
function x401040_CheckAccept( sceneId, selfId )
	
end

--**********************************
--Ñ¯ÎÊÍæ¼ÒÐúng·ñÒª½øÈë¸±±¾
--**********************************
function x401040_AskEnterCopyScene( sceneId, selfId )
	
end

--**********************************
--Tiªp thø
--**********************************
function x401040_OnAccept( sceneId, selfId, targetId )
	
end

--**********************************
--Íæ¼ÒÍ¬Òâ½øÈë¸±±¾
--**********************************
function x401040_AcceptEnterCopyScene( sceneId, selfId )
	
end

--**********************************
--´´½¨¸±±¾
--**********************************
function x401040_MakeCopyScene( sceneId, selfId )
	
	-- Ê¹ÓÃÐµi viên toÕ ðµ µÈc¤pÀ´Ëã³ö¹ÖÎïtoÕ ðµ µÈc¤p
	local param0 = 4;
	local param1 = 3;

	--×îÖÕ½á¹û
	local mylevel = 0;

	--ÁÙÊ±±äÁ¿
	local memId;
	local tempMemlevel = 0;
	local level0 = 0;
	local level1 = 0;
	local i;
	
	local nearmembercount = GetNearTeamCount(sceneId,selfId)
	for	i = 0, nearmembercount - 1 do
		memId = GetNearTeamMember(sceneId, selfId, i);
		tempMemlevel = GetLevel(sceneId, memId);
		level0 = level0 + (tempMemlevel ^ param0);
		level1 = level1 + (tempMemlevel ^ param1);
	end
	
	if level1 == 0 then
		mylevel = 0
	else
		mylevel = level0/level1;
	end
	
	if nearmembercount == -1  then  --Ã»ÓÐ¶ÓÎé
		mylevel = GetLevel(sceneId, selfId)
	end
	
	leaderguid=LuaFnObjId2Guid(sceneId,selfId)
	LuaFnSetSceneLoad_Map(sceneId, "yanziwu.nav"); --µØÍ¼Ðúng±ØÐëÑ¡È¡toÕ ðµ ,¶øÇÒ±ØÐëTÕi Config/SceneInfo.iniÀïÅäÖÃºÃ
	LuaFnSetCopySceneData_TeamLeader(sceneId, leaderguid);
	LuaFnSetCopySceneData_NoUserCloseTime(sceneId, x401040_g_NoUserTime*1000);
	LuaFnSetCopySceneData_Timer(sceneId, x401040_g_TickTime*1000);
	LuaFnSetCopySceneData_Param(sceneId, 0, x401040_g_CopySceneType);--ÉèÖÃ¸±±¾Êý¾Ý,ÕâÀï½«0ºÅË÷ÒýtoÕ ðµ Êý¾ÝÉèÖÃÎª999,ÓÃÓÚ±íÊ¾¸±±¾ºÅ999(Êý×Ö×Ô¶¨Òå)
	LuaFnSetCopySceneData_Param(sceneId, 1, x401040_g_ScriptId);--½«1ºÅÊý¾ÝÉèÖÃÎª¸±±¾³¡¾°ÊÂ¼þ½Å±¾ºÅ
	LuaFnSetCopySceneData_Param(sceneId, 2, 0);		--ÉèÖÃ¶¨Ê±Æ÷µ÷ÓÃ´ÎÊý
	LuaFnSetCopySceneData_Param(sceneId, 3, -1);	--ÉèÖÃ¸±±¾Èë¿Ú³¡¾°ºÅ, ³õÊ¼»¯
	LuaFnSetCopySceneData_Param(sceneId, 4, 0);		--ÉèÖÃ¸±±¾¹Ø±Õ±êÖ¾, 0¿ª·Å,1¹Ø±Õ
	LuaFnSetCopySceneData_Param(sceneId, 5, 0);		--ÉèÖÃÀë¿ªµ¹¼ÆÊ±´ÎÊý
	LuaFnSetCopySceneData_Param(sceneId, 6, GetTeamId(sceneId,selfId)); --±£´æ¶ÓÎéºÅ
	LuaFnSetCopySceneData_Param(sceneId, 7, 0) ;	--É±ËÀBosstoÕ ðµ ÊýÁ¿
	
	-- ¾çÇéÓÃµ½toÕ ðµ ±äÁ¿Çå¿Õ
	for i=8, 31 do
		LuaFnSetCopySceneData_Param(sceneId, i, 0)
	end
	
	local PlayerMaxLevel = GetHumanMaxLevelLimit()
	local iniLevel;
	if mylevel < 10 then
		iniLevel = 1;
	elseif mylevel < PlayerMaxLevel then
		iniLevel = floor(mylevel/10);
	else
		iniLevel = 10;
	end

	-- Ê¹ÓÃµÚ13Î»,¼ÇÂ¼¹ÖÎïÊµ¼ÊtoÕ ðµ µÈc¤p
	LuaFnSetCopySceneData_Param(sceneId, x401040_g_SceneData_7, mylevel)
	
	--ÉèÖÃ³¡¾°ÖÐtoÕ ðµ ¸÷ÖÖNpcºÍÇøÓò
	LuaFnSetSceneLoad_Area( sceneId, "yanziwu_area.ini" )
	LuaFnSetSceneLoad_Monster( sceneId, "yanziwu_monster.ini" )

	local bRetSceneID = LuaFnCreateCopyScene(sceneId); --³õÊ¼»¯Íê³Éºóµ÷ÓÃ´´½¨¸±±¾º¯Êý
	BeginEvent(sceneId)
		if bRetSceneID>0 then
			AddText(sceneId,"D¸ch chuy¬n thành công");
		else
			AddText(sceneId,"D¸ch chuy¬n th¤t bÕi");
		end
	EndEvent(sceneId)
	DispatchMissionTips(sceneId,selfId)
	
end

--**********************************
--¸±±¾ÊÂ¼þ
--**********************************
function x401040_OnCopySceneReady( sceneId, destsceneId )

	--½øÈë¸±±¾toÕ ðµ ¹æÔò
	-- 1,Èç¹ûCái này ÎÄ¼þÃ»ÓÐ×é¶Ó,¾Í´«ËÍCái này Íæ¼Ò×Ô¼º½øÈë¸±±¾
	-- 2, Èç¹ûÍæ¼ÒÓÐ¶ÓÎé,µ«ÐúngÍæ¼Ò²»Ðúng¶Ó³¤,¾Í´«ËÍ×Ô¼º½øÈë¸±±¾
	-- 3,Èç¹ûÍæ¼ÒÓÐ¶ÓÎé,²¢ÇÒCái này Íæ¼ÒÐúng¶Ó³¤,¾Í´«ËÍ×Ô¼ººÍ¸½½ü¶ÓÓÑmµt Æð½øÈ¥

	LuaFnSetCopySceneData_Param(destsceneId, 3, sceneId) --ÉèÖÃ¸±±¾Èë¿Ú³¡¾°ºÅ
	leaderguid  = LuaFnGetCopySceneData_TeamLeader(destsceneId)
	leaderObjId = LuaFnGuid2ObjId(sceneId,leaderguid)
	
	if LuaFnIsCanDoScriptLogic( sceneId, leaderObjId ) ~= 1 then			-- ´¦ÓÚÎÞ·¨Ö´ÐÐÂß¼­toÕ ðµ ×´Ì¬
		return
	end
	
	-- ¼ì²âÍæ¼ÒÐúng²»ÐúngÓÐ¶ÓÎé
	if LuaFnHasTeam( sceneId, leaderObjId ) == 0  then   -- Ã»ÓÐ¶ÓÎé
		x401040_GotoScene(sceneId, leaderObjId, destsceneId)
	else
		if IsCaptain(sceneId, leaderObjId) == 0  then
			x401040_GotoScene(sceneId, leaderObjId, destsceneId)
		else
			local	nearteammembercount = GetNearTeamCount( sceneId, leaderObjId) 
			local mems = {}
			for	i=0,nearteammembercount-1 do
				mems[i] = GetNearTeamMember(sceneId, leaderObjId, i)
				x401040_GotoScene(sceneId, mems[i], destsceneId)
			end
		end
	end

end

function x401040_GotoScene(sceneId, ObjId, destsceneId)
	NewWorld( sceneId, ObjId, destsceneId, x401040_g_Fuben_X, x401040_g_Fuben_Z) ;
end


--**********************************
--ÓÐÍæ¼Ò½øÈë¸±±¾ÊÂ¼þ
--**********************************
function x401040_OnPlayerEnter( sceneId, selfId )
	-- 3,ÉèÖ giâyÀÍöÊÂ¼þ
	
	-- ÉèÖÃÍæ¼ÒtoÕ ðµ ÕóÓªÎª 109
	SetUnitCampID(sceneId, selfId, selfId, 109)
	SetPlayerDefaultReliveInfo( sceneId, selfId, "%10", -1, "0", sceneId, x401040_g_Fuben_X, x401040_g_Fuben_Z )
	
	local nTimes = GetMissionData(sceneId,selfId, MD_YANZIWU_TIMES) 
	local nPreTime = GetMissionData(sceneId,selfId, MD_PRE_YANZIWU_TIME)
	local nCurTime = LuaFnGetCurrentTime()
	
	SetMissionData(sceneId, selfId, MD_YANZIWU_TIMES, nTimes+1) 
	SetMissionData(sceneId, selfId, MD_PRE_YANZIWU_TIME, nCurTime)
	
end

--**********************************
--ÓÐÍæ¼ÒTÕi ¸±±¾ÖÐËÀÍöÊÂ¼þ
--**********************************
function x401040_OnHumanDie( sceneId, selfId, killerId )
	
end

--**********************************
--·ÅÆú
--**********************************
function x401040_OnAbandon( sceneId, selfId )
	
end

--**********************************
--¼ÌÐø
--**********************************
function x401040_OnContinue( sceneId, selfId, targetId )
	
end	

--**********************************
--¼ì²âÐúng·ñ¿ÉÒÔÌá½»
--**********************************
function x401040_CheckSubmit( sceneId, selfId, selectRadioId )
	
end

--**********************************
--Ìá½»
--**********************************
function x401040_OnSubmit( sceneId, selfId, targetId, selectRadioId )
	
end

--**********************************
--É±ËÀ¹ÖÎï»òÍæ¼Ò
--**********************************
function x401040_OnDie( sceneId, objId, killerId )
	
end

--**********************************
--ÌáÊ¾ËùÓÐ¸±±¾ÄÚÍæ¼Ò
--**********************************
function x401040_TipAllHuman( sceneId, Str )
	--  ðÕt ðßþc³¡¾°ÀïÍ·toÕ ðµ ËùÓÐÈË
	local nHumanNum = LuaFnGetCopyScene_HumanCount(sceneId)
	
	-- Ã»ÓÐÈËtoÕ ðµ ³¡¾°,Ê²Ã´¶¼²»×ö
	if nHumanNum < 1 then
		return
	end
	
	for i=0, nHumanNum-1  do
		local PlayerId = LuaFnGetCopyScene_HumanObjId(sceneId, i)
		BeginEvent(sceneId)
			AddText(sceneId, Str)
		EndEvent(sceneId)
		DispatchMissionTips(sceneId, PlayerId)
	end
end

--**********************************
--É±ËÀ¹ÖÎï»òÍæ¼Ò
--**********************************
function x401040_OnKillObject( sceneId, selfId, objdataId, objId )
	
end

--**********************************
--½øÈëÇøÓòÊÂ¼þ
--**********************************
function x401040_OnEnterZone( sceneId, selfId, zoneId )
	
end

--**********************************
--µÀ¾ß¸Ä±ä
--**********************************
function x401040_OnItemChanged( sceneId, selfId, itemdataId )
	
end

--**********************************
--Ã¿mµt ¹ØtoÕ ðµ H® th¯ngÌáÊ¾ Ã¿¸ô15 giâyÓÉH® th¯ng·¢³öÃ¿mµt ¹ØtoÕ ðµ ÌáÊ¾ÐÅÏ¢
--**********************************
function x401040_SystemTips( sceneId, nStep )
	if nStep == 1  then
		x401040_TipAllHuman(sceneId, "H° Diên Báo tß¶ng quân ðang · trên kÏ hÕm chính")
		x401040_TipAllHuman(sceneId, "Các hÕ phäi dùng thu§t khinh công ði trên lá sen ð¬ có th¬ ðªn kÏ hÕm chính")
	elseif nStep == 2  then
		x401040_TipAllHuman(sceneId, "Có r¤t nhi«u võ lâm cao thü t¾i tiªp vi®n Mµ Dung phän t£c")
		x401040_TipAllHuman(sceneId, "Nhanh chóng tìm ðªn hi®p trþ Ti«n Hoành Vû tß¾ng quân ngån ch£n phän t£c vi®n quân")
	elseif nStep == 3  then
		x401040_TipAllHuman(sceneId, "Có r¤t nhi«u võ lâm cao thü t¾i tiªp vi®n Mµ Dung phän t£c")
		x401040_TipAllHuman(sceneId, "Nhanh chóng tìm ðªn hi®p trþ Ti«n Hoành Vû tß¾ng quân ngån ch£n phän t£c vi®n quân")
	end
end

--**********************************
--¸±±¾³¡¾°¶¨Ê±Æ÷ÊÂ¼þ
--**********************************
function x401040_OnCopySceneTimer( sceneId, nowTime )
	
	local nStep = LuaFnGetCopySceneData_Param(sceneId, x401040_g_SceneData_1);
	--PrintNum(nStep)
	-- nStep == 12 Ðúng¸±±¾ÈÎÎñth¤t bÕi±ê¼Ç,½øÈëµ½ÕâÀï,Íæ¼ÒÖ»ÄÜ³ö¸±±¾ÁË,Ã»ÓÐ±ðtoÕ ðµ ÊÂÇé¿É×÷
	if nStep == 13  then
		-- Ö´ÐÐ10 giâyºó°ÑÍæ¼Ò´«³ö³¡¾°toÕ ðµ Âß¼­
		return
	end
	--PrintNum(nStep)
	-- ÔÀÀÏÈý°éËæÐ¡¹ÖtoÕ ðµ ÅúÊý	
	local nTime = LuaFnGetCurrentTime()

	if nStep == 0  then
		x401040_CreateMonster_1(sceneId)
	end
	
	--  ðÕt ðßþcÉÏmµt ´ÎtoÕ ðµ H® th¯ngÌáÊ¾Ê±¼ä
	local nPreSystemTime = LuaFnGetCopySceneData_Param(sceneId, x401040_g_SystemTipsTime)
	if nStep == 1  then
		if nTime-nPreSystemTime >= 15  then
			x401040_SystemTips( sceneId, 1 )
			LuaFnSetCopySceneData_Param(sceneId, x401040_g_SystemTipsTime, nTime)
		end
	end
	
	if nStep == 2  then
		x401040_CreateMonster_2(sceneId)
		LuaFnSetCopySceneData_Param(sceneId, x401040_g_SceneData_1, 3)
	end
	
--	-- ¿ØÖÆË¢°éËæÔÀÀÏÈýtoÕ ðµ Ð¡¹Ö
--	if nStep >=3 and nStep<9  then
--		local nStep1 = LuaFnGetCopySceneData_Param(sceneId, x401040_g_SD_Monster_1)
--		local nPreTime=LuaFnGetCopySceneData_Param(sceneId, x401040_g_SD_Monster_1_T)
--		if nStep1 < 2  then
--			if nTime-nPreTime >= 40  then
--				LuaFnSetCopySceneData_Param(sceneId, x401040_g_SD_Monster_1, nStep1+1)
--				LuaFnSetCopySceneData_Param(sceneId, x401040_g_SD_Monster_1_T,nTime)
--				-- Ë¢¹Ö
--				x401040_CreateMonster_6(sceneId)
--			end
--		end
--	end
	
	if nStep == 4  then
		x401040_CreateMonster_3(sceneId)
		LuaFnSetCopySceneData_Param(sceneId, x401040_g_SceneData_1, 5)
	end
	
	if nStep == 6  then
		x401040_CreateMonster_5(sceneId)
		LuaFnSetCopySceneData_Param(sceneId, x401040_g_SceneData_1, 7)
	end
	
	-- ¶ÎÑÓÇìËÀÍö,É¾³ý "mµt Æ·ÌÃÎäÊ¿","Ò¶¶þÄï", "ÔÆÖÐº×"
	if nStep == 9  then
		--PrintNum(nStep)
		x401040_ClearMonsterByName(sceneId, "Nh¤t Ph¦m Ðß¶ng Võ Sî")
		x401040_TipAllHuman(sceneId, "Ðoàn Diên Khánh chiªn bÕi, thü hÕ cùng nh¤t ph¦m ðß¶ng võ sî ð«u ðào t¦u.")
		
		x401040_ClearMonsterByName(sceneId, "Di®p Nh¸ Nß½ng")
		x401040_ClearMonsterByName(sceneId, "Vân Trung HÕc")
		
		LuaFnSetCopySceneData_Param(sceneId, x401040_g_SceneData_1, 10)
	end

	--  ðÕt ðßþcÉÏmµt ´ÎtoÕ ðµ H® th¯ngÌáÊ¾Ê±¼ä
	local nPreSystemTime = LuaFnGetCopySceneData_Param(sceneId, x401040_g_SystemTipsTime)
	if nStep == 10  then
		if nTime-nPreSystemTime >= 15  then
			x401040_SystemTips( sceneId, 2 )
			LuaFnSetCopySceneData_Param(sceneId, x401040_g_SystemTipsTime, nTime)
		end
	end
	
	-- Ë¢°´ÕÕÂ·ÏßÑ²ÂßtoÕ ðµ Ð¡¹Ö
	if nStep == 11  then
		local nStep1 = LuaFnGetCopySceneData_Param(sceneId, x401040_g_SD_Monster_2)
		local nPreTime=LuaFnGetCopySceneData_Param(sceneId, x401040_g_SD_Monster_2_T)
		
		if nStep1 == 0  then
			-- ×ª»» Ç®ºêÓî toÕ ðµ ÕóÓª
			local nNpcNum = GetMonsterCount(sceneId)
			for i=0, nNpcNum-1 do
				local nNpcId = GetMonsterObjID(sceneId,i)
				if GetName(sceneId, nNpcId)  == "Ti«n Hoành Vû"  then
					SetMonsterFightWithNpcFlag(sceneId, nNpcId, 1)
				end
			end
		end
		
		if nStep1 < 10  then
			if nTime-nPreTime >= 10  then
			--if nTime-nPreTime >= 1  then
				LuaFnSetCopySceneData_Param(sceneId, x401040_g_SD_Monster_2, nStep1+1)
				LuaFnSetCopySceneData_Param(sceneId, x401040_g_SD_Monster_2_T,nTime)
				-- Ë¢¹Ö
				x401040_CreateMonster_7_1(sceneId)
				x401040_CreateMonster_7_3(sceneId)
				
				x401040_TipAllHuman(sceneId, "Yªn tØ ± ðã träi qua " .. nStep1+1 .. " ðþt t¤n công, còn lÕi " .. 25-(nStep1+1) .. " ðþt t¤n công næa")
				
				-- Ë¢ Ò¦²®µ±
				if nStep1==9  then
					x401040_CreateMonster_8(sceneId, 1)
				end
				
			end
		end
				
		
		-- Ë¢10²¨Ð¡¹Öºó,C¥n ÓÐmµt cái90 giâytoÕ ðµ µÈ´ýÊ±¼ä
		if nStep1 == 10  then
			if nTime-nPreTime >= 30  then
				LuaFnSetCopySceneData_Param(sceneId, x401040_g_SD_Monster_2, nStep1+1)
			end
		end
		
		if nStep1>=11 and nStep1<21  then
			if nTime-nPreTime >= 20  then
			--if nTime-nPreTime >= 1  then
				LuaFnSetCopySceneData_Param(sceneId, x401040_g_SD_Monster_2, nStep1+1)
				LuaFnSetCopySceneData_Param(sceneId, x401040_g_SD_Monster_2_T,nTime)
				
				-- Ë¢¹Ö
				x401040_CreateMonster_7_4(sceneId)
				x401040_CreateMonster_7_3(sceneId)
				x401040_TipAllHuman(sceneId, "Yªn tØ ± ðã träi qua " .. nStep1 .. " ðþt t¤n công, còn lÕi " .. 25-(nStep1) .. " ðþt t¤n công næa")
				
				if nStep1==20  then
					-- Ë¢ Ë¾ÂíÁÖ
					x401040_CreateMonster_8(sceneId, 2)
				end
				
			end
		end
		
		-- ÔÙ´ÎË¢10²¨Ð¡¹Öºó,ÔÙÓÐmµt cái90 giâytoÕ ðµ µÈ´ýÊ±¼ä
		if nStep1 == 21  then
			if nTime-nPreTime >= 30  then
				LuaFnSetCopySceneData_Param(sceneId, x401040_g_SD_Monster_2, nStep1+1)
			end
		end
		
		if nStep1>=22 and nStep1<27  then
			if nTime-nPreTime >= 30  then
				LuaFnSetCopySceneData_Param(sceneId, x401040_g_SD_Monster_2, nStep1+1)
				LuaFnSetCopySceneData_Param(sceneId, x401040_g_SD_Monster_2_T,nTime)
				x401040_CreateMonster_7_2(sceneId)
				x401040_TipAllHuman(sceneId, "Yªn tØ ± ðã träi qua " .. nStep1-1 .. " ðþt t¤n công, còn lÕi " .. 25-(nStep1-1) .. " ðþt t¤n công næa")
				
				if nStep1==26  then
					-- Ë¢ Cßu Ma Trí
					x401040_CreateMonster_8(sceneId, 3)
					-- 
					LuaFnSetCopySceneData_Param(sceneId, x401040_g_SceneData_1, 12)
				end
				
			end
		end
	end
	
	
	-- ´ò°ÜCßu Ma Trí,¼ì²âÇ®ºêÓîÐúng²»Ðúng»¹»î×Å,¿´µÚ¶þ²½Ðúng³É¹¦»¹Ðúngth¤t bÕiÁË
	if nStep == 12  then
		local nNpcNum = GetMonsterCount(sceneId)
		local bOK = 0
		for i=0, nNpcNum-1 do
			local nNpcId = GetMonsterObjID(sceneId,i)
			if GetName(sceneId, nNpcId)  == "Ti«n Hoành Vû"  then
				bOK = 1
			end
		end
		
		if bOK == 1  then
			LuaFnSetCopySceneData_Param(sceneId, x401040_g_SceneData_1, 15)
			-- Ë¢4ÃÅÉñ
			x401040_CreateMonster_9(sceneId)
			x401040_CreateMonster_10(sceneId)
			x401040_CreateMonster_11(sceneId)
			
			--Mµ Dung PhøcÉíºótoÕ ðµ ¹Ö
			x401040_CreateMonster_13(sceneId)
		else
			LuaFnSetCopySceneData_Param(sceneId, x401040_g_SceneData_1, 501)
		end
	end
	
	-- 500 ,th¤t bÕiÌõ¼þ1,ºôÑÓ±ª ËÀÍö
	local nLost = LuaFnGetCopySceneData_Param(sceneId, x401040_g_MissionLost)
	if nLost == 500  then
		CallScriptFunction((200060), "Paopao",sceneId, "H° Diên Khánh", "Yªn TØ ‘", "Kª hoÕch tiªn vào yªn tØ ± ðã th¤t bÕi, không th¬ vãn h°i næa r°i")
		LuaFnSetCopySceneData_Param(sceneId, x401040_g_MissionLost, 1000)
	end
	
	-- 501,th¤t bÕiÌõ¼þ2,Ç®ºêÓî ËÀÍö
	if nLost == 501  then
		CallScriptFunction((200060), "Paopao",sceneId, "H° Diên Khánh", "Yªn TØ ‘", "Kª hoÕch tiªn vào yªn tØ ± ðã th¤t bÕi, không th¬ vãn h°i næa r°i")
		LuaFnSetCopySceneData_Param(sceneId, x401040_g_MissionLost, 1000)
	end
	
	local nCloaeTime = LuaFnGetCopySceneData_Param(sceneId, x401040_g_CloseTime)
	-- 1000 ,µ¹¼ÆÊ±,30 giâyºó¹Ø±Õ¸±±¾
	if nLost == 1000 then
		x401040_TipAllHuman(sceneId, "Nhi®m vø th¤t bÕi, các hÕ s¨ r°i khöi sau 20 giây")
		LuaFnSetCopySceneData_Param(sceneId, x401040_g_CloseTime, nTime)
		LuaFnSetCopySceneData_Param(sceneId, x401040_g_MissionLost, nLost+1)
	end
	if nLost == 1001 and nTime-nCloaeTime>=15  then
		x401040_TipAllHuman(sceneId, "Nhi®m vø th¤t bÕi, các hÕ s¨ r°i khöi sau 10 giây")
		LuaFnSetCopySceneData_Param(sceneId, x401040_g_CloseTime, nTime)
		LuaFnSetCopySceneData_Param(sceneId, x401040_g_MissionLost, nLost+1)
	end
	if nLost == 1002 and nTime-nCloaeTime>=10  then
		x401040_TipAllHuman(sceneId, "Nhi®m vø th¤t bÕi, các hÕ s¨ r°i khöi sau 5 giây")
		LuaFnSetCopySceneData_Param(sceneId, x401040_g_CloseTime, nTime)
		LuaFnSetCopySceneData_Param(sceneId, x401040_g_MissionLost, nLost+1)
	end
	if nLost == 1003 and nTime-nCloaeTime>=5  then
		local nHumanNum = LuaFnGetCopyScene_HumanCount(sceneId)
		for i=0, nHumanNum-1  do
			local nPlayerId = LuaFnGetCopyScene_HumanObjId(sceneId, i)
			NewWorld( sceneId, nPlayerId, x401040_g_Back_SceneId, x401040_g_Back_X, x401040_g_Back_Z) ;
		end
		LuaFnSetCopySceneData_Param(sceneId, x401040_g_CloseTime, nTime)
		LuaFnSetCopySceneData_Param(sceneId, x401040_g_MissionLost, nLost+1)
	end
	
	-- Á¬åóËþtoÕ ðµ ÐÞÀí
	-- Èç¹ûÍæ¼Ò½»¹»ÁËÄ¾²Ä,¾Í¸Ä±äCái này ËþtoÕ ðµ ÕóÓª
	local jianta1 = LuaFnGetCopySceneData_Param(sceneId, x401040_g_SceneData_3)
	if jianta1 >= 5 and jianta1 < 1000  then
		x401040_ChangeNpc(sceneId, "Trß¾c khi")
		LuaFnSetCopySceneData_Param(sceneId, x401040_g_SceneData_3, jianta1+1000)
	end
	local jianta2 = LuaFnGetCopySceneData_Param(sceneId, x401040_g_SceneData_4)
	if jianta2 >= 5 and jianta2 < 1000  then
		x401040_ChangeNpc(sceneId, "Sau khi")
		LuaFnSetCopySceneData_Param(sceneId, x401040_g_SceneData_4, jianta2+1000)
	end
	local jianta3 = LuaFnGetCopySceneData_Param(sceneId, x401040_g_SceneData_5)
	if jianta3 >= 10 and jianta3 < 1000  then
		x401040_ChangeNpc(sceneId, "Tháp tr¸ li®u")
		LuaFnSetCopySceneData_Param(sceneId, x401040_g_SceneData_5, jianta3+1000)
	end
	local jianta4 = LuaFnGetCopySceneData_Param(sceneId, x401040_g_SceneData_6)
	if jianta4 >= 5 and jianta4 < 1000  then
		x401040_ChangeNpc(sceneId, "Tháp phòng ngñ")
		LuaFnSetCopySceneData_Param(sceneId, x401040_g_SceneData_6, jianta4+1000)
	end
	
	-- ¼¸cái¼ýËþ·Å¼¼ÄÜ
	if nStep >= 11   then
		if nTime-nPreSystemTime >=5  then
			LuaFnSetCopySceneData_Param(sceneId, x401040_g_SystemTipsTime, nTime)
			if jianta1 > 1000  then
				local nNpcId = x401040_NameToId(sceneId, "Trß¾c khi")
				if nNpcId>=0  then
					if GetHp(sceneId, nNpcId) > 0  then
						--PrintStr("Ç°Á¬åóËþ·Å¼¼ÄÜ")
						local x
						local z
						x,z = GetWorldPos(sceneId,nNpcId)
						LuaFnUnitUseSkill(sceneId,nNpcId,1008,nNpcId,x,z,10,0)
					end
				end
			end
			
			if jianta2 > 1000  then
				local nNpcId = x401040_NameToId(sceneId, "Sau khi")
				if nNpcId>=0  then
					if GetHp(sceneId, nNpcId) > 0  then
						--PrintStr("ºóÁ¬åóËþ·Å¼¼ÄÜ")
						local x
						local z
						x,z = GetWorldPos(sceneId,nNpcId)
						LuaFnUnitUseSkill(sceneId,nNpcId,1008,nNpcId,x,z,10,0)
					end
				end
			end
			
			if jianta3 > 1000  then
				local nNpcId = x401040_NameToId(sceneId, "Tháp tr¸ li®u")
				if nNpcId>=0  then
					if GetHp(sceneId, nNpcId) > 0  then
						--PrintStr("Tr¸ li®uËþ·Å¼¼ÄÜ")
						local x
						local z
						x,z = GetWorldPos(sceneId,nNpcId)
						LuaFnUnitUseSkill(sceneId,nNpcId,1010,nNpcId,x,z,10,0)
					end
				end
			end
			
			if jianta4 > 1000  then
				local nNpcId = x401040_NameToId(sceneId, "Tháp phòng ngñ")
				if nNpcId>=0  then
					if GetHp(sceneId, nNpcId) > 0  then
						--PrintStr("ÊØÓùËþ·Å¼¼ÄÜ")
						local x
						local z
						x,z = GetWorldPos(sceneId,nNpcId)
						LuaFnUnitUseSkill(sceneId,nNpcId,1009,nNpcId,x,z,10,0)
					end
				end
			end
			
		end
	end
	
	-- ÍõÓïæÌ ði¬mÃû
	-- ÍõÓïÑÔ¿ªÊ¼ ði¬mÃûtoÕ ðµ ¿ª¹Ø
	-- x401040_g_bWangyuyanSpeak = 24
	-- x401040_g_bWangyuyanSpeak_T = 27
	local bSpeak = LuaFnGetCopySceneData_Param(sceneId, x401040_g_bWangyuyanSpeak)
	local nSpeakTime = LuaFnGetCopySceneData_Param(sceneId, x401040_g_bWangyuyanSpeak_T)
	if bSpeak == 1  then
		CallScriptFunction((200060), "Paopao",sceneId, "Vß½ng Ngæ Yên", "Yªn TØ ‘", " Dñ ca, chúng ta hãy giúp Mµ Dung Ca Ca mµt tay")
		
		LuaFnSetCopySceneData_Param(sceneId, x401040_g_bWangyuyanSpeak, 2)
		LuaFnSetCopySceneData_Param(sceneId, x401040_g_bWangyuyanSpeak_T, nTime)
	
	elseif bSpeak == 2 and nTime - nSpeakTime >= 1  then
		CallScriptFunction((200060), "Paopao",sceneId, "Ðoàn Dñ", "Yªn TØ ‘", " Kë nào dám to gan xông vào Yªn TØ ‘ #70")
		
		LuaFnSetCopySceneData_Param(sceneId, x401040_g_bWangyuyanSpeak, 3)
		LuaFnSetCopySceneData_Param(sceneId, x401040_g_bWangyuyanSpeak_T, nTime)
		
		local nNpcNum = GetMonsterCount(sceneId)
		for i=0, nNpcNum-1 do
			local nNpcId = GetMonsterObjID(sceneId,i)
			if GetName(sceneId, nNpcId)  == "Ðoàn Dñ"  then
				SetMonsterFightWithNpcFlag(sceneId, nNpcId, 1)
				SetUnitCampID(sceneId, nNpcId, nNpcId, 110)
				SetNPCAIType(sceneId, nNpcId, 27)
				SetAIScriptID(sceneId, nNpcId, 245)
				--PrintNum(222)
			end
			if GetName(sceneId, nNpcId)  == "Vß½ng Ngæ Yên"  then
				SetMonsterFightWithNpcFlag(sceneId, nNpcId, 0)
				SetUnitCampID(sceneId, nNpcId, nNpcId, 110)
			end
		end
		LuaFnSetCopySceneData_Param(sceneId, x401040_g_bWangyuyanSpeak, 3)

	elseif bSpeak == 3 and nTime - nSpeakTime >= 20  then
		CallScriptFunction((200060), "Paopao",sceneId, "Ðoàn Dñ", "Yªn TØ ‘", "#18#18#18 Vß½ng cô nß½ng th§t ngÕi quá, khiªn cô nß½ng r½i vào tình cänh này")
	
		LuaFnSetCopySceneData_Param(sceneId, x401040_g_bWangyuyanSpeak, 4)
		LuaFnSetCopySceneData_Param(sceneId, x401040_g_bWangyuyanSpeak_T, nTime)
	
	elseif bSpeak == 4 and nTime - nSpeakTime >= 1  then
		CallScriptFunction((200060), "Paopao",sceneId, "Vß½ng Ngæ Yên", "Yªn TØ ‘", "#20#20#20 Dñ ca, sao lÕi nói v§y #4 #4 #4")
	
		LuaFnSetCopySceneData_Param(sceneId, x401040_g_bWangyuyanSpeak, 5)
		LuaFnSetCopySceneData_Param(sceneId, x401040_g_bWangyuyanSpeak_T, nTime)
	
	elseif bSpeak == 5  then
		if nTime-nSpeakTime >= 10  then
			x401040_GiveDirections(sceneId)
			LuaFnSetCopySceneData_Param(sceneId, x401040_g_bWangyuyanSpeak_T, nTime)
		end
		
--	else
--		local nNpcNum = GetMonsterCount(sceneId)
--		for i=0, nNpcNum-1 do
--			local nNpcId = GetMonsterObjID(sceneId,i)
--			if GetName(sceneId, nNpcId)  == "Ðoàn Dñ"  then
--				SetMonsterFightWithNpcFlag(sceneId, nNpcId, 0)
--				SetUnitCampID(sceneId, nNpcId, nNpcId, 109)
--				--PrintNum(222)
--			end
--			if GetName(sceneId, nNpcId)  == "ÍõÓïæÌ"  then
--				SetMonsterFightWithNpcFlag(sceneId, nNpcId, 0)
--				SetUnitCampID(sceneId, nNpcId, nNpcId, 109)
--			end
--		end
		
	end
	
	local bSpeak = LuaFnGetCopySceneData_Param(sceneId, x401040_g_DuanAndWangFlag)
 	if bSpeak == 1 then
		CallScriptFunction((200060), "Paopao",sceneId, "Vß½ng Ngæ Yên", "Yªn TØ ‘", "Dñ ca, b÷n ngß¶i này r¤t khó ð¯i phó...")
		CallScriptFunction((200060), "Paopao",sceneId, "Ðoàn Dñ", "Yªn TØ ‘", "Ta biªt, ta s¨ làm theo sñ chï dçn cüa cô nß½ng.")
 		
		local nNpcNum = GetMonsterCount(sceneId)
		for i=0, nNpcNum-1 do
			local nNpcId = GetMonsterObjID(sceneId,i)
			if GetName(sceneId, nNpcId)  == "Ðoàn Dñ"  then
				SetMonsterFightWithNpcFlag(sceneId, nNpcId, 1)
				SetUnitCampID(sceneId, nNpcId, nNpcId, 110)
				SetAIScriptID(sceneId, nNpcId, 246)
				--PrintNum(222)
			end
		end
 		LuaFnSetCopySceneData_Param(sceneId, x401040_g_DuanAndWangFlag, 2)
 	end
	
	
end

--**********************************
--´ÓTên ðÕt ðßþcNpcId
--**********************************
function x401040_NameToId(sceneId, szName)
	local nNpcId = -1
	local nMonsterNum = GetMonsterCount(sceneId)
	for i=0, nMonsterNum-1 do
		local nMonsterId = GetMonsterObjID(sceneId,i)
		if GetName(sceneId, nMonsterId)== szName  then
			nNpcId = nMonsterId
		end
	end
	return nNpcId
end

--**********************************
--µÚmµt ´ÎÉú³É¹ÖÎï
--**********************************
function x401040_CreateMonster_1(sceneId)
	-- ÉèÖ giây¢¹Ö
	if LuaFnGetCopySceneData_Param(sceneId, x401040_g_SceneData_1) == 0  then
		
		-- Ë¢Ð¡¹Ö, ËÎ¾üÊ¿±ø,mµt Æ·ÌÃÎäÊ¿,Yªn TØ ‘ gia ðinh
		for i, Npc in x401040_g_Npc_1  do
			local nNpcId = x401040_CreateNpc(sceneId, Npc.id, Npc.x, Npc.y,	Npc.ai, Npc.af, -1)
			local szName = GetName(sceneId, nNpcId)
			SetUnitCampID(sceneId,nNpcId,nNpcId,Npc.camp)
			
			if szName == "T¯ng quân binh sî"  then
				SetMonsterFightWithNpcFlag(sceneId, nNpcId, 1)
				
			elseif szName == "Nh¤t Ph¦m Ðß¶ng Võ Sî"  then
				SetMonsterFightWithNpcFlag(sceneId, nNpcId, 1)
				
			elseif szName == "Yªn TØ ‘ gia ðinh"  then
				SetMonsterFightWithNpcFlag(sceneId, nNpcId, 1)
			end
		end
		
		-- Ë¢Npc,ÓÐ½Å±¾toÕ ðµ Npc
		for i, Npc in x401040_g_Npc_2  do
			local nNpcId = x401040_CreateNpc(sceneId, Npc.id, Npc.x, Npc.y, Npc.ai, Npc.af, Npc.script)
			SetUnitCampID(sceneId,nNpcId, nNpcId, Npc.camp)
			SetMonsterFightWithNpcFlag(sceneId, nNpcId, 0)
		end
		
		for i, Npc in x401040_g_Npc_2_1  do
			local nNpcId = x401040_CreateNpc(sceneId, Npc.id, Npc.x, Npc.y, Npc.ai, Npc.af, Npc.script)
			SetUnitCampID(sceneId,nNpcId, nNpcId, Npc.camp)
			SetMonsterFightWithNpcFlag(sceneId, nNpcId, 0)
		end
		
		-- Ë¢Ç®ºêÓî
		for i, Npc in x401040_g_Npc_6  do
			local nNpcId = x401040_CreateNpc(sceneId, Npc.id, Npc.x, Npc.y, Npc.ai, Npc.af, Npc.script)
			SetUnitCampID(sceneId,nNpcId, nNpcId, Npc.camp)
			SetMonsterFightWithNpcFlag(sceneId, nNpcId, 0)
		end
		
		-- Ë¢Á¬åóËþ
		for i, Npc in x401040_g_Npc_7  do
			local nNpcId = x401040_CreateNpc(sceneId, Npc.id, Npc.x, Npc.y, Npc.ai, Npc.af, Npc.script)
			SetUnitCampID(sceneId,nNpcId, nNpcId, Npc.camp)
			SetMonsterFightWithNpcFlag(sceneId, nNpcId, 0)
			local szName = GetName(sceneId, nNpcId)
			SetCharacterName(sceneId, nNpcId, Npc.name .. szName )
		end
	
		-- ¼ÇÂ¼ÏÂµÚmµt Åú¹ÖÒÑ¾­Ë¢Íæ
		LuaFnSetCopySceneData_Param(sceneId, x401040_g_SceneData_1, 1) 
		
	end
	
end

--**********************************
-- Éú³ÉÔÀÀÏÈý
--**********************************
function x401040_CreateMonster_2(sceneId)
	for i, Npc in x401040_g_Npc_3  do
		local nNpcId = x401040_CreateNpc(sceneId, Npc.id, Npc.x, Npc.y, Npc.ai, Npc.af, Npc.script)
		SetUnitCampID(sceneId,nNpcId, nNpcId, Npc.camp)
		SetMonsterFightWithNpcFlag(sceneId, nNpcId, 1)
		if GetName(sceneId,nNpcId) == "NhÕc Lão Tam"   then
			LuaFnNpcChat(sceneId, nNpcId, 0, "Các ngß½i ðã ðªn ðây r°i thì không còn mÕng ð¬ tr· ra ðâu, hãy nÕp mÕng")
		end
	end
	
	x401040_CreateMonster_6(sceneId)
	
	-- ×ª»» ºôÑÓ±ª toÕ ðµ ÕóÓª
	local nNpcNum = GetMonsterCount(sceneId)
	for i=0, nNpcNum-1 do
		local nNpcId = GetMonsterObjID(sceneId,i)
		if GetName(sceneId, nNpcId)  == "H° Diên Báo"  then
			SetMonsterFightWithNpcFlag(sceneId, nNpcId, 1)
			return
		end
	end
end

--**********************************
-- ÔÀÀÏÈýËÀ,´´½¨ Ò¶¶þÄï,ÔÆÖÐºÍ
--**********************************
function x401040_CreateMonster_3(sceneId)
	for i, Npc in x401040_g_Npc_4  do
		local nNpcId = x401040_CreateNpc(sceneId, Npc.id, Npc.x, Npc.y, Npc.ai, Npc.af, Npc.script)
		SetUnitCampID(sceneId,nNpcId, nNpcId, Npc.camp)
		SetMonsterFightWithNpcFlag(sceneId, nNpcId, 1)
	end
	x401040_CreateMonster_6(sceneId)
end

--**********************************
-- Ò¶¶þÄï,ÔÆÖÐºÍ Á½ÈËÆäÖÐmµt cáiËÀÁË,Ë¢¶ÎÑÓÇì
--**********************************
function x401040_CreateMonster_5(sceneId)
	for i, Npc in x401040_g_Npc_5  do
		local nNpcId = x401040_CreateNpc(sceneId, Npc.id, Npc.x, Npc.y, Npc.ai, Npc.af, Npc.script)
		SetUnitCampID(sceneId,nNpcId, nNpcId, Npc.camp)
		SetMonsterFightWithNpcFlag(sceneId, nNpcId, 1)
	end
	x401040_CreateMonster_6(sceneId)
end

--**********************************
-- ÐÞÀí¼ýËþ
--**********************************
function x401040_ChangeNpc(sceneId, szName)
	local nNpcNum = GetMonsterCount(sceneId)
	for i=0, nNpcNum-1 do
		local nNpcId = GetMonsterObjID(sceneId,i)
		if GetName(sceneId, nNpcId)  == szName  then
			SetUnitCampID(sceneId,nNpcId, nNpcId, 109)
			SetMonsterFightWithNpcFlag(sceneId, nNpcId, 1)
			LuaFnNpcChat(sceneId, nNpcId, 0, szName .. "ðã tu sØa thành công")
		end
	end
end

--**********************************
-- Éú³ÉÔÀÀÏÈýÖ®ºó,°éËæË¢³ötoÕ ðµ Ð¡¹Ö
--**********************************
function x401040_CreateMonster_6(sceneId)
	for i, Npc in x401040_g_Npc_8  do
		local nNpcId = x401040_CreateNpc(sceneId, Npc.id, Npc.x, Npc.y, Npc.ai, Npc.af, Npc.script)
		SetUnitCampID(sceneId,nNpcId, nNpcId, Npc.camp)
		SetMonsterFightWithNpcFlag(sceneId, nNpcId, 1)
	end
end

--**********************************
-- ºÍºêÓî¶Ô»°ºóË¢toÕ ðµ ¹Ö,1
--**********************************
function x401040_CreateMonster_7_1(sceneId)
	for i, Npc in x401040_g_Npc_9  do
		local nNpcId = x401040_CreateNpc(sceneId, Npc.id, Npc.x, Npc.y, Npc.ai, Npc.af, Npc.script)
		SetUnitCampID(sceneId,nNpcId, nNpcId, Npc.camp)
		SetMonsterFightWithNpcFlag(sceneId, nNpcId, 1)
		SetPatrolId(sceneId, nNpcId, Npc.pp)
	end
end

--**********************************
-- ºÍºêÓî¶Ô»°ºó,TÕi Å¼Êý´ÎË¢³ötoÕ ðµ Ä¾ÈË¿þÀÜ
--**********************************
function x401040_CreateMonster_7_3(sceneId)
	for i, Npc in x401040_g_Npc_9_1  do
		local nNpcId = x401040_CreateNpc(sceneId, Npc.id, Npc.x, Npc.y, Npc.ai, Npc.af, Npc.script)
		SetUnitCampID(sceneId,nNpcId, nNpcId, Npc.camp)
		SetMonsterFightWithNpcFlag(sceneId, nNpcId, 1)
		SetPatrolId(sceneId, nNpcId, Npc.pp)
	end
end


--**********************************
-- ºÍºêÓî¶Ô»°ºó,TÕi 50-100²¨Ë¢³ötoÕ ðµ Çà³ÇÅÉµÜ×Ó
--**********************************
function x401040_CreateMonster_7_4(sceneId)
	for i, Npc in x401040_g_Npc_9_2  do
		local nNpcId = x401040_CreateNpc(sceneId, Npc.id, Npc.x, Npc.y, Npc.ai, Npc.af, Npc.script)
		SetUnitCampID(sceneId,nNpcId, nNpcId, Npc.camp)
		SetMonsterFightWithNpcFlag(sceneId, nNpcId, 1)
		SetPatrolId(sceneId, nNpcId, Npc.pp)
	end
end

--**********************************
-- ºÍºêÓî¶Ô»°ºóË¢toÕ ðµ ¹Ö,2
--**********************************
function x401040_CreateMonster_7_2(sceneId)
	for i, Npc in x401040_g_Npc_10  do
		local nNpcId = x401040_CreateNpc(sceneId, Npc.id, Npc.x, Npc.y, Npc.ai, Npc.af, Npc.script)
		SetUnitCampID(sceneId,nNpcId, nNpcId, Npc.camp)
		SetMonsterFightWithNpcFlag(sceneId, nNpcId, 1)
		SetPatrolId(sceneId, nNpcId, Npc.pp)
	end
end

--**********************************
-- ºÍºêÓî¶Ô»°ºó Ë¢ Ò¦²®µ± Ë¾ÂíÁÖ Cßu Ma Trí
--**********************************
function x401040_CreateMonster_8(sceneId, nIndex)
	local Npc = x401040_g_Npc_11[nIndex]
	local nNpcId
	if nIndex == 3  then
		nNpcId = x401040_CreateNpc(sceneId, Npc.id, Npc.x, Npc.y, Npc.ai, Npc.af, Npc.script)
	else
		nNpcId = x401040_CreateNpc(sceneId, Npc.id, Npc.x, Npc.y, Npc.ai, Npc.af, Npc.script)
	end
	SetUnitCampID(sceneId,nNpcId, nNpcId, Npc.camp)
	SetMonsterFightWithNpcFlag(sceneId, nNpcId, 1)
	SetPatrolId(sceneId, nNpcId, Npc.pp)
end

--**********************************
-- Ë¢4ÃÅÉñ
--**********************************
function x401040_CreateMonster_9(sceneId)
	for i, Npc in x401040_g_Npc_12  do
		local nNpcId = x401040_CreateNpc(sceneId, Npc.id, Npc.x, Npc.y, Npc.ai, Npc.af, Npc.script)
		SetUnitCampID(sceneId, nNpcId, nNpcId, Npc.camp)
		SetMonsterFightWithNpcFlag(sceneId, nNpcId, 1)
		
		SetMonsterGroupID(sceneId, nNpcId, 99)
	end
end

--**********************************
-- Ë¢ ×Üboss Mµ Dung Phøc
--**********************************
function x401040_CreateMonster_10(sceneId)
	for i, Npc in x401040_g_Npc_13  do
		local nNpcId = x401040_CreateNpc(sceneId, Npc.id, Npc.x, Npc.y, Npc.ai, Npc.af, Npc.script)
		SetUnitCampID(sceneId,nNpcId, nNpcId, Npc.camp)
		SetMonsterFightWithNpcFlag(sceneId, nNpcId, 1)
	end
end

--**********************************
-- Ë¢ ÍõÓïæÌ  Ðoàn Dñ
--**********************************
function x401040_CreateMonster_11(sceneId)
	for i, Npc in x401040_g_Npc_14  do
		local nNpcId = x401040_CreateNpc(sceneId, Npc.id, Npc.x, Npc.y, Npc.ai, Npc.af, Npc.script)
		SetUnitCampID(sceneId,nNpcId, nNpcId, Npc.camp)
		SetMonsterFightWithNpcFlag(sceneId, nNpcId, 1)
	end
end

--**********************************
-- ºÍMµ Dung Phøc¿ª´òºó,²»¶ÏË¢³ötoÕ ðµ ¼Ò¶¡ (ÒÑ¾­É¾³ýÁËÕâÐ©¹Ö,²»ÔÙË¢ÁË)
--**********************************
function x401040_CreateMonster_12(sceneId)
	for i, Npc in x401040_g_Npc_15  do
		local nNpcId = x401040_CreateNpc(sceneId, Npc.id, Npc.x, Npc.y, Npc.ai, Npc.af, Npc.script)
		SetUnitCampID(sceneId,nNpcId, nNpcId, Npc.camp)
		SetMonsterFightWithNpcFlag(sceneId, nNpcId, 1)
	end
end

--**********************************
-- Mµ Dung Phøc ÉíºótoÕ ðµ ¼Ò¶¡ (ÒÑ¾­É¾³ýÁËÕâÐ©¹Ö,²»ÔÙË¢ÁË)
--**********************************
function x401040_CreateMonster_13(sceneId)
	for i, Npc in x401040_g_Npc_16  do
		local nNpcId = x401040_CreateNpc(sceneId, Npc.id, Npc.x, Npc.y, Npc.ai, Npc.af, Npc.script)
		SetUnitCampID(sceneId,nNpcId, nNpcId, Npc.camp)
		SetMonsterFightWithNpcFlag(sceneId, nNpcId, 1)
	end
end

--**********************************
-- Çå³ý³¡¾°ÄÚtoÕ ðµ XX¹Ö
--**********************************
function x401040_ClearMonsterByName(sceneId, szName)
	local nMonsterNum = GetMonsterCount(sceneId)
	for i=0, nMonsterNum-1 do
		local nMonsterId = GetMonsterObjID(sceneId,i)
		if GetName(sceneId, nMonsterId)== szName  then
			LuaFnDeleteMonster(sceneId, nMonsterId)
		end
	end
end

--**********************************
-- ÍõÓïæÌtoÕ ðµ  ði¬mÃû
--**********************************
function x401040_GiveDirections(sceneId)
	-- ÏÈ¿´ÍõÓïæÌÐúng²»Ðúng»¹»î×Å
	local nWangId = -1
	local nMonsterNum = GetMonsterCount(sceneId)
	for i=0, nMonsterNum-1 do
		local nMonsterId = GetMonsterObjID(sceneId,i)
		if GetName(sceneId, nMonsterId)== "Vß½ng Ngæ Yên"  then
			nWangId = nMonsterId
		end
	end
	-- ÍõÓïæÌÒÑ¾­²»TÕi ³¡¾°ÄÚ,ÎÞ·¨ ði¬mÃûÁË
	if nWangId == -1  then
		return
	end
	local nHumanCount = LuaFnGetCopyScene_HumanCount(sceneId)
	local nRand = random( 1, nHumanCount ) - 1
	local nHumanId = LuaFnGetCopyScene_HumanObjId(sceneId,nRand)
	-- C¥n ¼ì²âÍæ¼ÒÐúng²»Ðúng´¦ÓÚËÀÍö×´Ì¬,ËÀÍö×´Ì¬²»ÄÜ¼Ó buff
	
	LuaFnSendSpecificImpactToUnit(sceneId, nWangId, nWangId, nHumanId, 10188, 2000 )
	local szHumanName = GetName(sceneId, nHumanId)
	local str1 = "Vß½ng Ngæ Yên ðang chú ý t¾i " .. szHumanName .. " xin hãy c¦n th§n"
	
	local str = x401040_GetDirectionsDesc(GetMenPai(sceneId, nHumanId))
	CallScriptFunction((200060), "Paopao",sceneId, "Vß½ng Ngæ Yên", "Yªn TØ ‘", str)
	
	x401040_TipAllHuman(sceneId, str1)
end

--**********************************
-- Í¨ÓÃ´´½¨¹ÖÎïº¯Êý
--**********************************
function x401040_CreateNpc(sceneId, NpcId, x, y, Ai, AiFile, Script)
	local PlayerLevel = LuaFnGetCopySceneData_Param(sceneId, x401040_g_SceneData_7)
	local ModifyLevel = 0
	if PlayerLevel >= 10   then
		ModifyLevel = 1
	end
	if PlayerLevel >= 20   then
		ModifyLevel = 2
	end
	if PlayerLevel >= 30   then
		ModifyLevel = 3
	end
	if PlayerLevel >= 40   then
		ModifyLevel = 4
	end
	if PlayerLevel >= 50   then
		ModifyLevel = 5
	end
	if PlayerLevel >= 60   then
		ModifyLevel = 6
	end
	if PlayerLevel >= 70   then
		ModifyLevel = 7
	end
	if PlayerLevel >= 80   then
		ModifyLevel = 8
	end
	if PlayerLevel >= 90   then
		ModifyLevel = 9
	end
	--npcµÈc¤pÀ©Õ¹ÖÁ200
	if PlayerLevel >= 100   then         
		ModifyLevel = 30001
	end
	if PlayerLevel >= 110   then         
		ModifyLevel = 30002
	end
	if PlayerLevel >= 120   then         
		ModifyLevel = 30003
	end
	if PlayerLevel >= 130   then         
		ModifyLevel = 30004
	end
	if PlayerLevel >= 140   then         
		ModifyLevel = 30005
	end
	local nNpcId = NpcId + ModifyLevel-1
	local nMonsterId = LuaFnCreateMonster(sceneId, nNpcId, x, y, Ai, AiFile, Script)
	SetLevel(sceneId, nMonsterId, PlayerLevel)
	
	-- ¿´ÓÐÃ»ÓÐÉèÖÃ³ÆºÅ,ÓÐ¾Í¼Ó³ÆºÅ
	x401040_SetNpcTitle(sceneId, nMonsterId)
	
	return nMonsterId
end

--**********************************
-- ÃÅÅÉIdµ½ÃÅÅÉÃû³Æ
--**********************************
function x401040_GetDirectionsDesc(MenpaiId)
	
	local str = ""

	if MenpaiId == 0  then
		str = "Ði¬m yªu cüa phái thiªu lâm n¢m · huy®t ðÕi chÆm"
	elseif MenpaiId == 1  then
		str = "Ði¬m yªu cüa phái minh giáo n¢m · huy®t linh ðài"
	elseif MenpaiId == 2  then
		str = "Ði¬m yªu cüa phái cái bang n¢m · huy®t thái dß½ng"
	elseif MenpaiId == 3  then
		str = "Ði¬m yªu cüa phái võ ðang n¢m · huy®t bách hµi"
	elseif MenpaiId == 4  then
		str = "Ði¬m yªu cüa phái nga my n¢m · huy®t th¥n ðình"
	elseif MenpaiId == 5  then
		str = "Ði¬m yªu cüa phái tinh tuc n¢m · huy®t quan nguyên"
	elseif MenpaiId == 6  then
		str = "Ði¬m yªu cüa phái thiên long n¢m · huy®t á môn"
	elseif MenpaiId == 7  then
		str = "Ði¬m yªu cüa phái thiên s½n n¢m · huy®t phª du"
	elseif MenpaiId == 8  then
		str = "Ði¬m yªu cüa phái tiêu dao n¢m · huy®t vî lß"
	end
	
	return str
end

--**********************************
-- ÃÅÅÉIdµ½ÃÅÅÉÃû³Æ
--**********************************
function x401040_SetNpcTitle(sceneId, nNpcId)
	
	local szName = GetName(sceneId, nNpcId)
	
	if szName == "H° Diên Khánh"   then
		SetCharacterTitle(sceneId, nNpcId, "Thái H° Thüy Quân ÐÕi Ðô Ð¯c")
	elseif szName == "H° Diên Báo"   then
		SetCharacterTitle(sceneId, nNpcId, "KÏ HÕm Ðµi Trß·ng")
	elseif szName == "Ti«n Hoành Vû"   then
		SetCharacterTitle(sceneId, nNpcId, "Hi®u Úy Tô châu")
	elseif szName == "NhÕc Lão Tam"   then
		SetCharacterTitle(sceneId, nNpcId, "Hung Th¥n Ác Sát")
	elseif szName == "Di®p Nh¸ Nß½ng"   then
		SetCharacterTitle(sceneId, nNpcId, "Vô Ác B¤t Tác")
	elseif szName == "Vân Trung HÕc"   then
		SetCharacterTitle(sceneId, nNpcId, "Cùng Hung Cñc Ác")
	elseif szName == "Ðoàn Diên Khánh"   then
		SetCharacterTitle(sceneId, nNpcId, "Ác Quán Mãn Doanh")
	elseif szName == "Diêu Bá Ðß½ng"   then
		SetCharacterTitle(sceneId, nNpcId, "Môn chü t¥n gia trÕi")
	elseif szName == "Tß Mã Lâm"   then
		SetCharacterTitle(sceneId, nNpcId, "Chü nhân phái thanh thành")
	elseif szName == "Cßu Ma Trí"   then
		SetCharacterTitle(sceneId, nNpcId, "ÐÕi Luân Minh Vß½ng")
	elseif szName == "Mµ Dung Phøc"   then
		SetCharacterTitle(sceneId, nNpcId, "Ð¦u Chuy¬n Tinh Di")
	
	end
end

