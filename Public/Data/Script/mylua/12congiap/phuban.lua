
x000196_g_ScriptId = 000196
x000196_g_active = 1 --active event
x000196_g_time_start = 20200321
x000196_g_time_end = 20200323
x000196_g_CopySceneType = FUBEN_SINHTIEULOIDAI
x000196_g_string = {
[1] = "Ðây là #R[Sinh Ti¬u ThØ]#W ðÕi di®n 12 con giáp chúng ta, nªu có th¬ ðánh bÕi y s¨ có hµi nh§n ðßþc nhi«u ph¥n quà h¤p dçn. SÇn sàng chßa?",
[2] = "Ðây là #R[Sinh Tiêu Ngßu]#W ðÕi di®n 12 con giáp chung ta, nªu có th¬ ðánh bÕi y s¨ có c½ hµi nh§n ðßþc nhi«u ph¥n quà h¤p dçn. SÇn sàng chßa?",
[3] = "Ðây là #R[Sinh Tiêu H±]#W ðÕi di®n 12 con giáp chung ta, nªu có th¬ ðánh bÕi y s¨ có c½ hµi nh§n ðßþc nhi«u ph¥n quà h¤p dçn. SÇn sàng chßa?",
[4] = "Ðây là #R[Sinh Tiêu Th¯]#W ðÕi di®n 12 con giáp chung ta, nªu có th¬ ðánh bÕi y s¨ có c½ hµi nh§n ðßþc nhi«u ph¥n quà h¤p dçn. SÇn sàng chßa?",
[5] = " Ðây là #R[Sinh Tiêu Long]#W ðÕi di®n 12 con giáp chung ta, nªu có th¬ ðánh bÕi y s¨ có c½ hµi nh§n ðßþc nhi«u ph¥n quà h¤p dçn. SÇn sàng chßa?",
[6] = "Ðây là #R[Sinh Tiêu Mã]#W ðÕi di®n 12 con giáp chung ta, nªu có th¬ ðánh bÕi y s¨ có c½ hµi nh§n ðßþc nhi«u ph¥n quà h¤p dçn. SÇn sàng chßa?",
[7] = "Ðây là #R[Sinh Tiêu Dß½ng]#W ðÕi di®n 12 con giáp chung ta, nªu có th¬ ðánh bÕi y s¨ có c½ hµi nh§n ðßþc nhi«u ph¥n quà h¤p dçn. SÇn sàng chßa?",
[8] = "Ðây là #R[Sinh Tiêu H¥u]#W ðÕi di®n 12 con giáp chung ta, nªu có th¬ ðánh bÕi y s¨ có c½ hµi nh§n ðßþc nhi«u ph¥n quà h¤p dçn. SÇn sàng chßa?",
[9] = "Ðây là #R[Sinh Tiêu Kê]#W ðÕi di®n 12 con giáp chung ta, nªu có th¬ ðánh bÕi y s¨ có c½ hµi nh§n ðßþc nhi«u ph¥n quà h¤p dçn. SÇn sàng chßa?",
[10] = "Ðây là #R[Sinh Tiêu C¦u]#W ðÕi di®n 12 con giáp chung ta, nªu có th¬ ðánh bÕi y s¨ có c½ hµi nh§n ðßþc nhi«u ph¥n quà h¤p dçn. SÇn sàng chßa?",
[11] = "Ðây là #R[Sinh Tiêu Trß]#W ðÕi di®n 12 con giáp chung ta, nªu có th¬ ðánh bÕi y s¨ có c½ hµi nh§n ðßþc nhi«u ph¥n quà h¤p dçn. SÇn sàng chßa?",
[12] = "Ðây là #R[Niên Thú]#W ðÕi di®n 12 con giáp chung ta, nªu có th¬ ðánh bÕi y s¨ có c½ hµi nh§n ðßþc nhi«u ph¥n quà h¤p dçn. SÇn sàng chßa?",
}

x000196_g_TickTime		= 1
x000196_g_NoUserTime	= 30 
x000196_g_Fuben_X			= 26
x000196_g_Fuben_Z			= 26
x000196_g_FuBenTime		= 25*60	--th¶i gian kªt thúc pb
x000196_g_solan = 12			--gi¾i hÕn s¯ l¥n ði pb
x000196_g_NeedLever = 50


x000196_g_NPCList ={
	{ mID=13848, ScriptID=400, text =x000196_g_string[1],bID=13836,name = "Sinh Tiêu ThØ", 	skill = 636 ,chat1 ="#{SXLT_100119_56}",chat2 = "#{SXLT_100119_64}",
	item={  30505197,--thöi vàng
				30070512,--ðµc trùng tüy
				30070507,--huy«n c½ dßþc tr¥n
				30505107,--ti¬u lÕt bá
				30308293,--trÑng trân thú nh¸ lang chân quân
				20503062,--ly höa
				20503061,--trang b¸ tinh thông phù
				30509042,--pháo hoa mùa xuân vui vë
	},	},	
	{ mID=13849, ScriptID=401, text =x000196_g_string[2],bID=13837,name = "Sinh Tiêu Ngßu", 	skill = 597,chat1 ="Luy®n t§p b¤y lâu, gi¶ m¾i có d¸p ki¬m tra thành quä. LÕi ðây con m°i bé nhö kia!!!!",chat2 = "Xem ra sÑc mÕnh cüa ta quá vßþt trµi r°i, Ðµc Cô C¥u BÕi là ta!!!",
	item={	30008014,--thông thiên linh ðan
				20503061,--trang b¸ tinh thông phù
				20503062,--ly höa
				30070513,--duyên linh thäo
				30509044,--pháo hoa chào nåm m¾i
				20503061,--trang b¸ tinh thông phù
				30010088,--linh h°n toái phiªn løc
				30505197,--thöi vàng
	}, },
	{ mID=13850, ScriptID=402, text = x000196_g_string[3],bID=13838,name = "Sinh Tiêu H±", 	skill = 625,chat1 ="#{SXLT_100119_62}",chat2 ="Có l¨ lão h± ta ðã có tu±i r°i. Nhßng r°i cûng s¨ có ngày ta khôi phøc lÕi uy phong" ,		
	item={	30070512,--ðµc trùng tüy
				30509043,--phóa hoa chúc m×ng nåm m¾i
				20503062,--ly höa
				20503061,--trang b¸ tinh thông phù
				10157002,--long vån
				30503140,--h°ng di®u thÕch
				20503061,--trang b¸ tinh thông phù
				30308285,--trÑng chân thú kim ð°ng ng÷c næ
	}, 		},
	{ mID=13851, ScriptID=403, text =x000196_g_string[4],bID=13839,name = "Sinh Tiêu Th¯", 	skill = 627, chat1 ="Ta tuy thân hình không cao nhßng hãy ch¯ng m¡t lên mà xem sÑc mÕnh cüa ta ðây!!!!", chat2 ="AAAAAAAAAAAA,Th.....¥....¥...n...n....n...n.....c...ô....ô...n....g...c...ü....a.......taaaaaaaaaaaa......!",
	item={	30509041,--pháo hoa nåm m¾i vui vë
				30070512,--ðµc trùng tüy
				20503061,--trang b¸ tinh thông phù
				20503062,--ly höa
				30070507,--huy«n c½ dßþc tr¥n
				30505107,--ti¬u lÕt bá
				20503062,--ly höa
	}, 		},
	{ mID=13852, ScriptID=404, text = x000196_g_string[5],bID=13840,name = "Sinh Tiêu Long", 	skill = 651, chat1 = "#{SXLT_100119_61}", chat2 = "#{SXLT_100119_58}" ,
	item={	30509045,--pháo hoa vÕn sñ nhß ý
				30503140,--h°ng di®u thÕch
				30309036,--trÑng trân thú giao long
				30070507,--huy«n c½ dßþc tr¥n
				38000184,--chú vån huyªt ng÷c
				20503062,--ly höa
				20503061,--trang b¸ tinh thông phù
				20503062,--ly höa
	}, 	},
	{ mID=13853, ScriptID=405, text = x000196_g_string[6],bID=13841,name = "Niên Thú", 		skill =  615, chat1 = "Ngß½i mình hÕc xß½ng mai nhß v§y làm sao sánh v¾i sÑc mÕnh cüa 12 con giáp ta. Tiªp chiêu!!!!!!!!!!!!", chat2 = "Các hÕ ðúng là không phäi nhân v§t t¥m thß¶ng,xem ra ta phäi luy®n t§p thêm m¾i ðßþc. H©n ngày tái ngµ!!!!!!!!!!!",
	item={	30509041, --pháo hoa nåm m¾i vui vë
				20503062,--ly höa
				20503061,--trang b¸ tinh thông phù
				30505107,--ti¬u lÕt bá
				30070512,--ðµc trùng tüy
				30505197,--thöi vàng
				30070513,--duyên linh thäo
				30070507,--huy«n c½ dßþc tr¥n
				10141807,--thú cßÞi niên thú lôi ðình 30d
				30309724,--trÑng trân thú niên thú 85
				30309725,--trÑng trân thú niên thú 95
	}, 	},
	{ mID=13854, ScriptID=406, text = x000196_g_string[7],bID=13842,name = "Sinh Tiêu Mã", 	skill = 621,chat1 = "T¯c ðµ, sÑc mÕnh, nhanh nh©n ð«u hµi tø cä · ta, Ð® nh¤t Mã Vß½ng!!! Ð¥u hàng ði, ta s¨ tha mÕng!!!", chat2 = "Ta có l¶i khen cho sÑc mÕnh cüa nhà ngß½i. L¥n sau tái ð¤u, nh¤t ð¸nh ta s¨ chiªn th¡ng",	
	item={	30509044,--pháo hoa chào nåm m¾i
				30070513,--duyên linh thäo
				30309092,--pet:thái thßþng long tØ
				20503061,--trang b¸ tinh thông phù
				30008014,--thông thiên linh ðan
				--20503062,--ly höa
				10157002,--long vån
				30505107,--ti¬u lÕt bá
				10157002,--ly höa
	}, 		},
	{ mID=13855, ScriptID=407, text =x000196_g_string[8],bID=13843,name = "Sinh Tiêu Dß½ng", 	skill = 608 , chat1 = " Ð×ng th¤y ta già yªu mà xem thß¶ng, hãy xem chiêu!!!!!!!", chat2=" Hmmmmmmmm, xem ra tu±i tác cüa ta ðã giúp ngß½i thoát ðßþc ðÕi nÕn ngày hôm nay",
	item={	30509045,--pháo hoa vÕn sñ nhß ý
				20503062,--ly höa
				30505197,--thöi vàng
				20503062,--ly höa
				20503061,--trang b¸ tinh thông phù
				30070507,--huy«n c½ dßþc tr¥n
				30505107,--ti¬u lÕt bá
	}, 	},
	{ mID=13856, ScriptID=408, text = x000196_g_string[9],bID=13844,name = "Sinh Tiêu Kê", 	skill = 624, chat1 = "Ngß½i ð×ng vµi coi khinh, ð® nh¤t Kê Vß½ng ta không d­ ðánh bÕi ðâu!!", chat2="Hôm nay ta chßa chu¦n b¸, trÕng thái không t¯t, ð¬ cho ngß½i chiªm thßþng phong! Không phøc, không phøc!!!",
	item={	30509041,--pháo hoa nåm m¾i vui vë
				30070507,--huy«n c½ dßþc tr¥n
				30070513,--duyên linh thäo
				10157002,--long vån
				30505197,--thöi vàng
				38000184,--chú vån huyªt ng÷c
				30008014,--thông thiên linh ðan
				10157002,--ly höa
	}, 		},
	{ mID=13857, ScriptID=409, text = x000196_g_string[10],bID=13845,name = "Sinh Tiêu H¥u", 	skill = 622, chat1="#{SXLT_100119_57}", chat2 = "Các hÕ ðúng là không phäi nhân v§t t¥m thß¶ng,xem ra ta phäi luy®n t§p thêm m¾i ðßþc" ,
	item={	30509045,--pháo hoa vÕn sñ nhß ý
				30505197,--thöi vàng
				30505198,--linh h°n toái phiªn ðÕi
				30308285,--trÑng trân thú kim ð°ng ng÷c næ
				30070513,--duyên linh thäo
				20503062,--ly höa
				20503061,--trang b¸ tinh thông phù
	}, 	},
	{ mID=13858, ScriptID=410, text = x000196_g_string[11],bID=13846,name = "Sinh Tiêu C¦u", 	skill = 1318 , chat1="#{SXLT_100119_61}", chat2="Ngß½i dùng ám khí, th§t không cam tâm, ðþi ngày khác tái chiªn ta s¨ khiªn ngß½i tâm phøc kh¦u phøc!",
	item={	10157002,--ly höa
				30509044,--pháo hoa chào nåm m¾i
				30505197,--thöi vàng
				30505107,--ti¬u lÕt bá
				30308293,--trÑng trân thú nh¸ lang chân quân
				30070507,--huy«n c½ dßþc tr¥n
				30070512,--ðµc trùng tüy
				--20503062,--ly höa
				10157002,--long vån
	}, 	},
	{ mID=13859, ScriptID=411, text = x000196_g_string[12],bID=13847,name = "Sinh Tiêu Trß", 	skill = 643, chat1="#{SXLT_100119_59}", chat2="Ngß½i quä th§t có sÑc mÕnh vßþt trµi. Sß phø Trß Bát Gi¾i, xin hãy giúp ð® tØ trä thù!!!!!" ,
	item={	30509041,--pháo hoa nåm m¾i vui vë
				30505197,--thöi vàng
				30070513,--duyên linh thäo
				20503062,--ly höa
				30308297,--trÑng trân thú  mãnh bäo trß
				30070507,--huy«n c½ dßþc tr¥n
				30008014,--thông thiên linh ðan
				30505107,--ti¬u lÕt bá
	},	},
}
x000196_g_selectBoss		= 6
x000196_g_mylevel			= 8
--x000196_g_Level			= 9
x000196_g_IDX_FuBenLifeStep	= 10
x000196_g_IDBOSS1		= 11
x000196_g_IDBOSS2		= 12
x000196_g_IDBOSS3		= 13
x000196_g_IDBOSS4		= 14
x000196_g_IDBOSS5		= 15
x000196_g_IDBOSS6		= 16
x000196_g_IDBOSS7		= 17
x000196_g_IDBOSS8		= 18
x000196_g_IDBOSS9		= 19
x000196_g_IDBOSS10		= 20
x000196_g_IDBOSS11		= 21
x000196_g_IDBOSS12		= 22
x000196_g_Flag	= 23
x000196_g_ntaichien = 25
function x000196_OnDefaultEvent( sceneId, selfId, targetId )
	if GetNumText() == 444 then
		BeginEvent(sceneId)
			AddText(sceneId, "#{SXLT_100119_03}")
		EndEvent(sceneId)
		DispatchEventList(sceneId,selfId,targetId)
		return
	end
	if GetNumText() == 1 then
		BeginEvent( sceneId )	
			AddText(sceneId, "#{SXLT_100119_04}")
			AddNumText(sceneId, x000196_g_ScriptId, "#{SXLT_100119_05}",10,2 )
			AddNumText(sceneId, x000196_g_ScriptId, "#{SXLT_100119_06}",8,3 )
		EndEvent(sceneId )
        		DispatchEventList( sceneId, selfId, targetId )
	end
	if GetNumText() == 2 then
		--LuaFnDelAvailableItem(sceneId,selfId,30504189,1)
		local ret, msg = x000196_CheckCanEnter( sceneId, selfId, targetId )
		if 1 ~= ret then
			BeginEvent(sceneId)
				AddText(sceneId,msg)
			EndEvent(sceneId)
			DispatchEventList(sceneId,selfId,targetId)
			return
		end
		BeginUICommand(sceneId)
		EndUICommand(sceneId,msg)
		DispatchUICommand(sceneId,selfId, 1000)

		x000196_MakeCopyScene( sceneId, selfId )
	end
	if GetNumText()==3 then
		BeginUICommand(sceneId)
		EndUICommand(sceneId,msg)
		DispatchUICommand(sceneId,selfId, 1000)
	end



end
function x000196_OnEventRequest( sceneId, selfId, targetId, eventId )
end

function x000196_OnEnumerate( sceneId, selfId, targetId )
	if x000196_g_active ==1  and (GetTime2Day()>= x000196_g_time_start and GetTime2Day()<=x000196_g_time_end) then
		AddNumText( sceneId, x000196_g_ScriptId, "Sinh Tiêu Lôi Ðài", 10, 1 )
		AddNumText( sceneId, x000196_g_ScriptId, "#{SXLT_100119_02}", 11, 444 )
	end
end

function x000196_CheckCanEnter( sceneId, selfId, targetId )
	if x000196_g_active ~= 1 then return end
	local msg=" "
		if GetLevel( sceneId, selfId) < x000196_g_NeedLever then
			msg="Ð¬ ði ðßþc phó bän,các hÕ t¯i thi¬u phäi ðÕt C¤p #G50"
			return 0, msg
		end
	--local msg=" "
	local number = LuaFnGetAvailableItemCount(sceneId, selfId, 30504189)
	local number2 = LuaFnGetAvailableItemCount(sceneId, selfId, 30504188)
		if number<1 and number2<1 then
			msg="#{SXLT_100119_08}"
			return 0,msg 
		end

	--local msg=" "
	if LuaFnHasTeam(sceneId,selfId) == 1 then
		msg="#{SXLT_100119_10}"
		return 0, msg
	end
	
	local CurDayTime = GetDayTime()
	local lastTime = GetMissionData( sceneId, selfId, EVENT_PARAM4 )
	local lastDayTime = floor( lastTime / 100 )
	local lastDayCount = mod( lastTime, 100 )
	if CurDayTime > lastDayTime then
			lastDayTime = CurDayTime
			lastDayCount = 0
	end
	if lastDayCount >= x000196_g_solan then
		msg="Các hÕ ðã tham gia ðü lßþt Sinh Tiêu trong ngày. Hãy quay lÕi vào ngày mai !"
		return 0, msg
	end
	--x000196_Tips(sceneId, selfId,"123")
	return 1

end
function x000196_MakeCopyScene( sceneId, selfId )
	local mylevel = GetLevel( sceneId, selfId )
    	local PlayerMaxLevel = GetHumanMaxLevelLimit()
	local iniLevel = 0
	if mylevel < 10 then
		iniLevel = 10
	elseif mylevel < PlayerMaxLevel then
		inilevel = floor( mylevel/10 ) * 10
	else
		inilevel = PlayerMaxLevel
	end

	local x = 0
	local z = 0
	local leaderguid=LuaFnObjId2Guid(sceneId,selfId)

	x,z = LuaFnGetWorldPos(sceneId,selfId)
	LuaFnSetSceneLoad_Map(sceneId, "hanyuchuang.nav")
	LuaFnSetCopySceneData_TeamLeader(sceneId, leaderguid)
	--LuaFnSetCopySceneData_Player(sceneId, selfId)

	LuaFnSetCopySceneData_NoUserCloseTime(sceneId, x000196_g_NoUserTime*1000)
	LuaFnSetCopySceneData_Timer(sceneId, x000196_g_TickTime*1000)
	LuaFnSetCopySceneData_Param(sceneId, 0, x000196_g_CopySceneType)
	LuaFnSetCopySceneData_Param(sceneId, 1, x000196_g_ScriptId)
	LuaFnSetCopySceneData_Param(sceneId, 2, 0)
	LuaFnSetCopySceneData_Param(sceneId, 3, sceneId)
	LuaFnSetCopySceneData_Param(sceneId, 4, x)
	LuaFnSetCopySceneData_Param(sceneId, 5, z)
	LuaFnSetCopySceneData_Param(sceneId, x000196_g_selectBoss, 0)
	LuaFnSetCopySceneData_Param(sceneId, 7, 0)



	LuaFnSetCopySceneData_Param( sceneId, x000196_g_mylevel, mylevel )
	
	LuaFnSetCopySceneData_Param( sceneId, x000196_g_IDX_FuBenLifeStep, 0 )

	LuaFnSetCopySceneData_Param( sceneId, x000196_g_IDBOSS1, 0 )
	LuaFnSetCopySceneData_Param( sceneId, x000196_g_IDBOSS2, 0 )
	LuaFnSetCopySceneData_Param( sceneId, x000196_g_IDBOSS3, 0 )
	LuaFnSetCopySceneData_Param( sceneId, x000196_g_IDBOSS4, 0 )
	LuaFnSetCopySceneData_Param( sceneId, x000196_g_IDBOSS5, 0 )
	LuaFnSetCopySceneData_Param( sceneId, x000196_g_IDBOSS6, 0 )
	LuaFnSetCopySceneData_Param( sceneId, x000196_g_IDBOSS7, 0 )
	LuaFnSetCopySceneData_Param( sceneId, x000196_g_IDBOSS8, 0 )
	LuaFnSetCopySceneData_Param( sceneId, x000196_g_IDBOSS9, 0 )
	LuaFnSetCopySceneData_Param( sceneId, x000196_g_IDBOSS10, 0 )
	LuaFnSetCopySceneData_Param( sceneId, x000196_g_IDBOSS11, 0 )
	LuaFnSetCopySceneData_Param( sceneId, x000196_g_IDBOSS12, 0 )

	for i=24, 31 do
		LuaFnSetCopySceneData_Param(sceneId, i, 0)

	end
	LuaFnSetSceneLoad_Area( sceneId, "hanyuchuang_area.ini" )
	LuaFnSetSceneLoad_Monster( sceneId, "12congiap_monster.ini" )

	local bRetSceneID = LuaFnCreateCopyScene(sceneId)
	BeginEvent(sceneId)
		if bRetSceneID>0 then
			AddText(sceneId,"Ðang d¸ch chuy¬n vào phø bän");
		else
			AddText(sceneId,"S¯ lßþng ngß¶i vào phø bän vßþt quá gi¾i hÕn, d¸ch chuy¬n th¤t bÕi");
		end
	EndEvent(sceneId)
	DispatchMissionTips(sceneId,selfId)

end

function x000196_OnCopySceneReady( sceneId, destsceneId )
	LuaFnSetCopySceneData_Param(destsceneId, 3, sceneId)
	local leaderguid  = LuaFnGetCopySceneData_TeamLeader(destsceneId)
	local leaderObjId = LuaFnGuid2ObjId(sceneId,leaderguid)

	if LuaFnIsCanDoScriptLogic( sceneId, leaderObjId ) ~= 1 then
		return
	end
	--AddGlobalCountNews(sceneId,"1111111111111111")
	--if LuaFnHasTeam( sceneId, leaderObjId ) == 0  then
		NewWorld( sceneId, leaderObjId, destsceneId, x000196_g_Fuben_X, x000196_g_Fuben_Z) ;
	--else
	--	if IsCaptain(sceneId, leaderObjId) == 0  then
	--		NewWorld( sceneId, leaderObjId, destsceneId, x000196_g_Fuben_X, x000196_g_Fuben_Z) ;
	--	else
	--		local	nearteammembercount = GetNearTeamCount( sceneId, leaderObjId) 
	--		local mems = {}
	--		for	i=0,nearteammembercount-1 do
	--			mems[i] = GetNearTeamMember(sceneId, leaderObjId, i)
	--			NewWorld( sceneId, mems[i], destsceneId, x000196_g_Fuben_X, x000196_g_Fuben_Z)
	--		end
	--	end		
	--end

end


function x000196_OnCopySceneTimer( sceneId, nowTime )
	local lifeStep = LuaFnGetCopySceneData_Param( sceneId, x000196_g_IDX_FuBenLifeStep )
	local TickCount = LuaFnGetCopySceneData_Param( sceneId, 2 )
	local TickFlag = LuaFnGetCopySceneData_Param( sceneId, 7 )
	

	TickCount = TickCount + 1
	TickFlag = TickFlag + 1
	LuaFnSetCopySceneData_Param( sceneId, 2, TickCount )
	LuaFnSetCopySceneData_Param( sceneId, 7, TickFlag )
	
	if lifeStep >= 11 and TickFlag == 5 then
		x000196_TipAllHuman( sceneId, "Còn 5 giây næa s¨ r¶i khöi phø bän")
	elseif lifeStep >= 11 and TickFlag == 7 then
		x000196_TipAllHuman( sceneId, "Còn 3 giây næa s¨ r¶i khöi phø bän")
	elseif lifeStep >= 11 and TickFlag == 8 then
		x000196_TipAllHuman( sceneId, "Còn 2 giây næa s¨ r¶i khöi phø bän")
	elseif lifeStep >= 11 and TickFlag == 9 then
		x000196_TipAllHuman( sceneId, "Còn 1 giây næa s¨ r¶i khöi phø bän")
	elseif lifeStep >= 11 and TickFlag == 10 then
		LuaFnSetCopySceneData_Param( sceneId, x000196_g_IDX_FuBenLifeStep, 12 )
		local nHumanNum = LuaFnGetCopyScene_HumanCount(sceneId)
		local oldSceneId = LuaFnGetCopySceneData_Param( sceneId, 3 )
		local oldX = LuaFnGetCopySceneData_Param( sceneId, 4 )
		local oldZ = LuaFnGetCopySceneData_Param( sceneId, 5 )
		for i=0, nHumanNum-1  do
			local PlayerId = LuaFnGetCopyScene_HumanObjId(sceneId, i)
			if LuaFnIsObjValid( sceneId, PlayerId ) == 1 and LuaFnIsCanDoScriptLogic( sceneId, PlayerId ) == 1 then
				NewWorld( sceneId, PlayerId, oldSceneId, oldX, oldZ )
			end
		end
		return
	end
	--end hd add
	if lifeStep == 2 and TickFlag == 120 then
		local nHumanNum = LuaFnGetCopyScene_HumanCount(sceneId)
		local oldSceneId = LuaFnGetCopySceneData_Param( sceneId, 3 )
		local oldX = LuaFnGetCopySceneData_Param( sceneId, 4 )
		local oldZ = LuaFnGetCopySceneData_Param( sceneId, 5 )
		for i=0, nHumanNum-1  do
			local PlayerId = LuaFnGetCopyScene_HumanObjId(sceneId, i)
			if LuaFnIsObjValid( sceneId, PlayerId ) == 1 and LuaFnIsCanDoScriptLogic( sceneId, PlayerId ) == 1 then
				NewWorld( sceneId, PlayerId, oldSceneId, oldX, oldZ )
			end
		end
		return
	end

	if lifeStep == 0 then
		--x000196_CreateNPC(sceneId)
		--x000196_Tips(sceneId, selfId,"12345")
		x000196_TipAllHuman( sceneId, "Còn 15 giây næa m¾i có th¬ khiêu chiªn" )
		LuaFnSetCopySceneData_Param( sceneId, x000196_g_IDX_FuBenLifeStep, 1 )
	end
	if lifeStep == 2 and TickFlag == 0 then
		x000196_TipAllHuman( sceneId, "Còn 5 giây næa s¨ thoát khöi phø bän!")
	end
	--hd add
	local nMonsterNum = GetMonsterCount(sceneId)
	if nMonsterNum > 14 then --anti bug 2 boss
		x000196_TipAllHuman( sceneId, "#HL²i phø bän, r¶i khöi phø bän ...")
		LuaFnSetCopySceneData_Param( sceneId, x000196_g_IDX_FuBenLifeStep, 11 )
		LuaFnSetCopySceneData_Param( sceneId, 7, 9 ) --fix bug multi boss
		--return
	end
	--end anti bug >=2 BOSS
	--hd add 8/2/2016 check >=2 human
	local nHumanCount = LuaFnGetCopyScene_HumanCount(sceneId)
	if nHumanCount >=2 then
		x000196_TipAllHuman( sceneId, "#HL²i phø bän có h½n 1 nhân v§t, r¶i khöi phø bän ...")
		LuaFnSetCopySceneData_Param( sceneId, x000196_g_IDX_FuBenLifeStep, 11 )
		LuaFnSetCopySceneData_Param( sceneId, 7, 9 ) --fix bug multi boss
	end
	--end hd add 8/2/2016
	if TickCount == 5*60 or TickCount == 10*60 or TickCount == 15*60 or TickCount == 20*60 or TickCount == 24*60 then
		x000196_TipAllHuman( sceneId, "#HPhø bän s¨ ðóng sau "..floor((x000196_g_FuBenTime-TickCount)/60).." phút, hãy nhanh chóng khiêu chiªn")
	elseif TickCount == x000196_g_FuBenTime then
		x000196_TipAllHuman( sceneId, "#HPhø bän kªt thúc, r¶i khöi phø bän...")
		LuaFnSetCopySceneData_Param( sceneId, x000196_g_IDX_FuBenLifeStep, 11 )
		LuaFnSetCopySceneData_Param( sceneId, 7, 0 )
	end
	
	
end
--end

function x000196_OnPlayerEnter( sceneId, selfId )
	SetPlayerDefaultReliveInfo( sceneId, selfId, "%10", -1, "0", sceneId, x000196_g_Fuben_X, x000196_g_Fuben_Z )

	local lastTime = GetMissionData( sceneId, selfId, EVENT_PARAM4 )
	local lastDayTime = floor( lastTime / 100 )
	local lastDayCount = mod( lastTime, 100 )
	local CurDayTime = GetDayTime()

	if CurDayTime > lastDayTime then
		lastDayTime = CurDayTime
		lastDayCount = 0
	end

	lastDayCount = lastDayCount + 1
	lastTime = lastDayTime * 100+ lastDayCount
	SetMissionData( sceneId, selfId, EVENT_PARAM4, lastTime )
	local num1 = LuaFnGetAvailableItemCount(sceneId, selfId, 30504188)
	 local num2 = LuaFnGetAvailableItemCount(sceneId, selfId, 30504189)
	 if num2>=1 then
	
	LuaFnDelAvailableItem(sceneId,selfId,30504189,1)
	 else
	 LuaFnDelAvailableItem(sceneId,selfId,30504188,1)
	end
end


function x000196_OnHumanDie( sceneId, selfId, killerId )
	
end


function x000196_TipAllHuman( sceneId, Str )

	local nHumanNum = LuaFnGetCopyScene_HumanCount(sceneId)
	for i=0, nHumanNum-1  do
		local PlayerId = LuaFnGetCopyScene_HumanObjId(sceneId, i)
		if LuaFnIsObjValid( sceneId, PlayerId ) == 1 and LuaFnIsCanDoScriptLogic( sceneId, PlayerId ) == 1 then
			BeginEvent(sceneId)
				AddText(sceneId, Str)
			EndEvent(sceneId)
			DispatchMissionTips(sceneId, PlayerId)
		end
	end

end

function x000196_PickupItem(sceneId, selfId, itemId, bagidx )
	--thong bao he thong
	local itemName = GetItemName(sceneId, itemId)
	local transfer = GetBagItemTransfer(sceneId,selfId,bagidx)
	if transfer == nil then return	end
	if itemId==30505167 or itemId==30505169 or
	itemId==30505197 or itemId==30505198 
	then ---tien vang & linh hon toai phien
		return
	end
	for i=1,getn(x000195_ItemList2) do
		if itemId == x000195_ItemList2[i] then
			return
		end
	end
	for i=1,getn(x000195_ItemList_ThuCuoi_VIP) do
		if itemId == x000195_ItemList_ThuCuoi_VIP[i] then
			return
		end
	end
	
	if itemId==20310101 or itemId==20310102 then --trung lau chi le, chi mang
		local str = format("@*;SrvMsg;SCA: #P#{_INFOUSR%s} tÕi #Y [Sinh Tiêu Lôi Ðài] #P, ðµt nhiên trên tr¶i r½i xu¯ng, ti®n tay nh£t ðßþc #Y#{_INFOMSG%s} #Pth§t là may m¡n!",GetName(sceneId,selfId),transfer)
		BroadMsgByChatPipe(sceneId, selfId, str, 4)
		return
	end
	if itemId==10423064 or itemId==10420091 or itemId==10422155 then --trung lau quy, phan, trieu
		local str = format("@*;SrvMsg;SCA: #P#{_INFOUSR%s} tÕi #Y [Sinh Tiêu Lôi Ðài] #P, ðµt nhiên trên tr¶i r½i xu¯ng, ti®n tay nh£t ðßþc #Y#{_INFOMSG%s} #Pth§t là may m¡n!",GetName(sceneId,selfId),transfer)
		BroadMsgByChatPipe(sceneId, selfId, str, 4)
		return
	end
	if itemId==10413096 or itemId==10413094 or itemId==10413092 then --trung lau kien thu doi
		local str = format("@*;SrvMsg;SCA: #P#{_INFOUSR%s} tÕi #Y [Sinh Tiêu Lôi Ðài] #P, ðµt nhiên trên tr¶i r½i xu¯ng, ti®n tay nh£t ðßþc #Y#{_INFOMSG%s} #Pth§t là may m¡n!",GetName(sceneId,selfId),transfer)
		BroadMsgByChatPipe(sceneId, selfId, str, 4)
		return
	end
	
	local str = format("#P#{_INFOUSR%s} tÕi #Y [Sinh Tiêu Lôi Ðài] #P, ðµt nhiên trên tr¶i r½i xu¯ng, ti®n tay nh£t ðßþc #Y#{_INFOMSG%s} #Pth§t là may m¡n!",GetName(sceneId,selfId),transfer)
	BroadMsgByChatPipe(sceneId, selfId, str, 4)
end


function x000196_Tips(sceneId, selfId,Tips)
	BeginEvent(sceneId)
		AddText(sceneId, Tips)
	EndEvent(sceneId)
	DispatchMissionTips(sceneId, selfId)
end
