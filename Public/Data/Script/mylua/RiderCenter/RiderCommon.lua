x045012_g_scriptId = 045012
x045012_g_RiderInfo = {
	{30141001,26000},
	{30141002,26001},
	{30141009,26002},
	{30141008,26003},
	{30141007,26004},
	{30141004,26005},
	{30141005,26006},
	{30141003,26007},
	{30141006,26008},
	{30141010,26009},
	{30141011,26010},
	{30141018,26011},
	{30141017,26012},
	{30141016,26013},
	{30141013,26014},
	{30141014,26015},
	{30141012,26016},
	{30141015,26017},
	{30141019,26018},
	{30141020,26019},
	{30141000,26021},
	{30280240,26024},
	{30280260,26026},
	{30280270,26027},
	{30280280,26028},
	{30280290,26029},
	{30280300,26030},
	{30280310,26031},
	{30280320,26032},
	{30280330,26033},
	{30280350,26035},
	{30280360,26036},
	{30280370,26037},
	{30280380,26038},
	{30280390,26039},
	{30280400,26040},
	{30280410,26041},
	{30280420,26042},
	{30280430,26043},
	{30280440,26044},
	{30280450,26045},
	{30280460,26046},
	{30280470,26047},
	{30280480,26048},
	{30280490,26049},
	{30280500,26050},
	{30280510,26051},
	{30280520,26052},
	{30141175,26053},
	{30141155,26054},
	{30141179,26055},
	{30141167,26056},
	{30141159,26057},
	{30141183,26058},
	{30141171,26059},
	{30141187,26060},
	{30141163,26061},
	{30280620,26062},
	{30280630,26063},
	{30280640,26064},
	{30280650,26065},
	{30280690,26069},
	{30280700,26070},
	{30280710,26071},
	{30280720,26072},
	{30280730,26073},
	{30280740,26074},
	{30280750,26075},
	{30280760,26076},
	{30280770,26077},
	{30280780,26078},
	{30280790,26079},
	{30280800,26080},
	{30280810,26081},
	{30280820,26082},
	{30280830,26083},
	{30280840,26084},
	{30280850,26085},
	{30280860,26086},
	{30280870,26087},
	{30280880,26088},
	{30280890,26089},
	{30280900,26090},
	{30280910,26091},
	{30280920,26092},
	{30280930,26093},
	{30280940,26094},
	{30280960,26096},
	{30280980,26098},
	{30280990,26099},
	{30281000,26100},
	{30281020,26102},
	{30281030,26103},
	{30281040,26104},
	{30281510,26151},
	{30281530,26153},
	{30281540,26154},
	{30281570,26157},
	{30281580,26158},
	{30281600,26160},
	{30281620,26162},
	{30281640,26164},
	{30281650,26165},
	{30281660,26166},
	{30281670,26167},
	{30281680,26168},
	{30281690,26169},
	{30281710,26171},
	{30281720,26172},
	{30281730,26173},
	{30281740,26174},
	{30281750,26175},
	{30281760,26176},
	{30281770,26177},
	{30281780,26178},
	{30281790,26179},
	{30281800,26180},
	{30281810,26181},
	{30281860,26186},
	{30281870,26187},
	{30281880,26188},
	{30281890,26189},
	{30281900,26190},
	{30281910,26191},
	{30281920,26192},
	{30281940,26194},
	{30281950,26195},
	{30281960,26196},
	{30281970,26197},
	{30281980,26198},
	{30281990,26199},
	{30282000,26200},
	{30282010,26201},
	{30282020,26202},
	{30282030,26203},
	{30282040,26204},
	{30282050,26205},
	{30282060,26206},
	{30282070,26207},
	{30282080,26208},
	{30282090,26209},
	{30282100,26210},
	{30282110,26211},
	{30282120,26212},
	{30282130,26213},
	{30282140,26214},
	{30282160,26216},
	{30282170,26217},
	{30282180,26218},
	{30282190,26219},
	{30282200,26220},
	{30282210,26221},
	{30282220,26222},
	{30282230,26223},
	{30282240,26224},
	{30282250,26225},
	{30282260,26226},
	{30282300,26230},
	{30282310,26231},
	{30282320,26232},
	{30282330,26233},
	{30282340,26234},
	{30282350,26235},
	{30282370,26237},
	{30282380,26238},
	{30282390,26239},
	{30282420,26242},
	{30282430,26243},
	{30282440,26244},
	{30282450,26245},
	{30282460,26246},
	{30282470,26247},
	{30282480,26248},
	{30282490,26249},
	{30282500,26250},
	{30282570,26257},
	{30282760,26276},
	{30282770,26277},
	{30282970,26297},
	{30282980,26298},
	{30283360,26336},
	{30283370,26337},
	{30283430,26343},
	{30283440,26344},
}

--**********************************--
--*        On Default Event        *--
--**********************************--
function x045012_OnDefaultEvent(sceneId,selfId,bagIndex)

	--********************--
	--********************--

end
--**********************************--
--*      Is Skill Like Script      *--
--**********************************--
function x045012_IsSkillLikeScript(sceneId,selfId)
	--********************--
	return 1
	--********************--
end
--**********************************--
--*         Cancel Impacts         *--
--**********************************--
function x045012_CancelImpacts(sceneId,selfId)
	--********************--
	return 0
	--********************--
end
--**********************************--
--*       On Condition Check       *--
--**********************************--
function x045012_OnConditionCheck(sceneId,selfId)
	--********************--
	if LuaFnVerifyUsedItem(sceneId,selfId) ~= 1 then
		return 0
	end
	--********************--
	local nIndex = LuaFnGetBagIndexOfUsedItem( sceneId, selfId )
	local ItemID = LuaFnGetItemTableIndexByIndex(sceneId, selfId, nIndex)
	
	local Menpai_Rider = {30141001,30141019,30141009,30141004,30141005,30141006,30141002,30141008,30141007,30141219,30141010,30141020,30141018,30141013,30141014,30141015,30141011,30141017,30141016,30141220,30141167,30141163,30141159,30141179,30141155,30141187,30141171,30141175,30141183,30141224}

	local Menpai_ID = {0, 1, 2, 3, 4, 5, 6, 7, 8, 10, 0, 1, 2, 3, 4, 5, 6, 7, 8, 10, 0, 1, 2, 3, 4, 5, 6, 7, 8, 10}
	for i = 1, getn(Menpai_Rider) do
		if ItemID == Menpai_Rider[i] then
			if GetMenPai(sceneId, selfId) ~= Menpai_ID[i] then
				x045012_NotifyFailTips(sceneId,selfId,"Không th¬ mang kÜ thu§t cüa môn phái khác!")
				return 0
			end
			break;
		end
	end
	--********************--
	local Author, szAuthor = LuaFnGetItemCreator(sceneId,selfId,nIndex)
	local NowTime = GetTime2Day()

	if not szAuthor then
		szAuthor = "00000000".."0"
	else
		local SaveTime = tonumber(strsub(szAuthor,1,8))
		if SaveTime == 0 then
			szAuthor = "00000000"..strsub(szAuthor,9,9)
		elseif SaveTime >= 1 and SaveTime <= 1000 then
			local FormatDate = GetFormatDate(GetDayTime()+SaveTime)
			szAuthor = FormatDate..strsub(szAuthor,9,9)
		else
			if NowTime > SaveTime then
				x045012_NotifyFailTips(sceneId,selfId,"V§t ph¦m quá hÕn, không th¬ sØ døng!")
				return
			end
		end
	end
	
	local MountStatus = GetMissionData(sceneId,selfId,CHARRIDER_ITEM)
	if MountStatus == 0 then
		x045012_CancelMount(sceneId,selfId)
		
		SetMissionData(sceneId,selfId,CHARRIDER_INFO,tonumber(szAuthor))
		SetMissionData(sceneId,selfId,CHARRIDER_ITEM,ItemID)
	else
		EraseItem(sceneId,selfId,nIndex)
		x045012_UnMountRClick(sceneId,selfId)
		
		SetMissionData(sceneId,selfId,CHARRIDER_INFO,tonumber(szAuthor))
		SetMissionData(sceneId,selfId,CHARRIDER_ITEM,ItemID)
		-- x045012_NotifyFailTips(sceneId,selfId,"Tháo dÞ kÜ thu§t ðang dùng!")
		return
	end
	
	--********************--
	return 1
	--********************--
end
--**********************************--
--*           On Deplete           *--
--**********************************--
function x045012_OnDeplete(sceneId,selfId)
	--********************--
	if LuaFnDepletingUsedItem(sceneId,selfId) > 0 then
		return 1
	end
	--********************--
	return 0
	--********************--
end
--**********************************--
--*        On Activate Once        *--
--**********************************--
function x045012_OnActivateOnce(sceneId,selfId)
	--********************--
	BeginUICommand(sceneId)
	EndUICommand(sceneId)
	DispatchUICommand(sceneId,selfId,27001)
	--********************--
	return 1
	--********************--
end
--**********************************--
--*        On Default Event        *--
--**********************************--
function x045012_OnActivateEachTick(sceneId,selfId)
	--********************--
	return 1
	--********************--
end

function x045012_NotifyFailTips(sceneId,selfId,Tip)
	BeginEvent(sceneId)
		AddText(sceneId,Tip)
	EndEvent(sceneId)
	DispatchMissionTips(sceneId,selfId)
end

function x045012_UnMountRClick(sceneId,selfId)
	if LuaFnGetPropertyBagSpace(sceneId,selfId) < 1 then
		x045012_NotifyFailTips(sceneId,selfId,"Tay näi ðã ð¥y!")
		return
	end
	
	local ItemID = GetMissionData(sceneId,selfId,CHARRIDER_ITEM)
	local szAuthor = GetMissionData(sceneId,selfId,CHARRIDER_INFO)
	local NewRide = TryRecieveItem(sceneId,selfId,ItemID,1)
	
	local szAuthor_Lengh = strlen(szAuthor)
	for i = szAuthor_Lengh + 1, 9 do
		szAuthor = "0"..szAuthor
	end
	
	LuaFnSetItemCreator(sceneId,selfId,NewRide,szAuthor)
	LuaFnItemBind(sceneId,selfId,NewRide)
	
	SetMissionData(sceneId,selfId,CHARRIDER_ITEM,0)
	SetMissionData(sceneId,selfId,CHARRIDER_INFO,0)
	
	x045012_CancelMount(sceneId,selfId)
	
	BeginUICommand(sceneId)
	EndUICommand(sceneId)
	DispatchUICommand(sceneId,selfId,27001)
end

function x045012_CancelMount(sceneId,selfId)
	for i = 1, getn(x045012_g_RiderInfo) do
		if LuaFnHaveImpactOfSpecificDataIndex(sceneId, selfId, x045012_g_RiderInfo[i][2]) == 1 then
			LuaFnCancelSpecificImpact(sceneId, selfId, x045012_g_RiderInfo[i][2])
		end
	end
end

function x045012_OnImpactFadeOut( sceneId, selfId )
	local Logic = 0
	local ItemID = GetMissionData(sceneId,selfId,CHARRIDER_ITEM)
	if ItemID == 0 then
		x045012_NotifyFailTips(sceneId,selfId,"Không có thú cßÞi!")
		return
	end
	for i = 1, getn(x045012_g_RiderInfo) do
		if ItemID == x045012_g_RiderInfo[i][1] then
			LuaFnSendSpecificImpactToUnit(sceneId, selfId, selfId, selfId, x045012_g_RiderInfo[i][2], 0)
			break
		end
	end
end
