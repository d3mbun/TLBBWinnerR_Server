--µÀ¾ß: ±¦Ê¯Tinh»ª
--½Å±¾ºÅ 332206
--Author:  houzhifang  2008-11-06

x332206_g_scriptId = 332206


x332206_g_ItemData = 
{
	--H± Nhãn ThÕchTinh»ª
{ItemIndex = 30501174, GiveItem = 30504028, ImpactId = 31615},
{ItemIndex = 30501175, GiveItem = 30504029, ImpactId = 31616},
{ItemIndex = 30501176, GiveItem = 30504030, ImpactId = 31617},
{ItemIndex = 30501177, GiveItem = 30504031, ImpactId = 31618},
{ItemIndex = 30501178, GiveItem = 30504032, ImpactId = 31619},
{ItemIndex = 30501179, GiveItem = 30504033, ImpactId = 31620},
{ItemIndex = 30501180, GiveItem = 30504034, ImpactId = 31621},
{ItemIndex = 30501181, GiveItem = 30504035, ImpactId = 31622},
{ItemIndex = 30501182, GiveItem = 30504036, ImpactId = 31623},
{ItemIndex = 30504040, GiveItem = 30504031, ImpactId = 31618},
--Miêu Nhãn ThÕchTinh»ª
{ItemIndex = 30501183, GiveItem = 30504028, ImpactId = 31624},
{ItemIndex = 30501184, GiveItem = 30504029, ImpactId = 31625},
{ItemIndex = 30501185, GiveItem = 30504030, ImpactId = 31626},
{ItemIndex = 30501186, GiveItem = 30504031, ImpactId = 31627},
{ItemIndex = 30501187, GiveItem = 30504032, ImpactId = 31628},
{ItemIndex = 30501188, GiveItem = 30504033, ImpactId = 31629},
{ItemIndex = 30501189, GiveItem = 30504034, ImpactId = 31630},
{ItemIndex = 30501190, GiveItem = 30504035, ImpactId = 31631},
{ItemIndex = 30501191, GiveItem = 30504036, ImpactId = 31632},
{ItemIndex = 30504041, GiveItem = 30504031, ImpactId = 31627},
--×ÏÓñTinh»ª
{ItemIndex = 30501192, GiveItem = 30504028, ImpactId = 31633},
{ItemIndex = 30501193, GiveItem = 30504029, ImpactId = 31634},
{ItemIndex = 30501194, GiveItem = 30504030, ImpactId = 31635},
{ItemIndex = 30501195, GiveItem = 30504031, ImpactId = 31636},
{ItemIndex = 30501196, GiveItem = 30504032, ImpactId = 31637},
{ItemIndex = 30501197, GiveItem = 30504033, ImpactId = 31638},
{ItemIndex = 30501198, GiveItem = 30504034, ImpactId = 31639},
{ItemIndex = 30501199, GiveItem = 30504035, ImpactId = 31640},
{ItemIndex = 30501200, GiveItem = 30504036, ImpactId = 31641},
--×æÄ¸ÂÌTinh»ª
{ItemIndex = 30501201, GiveItem = 30504028, ImpactId = 31642},
{ItemIndex = 30501202, GiveItem = 30504029, ImpactId = 31643},
{ItemIndex = 30501203, GiveItem = 30504030, ImpactId = 31644},
{ItemIndex = 30501204, GiveItem = 30504031, ImpactId = 31645},
{ItemIndex = 30501205, GiveItem = 30504032, ImpactId = 31646},
{ItemIndex = 30501206, GiveItem = 30504033, ImpactId = 31647},
{ItemIndex = 30501207, GiveItem = 30504034, ImpactId = 31648},
{ItemIndex = 30501208, GiveItem = 30504035, ImpactId = 31649},
{ItemIndex = 30501209, GiveItem = 30504036, ImpactId = 31650},
--ºì¾§Ê¯Tinh»ª
{ItemIndex = 30501210, GiveItem = 30504028, ImpactId = 31660},
{ItemIndex = 30501211, GiveItem = 30504029, ImpactId = 31661},
{ItemIndex = 30501212, GiveItem = 30504030, ImpactId = 31662},
{ItemIndex = 30501213, GiveItem = 30504031, ImpactId = 31663},
{ItemIndex = 30501214, GiveItem = 30504032, ImpactId = 31664},
{ItemIndex = 30501215, GiveItem = 30504033, ImpactId = 31665},
{ItemIndex = 30501216, GiveItem = 30504034, ImpactId = 31666},
{ItemIndex = 30501217, GiveItem = 30504035, ImpactId = 31667},
{ItemIndex = 30501218, GiveItem = 30504036, ImpactId = 31668},
--À¶¾§Ê¯Tinh»ª
{ItemIndex = 30501219, GiveItem = 30504028, ImpactId = 31651},
{ItemIndex = 30501220, GiveItem = 30504029, ImpactId = 31652},
{ItemIndex = 30501221, GiveItem = 30504030, ImpactId = 31653},
{ItemIndex = 30501222, GiveItem = 30504031, ImpactId = 31654},
{ItemIndex = 30501223, GiveItem = 30504032, ImpactId = 31655},
{ItemIndex = 30501224, GiveItem = 30504033, ImpactId = 31656},
{ItemIndex = 30501225, GiveItem = 30504034, ImpactId = 31657},
{ItemIndex = 30501226, GiveItem = 30504035, ImpactId = 31658},
{ItemIndex = 30501227, GiveItem = 30504036, ImpactId = 31659},
--Hoàng Tinh ThÕchTinh»ª
{ItemIndex = 30501228, GiveItem = 30504028, ImpactId = 31669},
{ItemIndex = 30501229, GiveItem = 30504029, ImpactId = 31670},
{ItemIndex = 30501230, GiveItem = 30504030, ImpactId = 31671},
{ItemIndex = 30501231, GiveItem = 30504031, ImpactId = 31672},
{ItemIndex = 30501232, GiveItem = 30504032, ImpactId = 31673},
{ItemIndex = 30501233, GiveItem = 30504033, ImpactId = 31674},
{ItemIndex = 30501234, GiveItem = 30504034, ImpactId = 31675},
{ItemIndex = 30501235, GiveItem = 30504035, ImpactId = 31676},
{ItemIndex = 30501236, GiveItem = 30504036, ImpactId = 31677},
--ÂÌ¾§Ê¯Tinh»ª
{ItemIndex = 30501237, GiveItem = 30504028, ImpactId = 31678},
{ItemIndex = 30501238, GiveItem = 30504029, ImpactId = 31679},
{ItemIndex = 30501239, GiveItem = 30504030, ImpactId = 31680},
{ItemIndex = 30501240, GiveItem = 30504031, ImpactId = 31681},
{ItemIndex = 30501241, GiveItem = 30504032, ImpactId = 31682},
{ItemIndex = 30501242, GiveItem = 30504033, ImpactId = 31683},
{ItemIndex = 30501243, GiveItem = 30504034, ImpactId = 31684},
{ItemIndex = 30501244, GiveItem = 30504035, ImpactId = 31685},
{ItemIndex = 30501245, GiveItem = 30504036, ImpactId = 31686},
--ÑªTinhÊ¯Tinh»ª
{ItemIndex = 30501319, GiveItem = 30504028, ImpactId = 31696},
{ItemIndex = 30501320, GiveItem = 30504029, ImpactId = 31697},
{ItemIndex = 30501321, GiveItem = 30504030, ImpactId = 31698},
{ItemIndex = 30501322, GiveItem = 30504031, ImpactId = 31699},
{ItemIndex = 30501323, GiveItem = 30504032, ImpactId = 31700},
{ItemIndex = 30501324, GiveItem = 30504033, ImpactId = 31701},
{ItemIndex = 30501325, GiveItem = 30504034, ImpactId = 31702},
{ItemIndex = 30501326, GiveItem = 30504035, ImpactId = 31703},      
{ItemIndex = 30501327, GiveItem = 30504036, ImpactId = 31704},
--ºì±¦Ê¯Tinh»ª
{ItemIndex = 30501328, GiveItem = 30504028, ImpactId = 31687},
{ItemIndex = 30501329, GiveItem = 30504029, ImpactId = 31688},
{ItemIndex = 30501330, GiveItem = 30504030, ImpactId = 31689},
{ItemIndex = 30501331, GiveItem = 30504031, ImpactId = 31690},
{ItemIndex = 30501332, GiveItem = 30504032, ImpactId = 31691},
{ItemIndex = 30501333, GiveItem = 30504033, ImpactId = 31692},
{ItemIndex = 30501334, GiveItem = 30504034, ImpactId = 31693},
{ItemIndex = 30501335, GiveItem = 30504035, ImpactId = 31694},
{ItemIndex = 30501336, GiveItem = 30504036, ImpactId = 31695},
}

--**********************************
--ÊÂ¼þ½»»¥Èë¿Ú
--**********************************
function x332206_OnDefaultEvent( sceneId, selfId, bagIndex )
-- ²»C¥n Cái này ½Ó¿Ú,±£Áô¿Õº¯Êý
end

--**********************************
--Cái này ÎïÆ·toÕ ðµ Ê¹ÓÃ¹ý³ÌÐúng·ñÀàËÆÓÚ¼¼ÄÜ: 
--H® th¯ng»áTÕi Ö´ÐÐ¿ªÊ¼Ê±¼ì²âCái này º¯ÊýtoÕ ðµ Tr· v«Öµ,Èç¹ûTr· v«th¤t bÕiÔòºöÂÔºóÃætoÕ ðµ ÀàËÆ¼¼ÄÜtoÕ ðµ Ö´ÐÐ.
--Tr· v«1: ¼¼ÄÜÀàËÆtoÕ ðµ ÎïÆ·,¿ÉÒÔ¼ÌÐøÀàËÆ¼¼ÄÜtoÕ ðµ Ö´ÐÐ£»Tr· v«0: ºöÂÔºóÃætoÕ ðµ ²Ù×÷.
--**********************************
function x332206_IsSkillLikeScript( sceneId, selfId)
	return 1; --Cái này ½Å±¾C¥n ¶¯×÷Ö§³Ö
end

--**********************************
--Ö±½ÓHuÖ böÐ§¹û: 
--H® th¯ng»áÖ±½Óµ÷ÓÃCái này ½Ó¿Ú,²¢¸ù¾ÝCái này º¯ÊýtoÕ ðµ Tr· v«ÖµXác nh§nÒÔºótoÕ ðµ Á÷³ÌÐúng·ñÖ´ÐÐ.
--Tr· v«1: ÒÑ¾­HuÖ bö¶ÔÓ¦Ð§¹û,²»ÔÙÖ´ÐÐºóÐø²Ù×÷£»Tr· v«0: Ã»ÓÐ¼ì²âµ½Ïà¹ØÐ§¹û,¼ÌÐøÖ´ÐÐ.
--**********************************
function x332206_CancelImpacts( sceneId, selfId )
	return 0; --²»C¥n Cái này ½Ó¿Ú,µ«Òª±£Áô¿Õº¯Êý,²¢ÇÒÊ¼ÖÕTr· v«0.
end

--**********************************
--Ìõ¼þ¼ì²âÈë¿Ú: 
--H® th¯ng»áTÕi ¼¼ÄÜ¼ì²âtoÕ ðµ Ê±¼ä ði¬mµ÷ÓÃCái này ½Ó¿Ú,²¢¸ù¾ÝCái này º¯ÊýtoÕ ðµ Tr· v«ÖµXác nh§nÒÔºótoÕ ðµ Á÷³ÌÐúng·ñÖ´ÐÐ.
--Tr· v«1: Ìõ¼þ¼ì²âÍ¨¹ý,¿ÉÒÔ¼ÌÐøÖ´ÐÐ£»Tr· v«0: Ìõ¼þ¼ì²âth¤t bÕi,ÖÐ¶ÏºóÐøÖ´ÐÐ.
--**********************************
function x332206_OnConditionCheck( sceneId, selfId )

	--Ð£ÑéÊ¹ÓÃtoÕ ðµ Îï?
	if(1~=LuaFnVerifyUsedItem(sceneId, selfId)) then
		return 0
	end
	
	local FreeSpace = LuaFnGetPropertyBagSpace( sceneId, selfId )
	if( FreeSpace < 1 ) then
	        local strNotice = "Ô ðÕo cø ðã ð¥y, xin hãy ch×a tr¯ng 1 khoän không gian."
		      x332206_ShowNotice( sceneId, selfId, strNotice)
	        return 0
	end
	
	local nItemIndex = LuaFnGetItemIndexOfUsedItem( sceneId, selfId )
	local nGiveItemIndex = 0
	local nGiveImpactId = 0
	for i = 1, getn(x332206_g_ItemData) do
		if x332206_g_ItemData[i].ItemIndex == nItemIndex then
			nGiveItemIndex = x332206_g_ItemData[i].GiveItem
			nGiveImpactId = x332206_g_ItemData[i].ImpactId
			break
		end
	end
	
	if nGiveItemIndex == 0 or nGiveImpactId == 0 then
		return 0;
	end
	
	local nHaveImpact = 0
	for i = 1, getn(x332206_g_ItemData) do
		local nRet = LuaFnHaveImpactOfSpecificDataIndex(sceneId, selfId, x332206_g_ItemData[i].ImpactId)
		if nRet == 1 then
			nHaveImpact = 1
		end
	end
	
	if nHaveImpact == 1 then
		local strNotice = "Trên ngß¶i ðã có hi®u quä bäo thÕch tinh hoa, thïnh chü ðµng hüy bö hi®u quä."
		x332206_ShowNotice( sceneId, selfId, strNotice)
		return 0;
	end
	
	return 1; --²»C¥n ÈÎºÎÌõ¼þ,²¢ÇÒÊ¼ÖÕTr· v«1.
end

--**********************************
--ÏûºÄ¼ì²â¼°´¦ÀíÈë¿Ú: 
--H® th¯ng»áTÕi ¼¼ÄÜÏûºÄtoÕ ðµ Ê±¼ä ði¬mµ÷ÓÃCái này ½Ó¿Ú,²¢¸ù¾ÝCái này º¯ÊýtoÕ ðµ Tr· v«ÖµXác nh§nÒÔºótoÕ ðµ Á÷³ÌÐúng·ñÖ´ÐÐ.
--Tr· v«1: ÏûºÄ´¦ÀíÍ¨¹ý,¿ÉÒÔ¼ÌÐøÖ´ÐÐ£»Tr· v«0: ÏûºÄ¼ì²âth¤t bÕi,ÖÐ¶ÏºóÐøÖ´ÐÐ.
--×¢Òâ: Õâ²»¹â¸ºÔðÏûºÄtoÕ ðµ ¼ì²âÒ²¸ºÔðÏûºÄtoÕ ðµ Ö´ÐÐ.
--**********************************
function x332206_OnDeplete( sceneId, selfId )
	
	if(0<LuaFnDepletingUsedItem(sceneId, selfId)) then
		return 1;
	end

	return 0;
end

--**********************************
--Ö»»áÖ´ÐÐmµt ´ÎÈë¿Ú: 
--¾ÛÆøºÍË²·¢¼¼ÄÜ»áTÕi ÏûºÄÍê³Éºóµ÷ÓÃCái này ½Ó¿Ú(¾ÛÆø½áÊø²¢ÇÒ¸÷ÖÖÌõ¼þ¶¼Thöa mãntoÕ ðµ Ê±ºò),¶øÒýµ¼
--¼¼ÄÜÒ²»áTÕi ÏûºÄÍê³Éºóµ÷ÓÃCái này ½Ó¿Ú(¼¼ÄÜtoÕ ðµ mµt ¿ªÊ¼,ÏûºÄ³É¹¦Ö´ÐÐÖ®ºó).
--Tr· v«1: ´¦Àí³É¹¦£»Tr· v«0: ´¦Àíth¤t bÕi.
--×¢: ÕâÀïÐúng¼¼ÄÜÉúÐ§mµt ´ÎtoÕ ðµ Èë¿Ú
--**********************************
function x332206_OnActivateOnce( sceneId, selfId )

	local nItemIndex = LuaFnGetItemIndexOfUsedItem( sceneId, selfId )
	local nGiveItemIndex = 0
	local nGiveImpactId = 0
	for i = 1, getn(x332206_g_ItemData) do
		if x332206_g_ItemData[i].ItemIndex == nItemIndex then
			nGiveItemIndex = x332206_g_ItemData[i].GiveItem
			nGiveImpactId = x332206_g_ItemData[i].ImpactId
			break
		end
	end
	
	if nGiveItemIndex == 0 or nGiveImpactId == 0 then
		return 0;
	end
	
	local nHaveImpact = 0
	for i = 1, getn(x332206_g_ItemData) do
		local nRet = LuaFnHaveImpactOfSpecificDataIndex(sceneId, selfId, x332206_g_ItemData[i].ImpactId)
		if nRet == 1 then
			nHaveImpact = 1
		end
	end
	if nHaveImpact == 1 then
		local strNotice = "Trên ngß¶i ðã có hi®u quä bäo thÕch tinh hoa, thïnh chü ðµng hüy bö hi®u quä."
		x332206_ShowNotice( sceneId, selfId, strNotice)
		return 0;
	end
	
	LuaFnSendSpecificImpactToUnit(sceneId, selfId, selfId, selfId, nGiveImpactId, 0)

	BeginAddItem(sceneId)                --¸øÎïÆ·
		AddItem(sceneId, nGiveItemIndex, 1)
	local canAdd = LuaFnEndAddItemIgnoreFatigueState( sceneId, selfId )

    if canAdd > 0 then
		LuaFnAddItemListToHumanIgnoreFatigueState(sceneId,selfId)
		local ItemName = GetItemName(sceneId, nGiveItemIndex)
		local strNotice = "ÐÕt ðßþc "..ItemName
		x332206_ShowNotice( sceneId, selfId, strNotice)
	end
	
	return 1;
end

--**********************************
--Òýµ¼ÐÄÌø´¦ÀíÈë¿Ú: 
--Òýµ¼¼¼ÄÜ»áTÕi Ã¿´ÎÐÄÌø½áÊøÊ±µ÷ÓÃCái này ½Ó¿Ú.
--Tr· v«: 1¼ÌÐøÏÂ´ÎÐÄÌø£»0: ÖÐ¶ÏÒýµ¼.
--×¢: ÕâÀïÐúng¼¼ÄÜÉúÐ§mµt ´ÎtoÕ ðµ Èë¿Ú
--**********************************
function x332206_OnActivateEachTick( sceneId, selfId)
	return 1; --²»ÐúngÒýµ¼ÐÔ½Å±¾, Ö»±£Áô¿Õº¯Êý.
end

function x332206_ShowNotice( sceneId, selfId, strNotice)
	BeginEvent( sceneId )
		AddText( sceneId, strNotice )
	EndEvent( sceneId )
	DispatchMissionTips( sceneId, selfId )    
end

function x332206_ShowRandomSystemNotice( sceneId, selfId, strItemInfo )
	
	--Cái này º¯ÊýÏÖTÕi Ã»ÓÐÓÃ
	--local PlayerName = GetName(sceneId,selfId)
	--local str = format( x332206_g_strGongGaoInfo, PlayerName, strItemInfo )
	--BroadMsgByChatPipe( sceneId, selfId, str, 4 )
	
end
